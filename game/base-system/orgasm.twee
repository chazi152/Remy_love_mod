:: Widgets Orgasm [widget]

<<widget "orgasm">>
	<<orgasmstat>><<orgasmcount 1>><<set $orgasmdown to 3>>
	<<if $combat is 1>>
		<<set $speechcum to 1>><<set $speechorgasmcount += 1>>
	<</if>>
	<<tinyPenisDryOrgasmChance>>
	<<if $player.penisExist>>
		<<if $femaleclimax is 1>>
			<span class="pink">你被快感征服，像女孩一样高潮了。</span>
			<<semenvolume `$player.penissize is -2 ? -5 : -1`>>
		<<elseif $semen_volume is 0 or $semen_amount lt 0.1>>
			<span class="pink">你被感觉和高潮所征服，但没有任何东西流出来。</span>
			<<set $femaleclimax to 1>>
			<<semenvolume -1>>
		<<else>>
			<<if !playerHasStrapon()>>
				<<bodyliquid "penis" "semen">>
			<</if>>
			<<if wearingCondom("player")>>
				<<set _condom to $player.condom.state>>
			<</if>>
			<<if _condom is "defective">>
				<span class="red">避孕套破了。</span>
			<<elseif _condom is "sabotaged">>
				<span class="red">避孕套的尖端裂开，露出了阴茎的龟头。</span>
			<</if>>
			<<if playerHasStrapon()>>
				<span class="pink">你被快感征服，在你的假阳具的撞击下达到了高潮。</span>
			<<elseif $parasite.penis.name>>
				<span class="pink">你被快感征服，射精到了附着在阴茎上的寄生虫体内。</span>
			<<elseif _condom is "normal" or _condom is "used">>
				<span class="pink">你被快感征服，射到了避孕套里。</span>
				<<set $player.condom.state to "used">>
			<<elseif $penisuse is "othervagina">>
				<<if $NPCList[$penistarget].vagina is "penis">>
					<<personselect $penistarget>>
					<<penileejacstat>>
					<span class="pink">你被快感征服，在<<his>>的子宫深处射精。</span>
					<<purity -1>><<internalejac>><<creampie "npc" "vagina">>
					<<if $abomination is 1>>
						/*ToDo: Pregnancy, figure out how the Wraith, plantpeople, etc will handle pregnancy.*/
					<<elseif $npcrow.includes($penistarget)>>
						<<recordSperm `{target: $NPCList[$penistarget].fullDescription, spermOwner: "pc", spermType: "human", rngModifier: 100}`>>
					<<elseif $NPCList[$penistarget].pregnancy is 0 and $consensual is 1 and ["realistic", "fetish"].includes($pregnancytype)>>
						/* Pregnancy Count */
						<<set $_count to Object.values($storedNPCs).reduce((prev, curr) => {
							if(curr.pregnancy) return prev + 1;
							return prev;
						},0)>>
						/* Pregnancy chance checks */
						<<set $_impregnatedChance to 200 / (20 - $baseNpcPregnancyChance)>>
						<<if V.sexStats.pills.pills["fertility booster"].doseTaken gt 0>>
							<<set $_impregnatedChance to Math.ceil($_impregnatedChance * (1 + (V.sexStats.pills.pills["fertility booster"].doseTaken * 0.5)))>>
						<</if>>
						<<if V.sexStats.pills.pills["contraceptive"].doseTaken gt 0>>
							<<set $_impregnatedChance to Math.ceil($_impregnatedChance * 0.1)>>
						<</if>>
						/*If random NPC is impregnated, compress NPC and fetus*/
						<<if ($_impregnatedChance gte random(0,200) or _npcForceImpregnation) and $_count lte 10>>
							<<switch $NPCList[$penistarget].type>>
								<<case "human">><<set $_pregnancy to pregnancyGenerator.human(V.NPCList[$penistarget], "pc", true)>>
								<<case "wolf">><<set $_pregnancy to pregnancyGenerator.wolf(V.NPCList[$penistarget], "pc", true, "vagina", false)>>
								<<case "wolfgirl" "wolfboy">><<set $_pregnancy to pregnancyGenerator.wolf(V.NPCList[$penistarget], "pc", true, "vagina", true)>>
							<</switch>>
							<<if $_pregnancy and !(typeof $_pregnancy is "string" || $_pregnancy instanceof String)>>
								<<if random(0,2) is 0 or setup.pregnancy.randomAlwaysKeep.includes($location)>>
									<<compressNPC $penistarget "pregnancy">>
									<<set $storedNPCs[_lastCompressedName].pregnancy to $_pregnancy>>
									/* ToDo: Uncomment when compression when is ready */
									/*<<run $storedNPCs[_lastCompressedName].pregnancy.fetus.forEach((child, index, array) => array[index] to childCompressor(child, false))>>*/
								<</if>>
								<<if $pregnancytype is "fetish">><<set _npcIsNowPregnant to $NPCList[$penistarget].fullDescription>><</if>>
								<<set $NPCList[$penistarget].pregnancy to 1>>
							<</if>>
						<</if>>
					<</if>>
				<<elseif $NPCList[$penistarget].vagina is "penisimminent" or $NPCList[$penistarget].vagina is "penisentrance">>
					<<personselect $penistarget>>
					<span class="pink">你被快感征服，在<<his>>的小穴上射精。</span>
				<</if>>
			<<elseif $penisuse is "otheranus">>
				<<for $_i = 0; $_i lt $enemynomax; $_i++>>
					<<if $NPCList[$_i].penis is "otheranus" or $NPCList[$_i].vagina is "otheranus">>
						<<personselect $_i>>
						<<penileejacstat>>
						<span class="pink">你被快感征服，射在了<<his>>的菊穴里。</span>
						<<purity -1>><<internalejac>><<creampie "npc" "anus">>
					<<elseif $NPCList[$_i].penis is "otheranusimminent" or $NPCList[$_i].penis is "otheranusentrance" or $NPCList[$_i].vagina is "otheranusimminent" or $NPCList[$_i].vagina is "otheranusentrance">>
						<<personselect $_i>>
						<span class="pink">你被快感征服，射在了<<his>>的屁股上。</span>
					<</if>>
				<</for>>
			<<elseif $penisuse is "othermouth">>
				<<for $_i = 0; $_i lt $enemynomax; $_i++>>
					<<if $NPCList[$_i].mouth is "penis">>
						<<personselect $_i>>
						<<penileejacstat>>
						<span class="pink">你被快感征服，在<<his>>的口中射了出来。</span>
						<<purity -1>><<internalejac>><<creampie "npc" "mouth">>
					<<elseif $NPCList[$_i].mouth is "penisimminent" or $NPCList[$_i].mouth is "penisentrance">>
						<<personselect $_i>>
						<span class="pink">你被快感征服，射在了<<his>>的脸上。</span>
					<</if>>
				<</for>>
			<<elseif $penisuse is "otherpenis">>
				<<for $_i = 0; $_i lt $enemyno; $_i++>>
					<<if $NPCList[$_i].penis is "penis">>
						<<personselect $_i>>
						<<penileejacstat>>
						<span class="pink">你被快感征服，射在了<<his>>的阴茎上。</span>
						<<purity -1>><<internalejac>>
						<!-- <<creampie "npc" "penis">> -->
					<<elseif $NPCList[$_i].penis is "penisimminent" or $NPCList[$_i].penis is "penisentrance">>
						<<personselect $_i>>
						<span class="pink">你被快感征服，射在了<<his>>的小腹和阴茎上。</span>
					<</if>>
				<</for>>
			<<elseif $penisuse is "tentacle">>
				<<if $penisstate isnot "tentacleentrance" and $penisstate isnot "tentacleimminent">>
					<<penileejacstat>>
					<span class="pink">你被快感征服，任凭$tentaclePenis榨取着你的精液。</span>
					<<purity -1>><<internalejac>>
					<!-- <<creampie "npc" "tentacle">> -->
				<<else>>
					<span class="pink">你被快感征服，射在了$tentaclePenis上。</span>
				<</if>>
			<<elseif $mouth is "mpenisentrance">>
				<span class="pink">
					你被快感征服，一股精液从你的阴茎射在了你的
					脸<<if $rng gte 10 and $semen_amount gt ($semen_volume / 24) * 18>>和头发<<bodyliquid "hair" "semen">><</if>>上。
				</span>
				<<if $semen_amount gt ($semen_volume / 24) * 18>>
					<<bodyliquid "face" "semen">>
				<</if>>
			<<elseif $mouth is "mpenis">>
				<<if $selfsuckDepth gte 2>>
					<span class="pink">你被快感征服，一股精液从你的阴茎里喷涌而出，直接冲向你的喉咙。</span>
				<<else>>
					<span class="pink">你被快感征服，射在了自己嘴里。你全部咽了下去。</span>
				<</if>>
				<<set $_released to calculateSemenReleased()>>
				<<if $_released gt 0>>
					<<cumswallow "pc" $_released>>
				<</if>>

			<<elseif playerChastity()>>
				<span class="pink">你被快感征服，一股精液从你的阴茎喷涌而出，射到了你的$worn.genitals.cn_name_cap上。</span>
			<<elseif $leftarm is "mpenisentrance" or $rightarm is "mpenisentrance">>
				<<if $leftarm is "mpenisentrance" and $semen_amount gte random(500,1500)>>
					<<set $leftFingersSemen to 1>>
					<<set $_hand to "left hand">>
				<</if>>
				<<if $rightarm is "mpenisentrance" and $semen_amount gte random(500,1500)>>
					<<set $rightFingersSemen to 1>>
					<<set $_hand to ($_hand is undefined ? "right hand" : "hands")>>
				<</if>>
				<span class="pink">你被快感征服，一股精液从你的阴茎射出<<if $_hand>>，溅在了你的<<print $_hand.replace("left","左").replace("right","右").replace("hands","双手").replace("hand","手").replace(" ","")>><</if>>上。</span>
			<<else>>
				<span class="pink">你被快感征服，一股精液从你的阴茎中射出。</span>
			<</if>>
			<<if $semen_amount lte ($semen_volume * (6 / 24))>>
				<span class="pink">你精疲力竭，基本射不出什么东西了。</span>
				<<semenvolume -2>>
			<<elseif $semen_amount lte ($semen_volume * (12 / 24))>>
				<span class="pink">你已经快被榨干了，你的精液变得稀薄而呈水状。</span>
				<<semenvolume -1>>
			<<elseif $semen_amount lte ($semen_volume * (18 / 24))>>
				<span class="pink">反复的高潮会让你产生的精液量减少。</span>
				<<semenvolume -1>>
			<</if>>

		<</if>>
	<</if>>
	<<if $player.vaginaExist>>
		<<if !$player.penisExist>>
			<span class="pink">你被高潮带来的快感征服了。</span>
		<</if>>
		<<if $leftarm is "mvaginafist" or $rightarm is "mvaginafist">>
			<span class="pink">你的手臂肌肉紧绷，在高潮下不住地颤抖着。</span>
		<<elseif $leftarm is "mvagina" or $rightarm is "mvagina">>
			<span class="pink">你的手指紧绷着，在高潮下不住地颤抖。</span>
		<</if>>
	<</if>>

	<<if $arousalmasochism/$arousal gte 0.70>>
		<!-- If over 70% arousal is from pain, PC has added reaction NG v2.7 -->
		<span class="green">你的身体扭动着，渴望更多的疼痛。</span>
		<<masochism 5>>
	<</if>>

	<<if $masturbation_bowl is 1>><<set _liquid_collection_text to []>><</if>>
	<<if $player.penisExist>>
		<<semenOrgasm>>/*Makes changes to semen values*/
	<</if>>
	<<if $player.vaginaExist>>
		<<vaginaFluidOrgasm>>
		<<if _lube_released gt 10>>
			<span class="pink">液体从你的<<pussy>>喷涌而出,</span>
		<<elseif _lube_released gt 0>>
			<span class="pink">液体从你的<<pussy>>流出。</span>
		<</if>>
	<</if>>

	<<if $parasite.left_ear.name is "slime" and $parasite.right_ear.name is "slime">>
		<span class="blue">一股舒服的暖意在你体内扩散。</span>
		你几乎忘记了世间的纷争。你可以感觉到这是你耳朵里的史莱姆对你高潮的奖励。
		<<gcorruption>><<ltrauma>><<lstress>><<trauma -12>><<stress -12>><<corruption 2>>
		<br>
	<<elseif $parasite.left_ear.name is "slime">>
		<span class="blue">一股舒服的暖意在你体内扩散。</span>
		你几乎忘记了世间的纷争。你可以感觉到这是你左耳里的史莱姆对你高潮的奖励。
		<<gcorruption>><<ltrauma>><<lstress>><<trauma -6>><<stress -6>><<corruption 1>>
		<br>
	<<elseif $parasite.right_ear.name is "slime">>
		<span class="blue">一股舒服的暖意在你体内扩散。</span>
		你几乎忘记了世间的纷争。你可以感觉到这是你右耳里的史莱姆对你高潮的奖励。
		<<gcorruption>><<ltrauma>><<lstress>><<trauma -6>><<stress -6>><<corruption 1>>
		<br>
	<</if>>

	<!-- This code is orphaned, the $swarmchestgrab variable is not referenced or set in any other file -->
	<<if $swarmchestgrab gte 1>>
		<span class="pink">你抽搐着将<<print _swarmcreature.replace("eels","鳗鱼").replace("worms","蠕虫").replace("pale slimes","苍白史莱姆").replace("slimes","史莱姆").replace("snakes","蛇").replace("fish","鱼").replace("spiders","蜘蛛").replace("maggots","蛆虫")>>从你胸口移开。</span>
		<<set $swarmchestgrab to 0>>
	<</if>>

	<<if $orgasmcount lte 1>>
		<<set $stress -= 200>>
		<<if $drugged gte 1>>
			<<arousal -4000>><<drugs -20>>
		<<else>>
			<<arousal -8000>>
		<</if>>
		<span class="pink">你因突然的释放而颤抖。</span>
	<<elseif $orgasmcount lte 2>>
		<<set $stress -= 200>>
		<<if $drugged gte 1>>
			<<arousal -5000>><<drugs -20>>
		<<else>>
			<<arousal -9000>>
		<</if>>
		<span class="pink">你因突然的释放而颤抖。</span>
	<<elseif $orgasmcount lte 3>>
		<<set $stress -= 200>>
		<<if $drugged gte 1>>
			<<arousal -6000>><<drugs -20>>
		<<else>>
			<<arousal -10000>>
		<</if>>
		<span class="pink">你因突然的释放而颤抖。</span>
	<<elseif $orgasmcount lte 4>>
		<<set $stress -= 200>>
		<<if $drugged gte 1>>
			<<arousal -7000>><<drugs -20>>
		<<else>>
			<<arousal -10000>>
		<</if>>
		<span class="pink">你因突然的释放而颤抖。</span>
	<<elseif $orgasmcount lte 5>>
		<<set $stress -= 200>>
		<<if $drugged gte 1>>
			<<arousal -8000>><<drugs -20>>
		<<else>>
			<<arousal -10000>>
		<</if>>
		<span class="pink">你感到精疲力竭。</span>
	<<elseif $orgasmcount lte 6>>
		<<set $stress -= 100>>
		<<if $drugged gte 1>>
			<<arousal -7000>><<drugs -20>>
		<<else>>
			<<arousal -10000>>
		<</if>>
		<span class="pink">尽管感觉你已经一滴也不剩了，但性高潮还是如此强烈。</span>
	<<elseif $orgasmcount lte 7>>
		<<set $stress -= 100>>
		<<if $drugged gte 1>>
			<<arousal -6000>><<drugs -20>>
		<<else>>
			<<arousal -10000>>
		<</if>>
		<span class="pink">尽管感觉你已经一滴也不剩了，但性高潮还是如此强烈。</span>
	<<elseif $orgasmcount lte 8>>
		<<set $stress -= 100>>
		<<if $drugged gte 1>>
			<<arousal -5000>><<drugs -20>>
		<<else>>
			<<arousal -10000>>
		<</if>>
		<span class="pink">尽管感觉你已经一滴也不剩了，但性高潮还是如此强烈。</span>
	<<elseif $orgasmcount lte 9>>
		<<if $drugged gte 1>>
			<<arousal -4000>><<drugs -20>>
		<<else>>
			<<arousal -10000>>
		<</if>>
		<span class="pink">你的身体因为反复的高潮而疲惫不堪。</span>
	<<elseif $orgasmcount lte 10>>
		<<if $drugged gte 1>>
			<<arousal -3000>><<drugs -20>>
		<<else>>
			<<arousal -10000>>
		<</if>>
		<span class="pink">你的身体因为反复的高潮而疲惫不堪。</span>
	<<elseif $orgasmcount lte 11>>
		<<if $drugged gte 1>>
			<<arousal -2000>><<drugs -20>>
		<<else>>
			<<arousal -10000>>
		<</if>>
		<span class="pink">你的身体因为反复的高潮而疲惫不堪。</span>
	<<elseif $orgasmcount lte 18>>
		<<if $drugged gte 1>>
			<<arousal -2000>><<drugs -20>>
		<<else>>
			<<arousal -10000>>
		<</if>>
		<<set $stress += 100>>
		<span class="pink">反复的高潮给你带来了巨大负担，你真的不想再射了。</span>
	<<elseif $orgasmcount lte 23>>
		<<if $drugged gte 1>>
			<<arousal -2000>><<drugs -20>>
		<<else>>
			<<arousal -10000>>
		<</if>>
		<<set $stress += 100>><<combattrauma 10>>
		<span class="pink">你的精神和身体在持续不断的高潮中崩溃了。</span>
	<<else>>
		<<if $drugged gte 1>>
			<<arousal -2000>><<drugs -20>>
		<<else>>
			<<arousal -10000>>
		<</if>>
		<<set $stress += 100>><<combattrauma 10>><<pain 1>>
		<span class="red">你在如此短的时间内经历了如此多的高潮，以至于你无法再次从中获得任何快感。无论是生理上还是心理上，你都感觉非常的痛苦。</span>
	<</if>>

	<!-- Chance to get "dick drunk" after 3rd orgasm, chance is 45% for consensual and 15% otherwise, +5% for each following orgasm, but aphrodisiacs make it 100% -->
	<<if $orgasmcount gte 3 and $drunk lte 1000 and playerIsPenetrated() and $mouth isnot "mpenis">>
		<<if $drugged gt 0 or (random(1,100) + ($orgasmcount * 5) gte ($consensual ? 70 : 100))>>
			<<alcohol 25>>
			<span class="purple"><<print either("你感到头晕目眩。", "你感到头昏眼花。", "你无法正常思考。")>></span>
		<</if>>
	<</if>>
	<!-- If came while being choked -->
	<<if $neckuse is "hand" and $oxygen lt $oxygenmax>>
		<<set $chokeorgasm += 1>>
		<<if $chokeorgasm gte 35 and $choketrait isnot 1>>
			<<set $choketrait = 1>>
			<br><span class="green">窒息使你的快感更加的强烈。</span>
		<</if>>
	<</if>>
	<<if ($halloween is 1 or $NPCList[0].fullDescription is "Ivory Wraith") and random(1, 10000) is 10000>>
		<span class="pink">捉鬼让你感觉良好。</span>
	<</if>>
	<br><br>
	<<if $orgasmtrait gte 1>>
		<<set $stress -= 100>>
	<</if>>

	<<set $orgasmcurrent += 1>>
	<<wetnessCalculate>>

	<<if $masturbation_bowl is 1>>
		<<if $masturbation_milk gt 0>>
			<<set _liquid_collection_text.push($masturbation_milk.toFixed(1) + " mL 牛奶")>>
		<</if>>
		<<if _liquid_collection_text.length is 0>>
			<span class="purple">你什么都没收集到。</span>
		<<else>>
			<span class="gold">你收集了<<print formatList(_liquid_collection_text, "和", true,"、")>>。</span>
		<</if>>
		<br>
	<</if>>
<</widget>>

<<widget "orgasmstreet">>
	<<orgasm>>
	<<if $exposed gte 1>>
		<<if Time.dayState isnot "night">>
			随着痉挛消退，你重新控制住自己，感觉自己暴露在外，你希望噪音没有暴露你的藏身之处。
		<<else>>
			随着痉挛消退，你平静了下来。强烈的裸露感充斥着你，你希望噪音没有引起别人的注意。
		<</if>>
	<<else>>
		<<if Time.dayState isnot "night">>
			你在高潮中抽搐的景象和声音吸引了人们的注意。当你释放完毕，重新冷静下来的时候，你发现四面八方的人都在盯着你……你红着脸逃离了现场。
			<<gtrauma>><<gstress>><<trauma 6>><<stress 6>><<fameexhibitionism 10>>
		<<else>>
			随着痉挛消退，你重又平静了下来。你希望声音没有引起别人的注意。
		<</if>>
	<</if>>
	<br><br>
<</widget>>

<<widget "orgasmforest">>
	<<orgasm>>
	<<if $exposed gte 1>>
		<<if Time.dayState isnot "night">>
			当你的痉挛消退时，你靠在一棵树上稳住自己。
		<<else>>
			当你的痉挛消退时，你靠在一棵树上稳住自己。
		<</if>>
	<<else>>
		<<if Time.dayState isnot "night">>
			当你的痉挛消退时，你靠在一棵树上稳住自己。
		<<else>>
			当你的痉挛消退时，你靠在一棵树上稳住自己。
		<</if>>
	<</if>>
	<br><br>
<</widget>>

<<widget "orgasmbeach">>
	<<orgasm>>
	<<if $exposed gte 1>>
		<<if Time.dayState isnot "night">>
			随着痉挛消退，你重新控制住自己，感觉自己暴露在外，你希望噪音没有暴露你的藏身之处。
		<<else>>
			随着痉挛消退，你重新控制住自己，感觉自己暴露在开阔的海滩上。
		<</if>>
	<<else>>
		<<if Time.dayState isnot "night">>
			你在高潮中抽搐的景象和声音吸引了人们的注意。当你释放完毕，重新冷静下来的时候，你发现整个海滩的人都在盯着你……你红着脸逃离了现场。
			<<gtrauma>><<gstress>><<trauma 6>><<stress 6>><<fameexhibitionism 10>>
		<<else>>
			随着痉挛消退，你重新控制住自己，感觉自己暴露在开阔的海滩上。
		<</if>>
	<</if>>
	<br><br>
<</widget>>

<<widget "orgasmstage">>
	<<if $exhibitionism gte 75 and $backgroundTraits.includes("lustful") and $orgasmtrait gte 1>>
		强烈的高潮即将冲击着你。
		<br><br>
		你被你的<span class="lewd">性欲</span>和<span class="lewd">享乐主义</span>蒙蔽了双眼，你
		<<if $exposed lte 1 and $leftarm isnot "bound" and $rightarm isnot "bound">>
			扯掉仍然覆盖在你身上的衣服，
			<<clothesstrip>>
		<</if>>
		跪在舞台边缘，将你赤裸裸的<<body_size_text>>，以及<<breastsensitivity>><<breasts>>呈现在人群的面前。
		手伸出来摸你。<<arousal 500 "breasts">><<garousal>>
		<br><br>
		<<set $audience += 26>>
		/* Fills all unoccupied NPC slots; generatel not to be confused with generate1 */
		<<if $enemyno is 0>>
			<<generatel>><<generatel>><<generatel>><<generatel>><<generatel>><<generatel>>
		<<elseif $enemyno is 1>>
			<<generatel>><<generatel>><<generatel>><<generatel>><<generatel>>
		<<elseif $enemyno is 2>>
			<<generatel>><<generatel>><<generatel>><<generatel>>
		<<elseif $enemyno is 3>>
			<<generatel>><<generatel>><<generatel>>
		<<elseif $enemyno is 4>>
			<<generatel>><<generatel>>
		<<elseif $enemyno is 5>>
			<<generatel>>
		<</if>>
		你的腿和腹肌绷紧着，胯部在不断地抽搐与颤抖……观众们纷纷为你而喝彩。你呻吟着，痉挛着，痛苦和快感不断地交织着。
		<br><br>
		<<orgasm>>
		过了一会儿，痉挛消退了，你喘息着栽在了地板上。音乐声停止了。
		汗液，泪液，还有爱液……人们围拥着你的身体，目光肆意地扫略着。
		<br><br>
		你颤抖着站起身来，缓缓地面对人群鞠躬。热烈的掌声在你的周身响彻。
		<<fameexhibitionism 15>>
		<<set $audiencearousal += 80>>
		<<set $audienceexcitement += 50>>
		<<set $audiencemod += 5>>
	<<else>>
		突然的高潮席卷了你的全身，扰乱了你的舞步。<<orgasm>>
		<<if currentSkillValue('danceskill') lte 500>>
			一瞬间的走神，你的身子开始摇晃。你试图恢复平衡，但你的膝盖一软，跪倒在了地上。
			聚集的人群嘲弄着你，纷纷开始取笑你的舞技。
			<br><br>

			<<if $worn.feet.type.includes("heels")>>
				你试着爬起来，但高潮的颤抖使你的身子无法再保持平稳。
				你一个没站稳轰然倒地，身体的重量还折断了一个鞋跟。
				你再次摔倒在地……又是一阵笑声。<<ggpain>><<pain 10>>
				<<feetruined>>
				<br><br>
			<</if>>
			<<if $dancelocation is "smuggler_forced" or $dancelocation is "underground">>
				强烈的羞耻促使着你逃跑——但你能去哪儿呢？你哪里也跑不掉。
				<<ggtrauma>><<gggstress>><<trauma 12>><<stress 24>>
			<<else>>
				<<tearful>>你踉跄着走出众人的视线。满脸通红，羞愧难当。
				<<gtrauma>><<gstress>><<trauma 10>><<stress 10>>
				<<set $danceevent to "finish">>
			<</if>>
		<<elseif currentSkillValue('danceskill') gte 500 and $exhibitionism gte 55 and $promiscuity gte 55>>
			在你彻底倒下之前，你跪了下去。你的<<body_size_text>>因剧烈快感所带来的痉挛而疼痛不已，但群众们依旧为你欢呼雀跃。
			<br><br>
			你站颤抖着站了起来，在人群的嘲弄声中继续起舞。
			<<fameexhibitionism 15>>
			<<set $audiencearousal += 10>>
			<<set $audienceexcitement += 5>>
			<<set $audiencemod += 2>>
		<<else>>
			你试图用你的舞蹈动作掩盖你颤抖的<<body_size_text>>。
			<<if $dancelocation is "smuggler_forced" or $dancelocation is "underground">>
				这种羞辱让人难以忍受，但你因为害怕绑架者而留在原地。
				<<trauma 10>><<stress 12>><<gtrauma>><<ggstress>>
			<<else>>
				但这实在让人难以承受。你尽可能体面地逃离现场。
				<<gtrauma>><<gstress>><<trauma 5>><<stress 5>>
				<<set $danceevent to "finish">>
			<</if>>
		<</if>>
	<</if>>
<</widget>>

<<widget "orgasmLocation">>
	<<orgasm>>
	<<switch _args[0]>>
		<<case "schoolHallway">>
			<<if ["early","late","earlynoschool","latenoschool","daynoschool"].includes($schoolstate)>>
				随着痉挛消退，你重又平复了下来。幸好走廊现在空无一人，希望声音没有引起别人注意。
			<<elseif $exposed gte 1>>
				<<set $_hidden to true>>
			<<else>>
				你在高潮中抽搐的景象和声音吸引了别人的注意。当你释放完毕，重新冷静下来的时候，你发现四面八方的学生都在盯着你……走廊里开始窃窃私语起来。你红着脸转过角落，离开了他们的视线。
				<<gtrauma>><<gstress>><<trauma 6>><<stress 6>><<fameexhibitionism 10>>
			<</if>>
		<<case "emptyClassroom">>
			随着痉挛消退，你重又平复了下来。幸好教室现在空无一人，希望声音没有引起别人注意。
		<<case "classroom">>
			<<if $schoolstate is "second" and ($whitneymaths is "active" or $whitneymaths is "seat")>>
				惠特尼看到你高潮的样子，笑了起来。
				<<npcincr Whitney lust 1>><<glust>>
				<br><br>
			<<elseif $schoolstate is "third" and ($kylarenglishstate is "watching" or $kylarenglishstate is "seat")>>
				凯拉尔欣赏着你高潮的姿态，神情异常的着迷。
				<<npcincr Kylar lust 1>><<glust>>
				<br><br>
			<<elseif $schoolstate is "fourth" and $robinhistory is "seat">>
				罗宾礼貌地努力把目光移开，但最终还是偷看了一眼。
				<<npcincr Robin lust 1>><<glust>>
				<br><br>
			<</if>>
			你设法阻止自己的呻吟，但不住的痉挛向周围的同学告示了你的高潮。教室里开始有人窃窃私语，但很快便被<<print _teacher>>制止住了。<<nnpc_He _teacher>>虽然不知道原因，但知道你是班上的话题中心。
			<<gtrauma>><<gstress>><<trauma 6>><<stress 6>><<fameexhibitionism 10>><<detention 1>><<gdelinquency>>
		<<case "swimClassroom">>
			你设法阻止自己的呻吟，以免引起梅森的注意。然而，你的身体在水中不断地抽搐着，不住的痉挛向周围的同学告示了你的高潮。泳池中开始有人窃窃私语。<<gtrauma>><<gstress>><<trauma 6>><<stress 6>><<fameexhibitionism 10>>
		<<case "emptySwimClassroom">>
			随着痉挛消退，你重又平复了下来。幸好泳池现在空无一人，希望声音没有引起别人注意。
		<<case "canteen">>
			<<if ["early","late","earlynoschool","latenoschool","daynoschool"].includes($schoolstate)>>
				随着痉挛消退，你重又平复了下来。幸好食堂现在空无一人，希望声音没有引起别人注意。
			<<elseif $exposed gte 1>>
				<<set $_hidden to true>>
			<<else>>
				你在高潮中抽搐的景象和声音吸引了人们的注意。当你释放完毕，重新冷静下来的时候，你发现四面八方的同学都在盯着你。同学们面面相觑，开始窃窃私语。你红着脸躲了起来。
				<<gtrauma>><<gstress>><<trauma 6>><<stress 6>><<fameexhibitionism 10>>
			<</if>>
		<<case "library">>
			<<if ["early","late","earlynoschool","latenoschool","daynoschool"].includes($schoolstate)>>
				随着痉挛消退，你重又平复了下来。幸好图书馆现在空无一人，希望声音没有引起别人注意。
			<<elseif $exposed gte 1>>
				<<set $_hidden to true>>
			<<else>>
				你在高潮中抽搐的景象和声音吸引了人们的注意。当你释放完毕，重新冷静下来的时候，你发现四面八方的同学都在盯着你。图书馆里开始有人窃窃私语。
				<<gtrauma>><<gstress>><<trauma 6>><<stress 6>><<fameexhibitionism 10>>
				<<if $sydneySeen and _sydney_location is "library">>
					<br><br>
					悉尼清了清<<nnpc_his "Sydney">>的嗓子，周围瞬间安静了下来。
				<</if>>
			<</if>>
		<<case "boyChangingRoom">>
			<<if $changingroomstate is "empty">>
				随着痉挛消退，你重新控制住自己，你庆幸室内现在空无一人，希望声音没有引起别人注意。
			<<elseif $player.gender_appearance is "f">>
				<<girl>>在高潮中抽搐的样子和发出的声音刺激着<<if $changingRoomGender is "girls">>女孩<<else>>男孩<</if>>们。他们的反应各不相同。有些人为你加油。有些人试图把目光移开。还有一些人对你大声辱骂。
				<<gtrauma>><<gstress>><<trauma 6>><<stress 6>><<fameexhibitionism 10>>
			<<else>>
				一个<<girl>>在高潮中抽搐的景象和声音吸引了人们的注意，当你重新控制住自己时，你发现四面八方的同学们都在盯着你看。课室里开始有人窃窃私语。你红着脸转过身去藏起你的脸。
				<<gtrauma>><<gstress>><<trauma 6>><<stress 6>><<fameexhibitionism 10>>
			<</if>>
		<<case "girlChangingRoom">>
			<<if $changingroomstate is "empty">>
				随着痉挛消退，你重新控制住自己，你庆幸室内现在空无一人，希望声音没有引起别人注意。
			<<elseif $player.gender_appearance is "m">>
				<<girl>>在高潮中抽搐的样子和发出的声音刺激着<<if $changingRoomGender is "girls">>女孩<<else>>男孩<</if>>们。他们的反应各不相同。有些人为你加油。有些人试图把目光移开。还有一些人对你大声辱骂。
				<<gtrauma>><<gstress>><<trauma 6>><<stress 6>><<fameexhibitionism 10>>
			<<else>>
				一个<<girl>>在高潮中抽搐的景象和声音吸引了人们的注意，当你重新控制住自己时，你发现四面八方的同学们都在盯着你看。课室里开始有人窃窃私语。你红着脸转过身去藏起你的脸。
				<<gtrauma>><<gstress>><<trauma 6>><<stress 6>><<fameexhibitionism 10>>
			<</if>>
		<<case "policeStation">>
			<<if Time.dayState is "night">>
				<<set $_quiet to "police station">>
			<<else>>
				一个<<girl>>在高潮中抽搐的景象和声音吸引了警察局内的人的注意。他们的反应不一。有些提出投诉的巿民回避视线。有些更为粗鲁的人大声为你欢呼喝彩。当你重新控制住自己时，你看到两个警察朝你的方向走来。你脸红了，决定最好逃离现场。
				<<gtrauma>><<gstress>><<trauma 6>><<stress 6>><<fameexhibitionism 10>>
			<</if>>
		<<case "danceStudio">>
			<<if $openinghours is 0 and Time.hour isnot $closinghour>>
				<<set $_quiet to "studio">>
			<<elseif $exposed gte 1>>
				<<set $_hidden to true>>
			<<else>>
				<<girl>>在高潮中抽搐的景象和发出的声音吸引了摄影棚里的人的注意。他们的反应很复杂。有些人避而不看。有些人不高兴地盯着你看。还有些人为你加油。当你回过神时，你注意到演播室变得非常喧闹。你红着脸试着让自己降低存在感。
				<<gtrauma>><<gstress>><<trauma 6>><<stress 6>><<fameexhibitionism 10>>
			<</if>>
		<<case "pound">>
			一个<<girl>>在高潮中抽搐的景象和声音吸引了<<pound_text>>的注意，他们好奇地看着你摇着身子稳定自己。
			<<gtrauma>><<gstress>><<trauma 6>><<stress 6>>
		<<case "danceStudioLesson">>
			一个<<girl>>在高潮中抽搐的景象和声音吸引了舞蹈室内的人的注意。他们都专注于自己的舞蹈中，大多反应沉默，只有偶尔瞥你一眼。当你重新控制住自己时，你注意到查里脸红了。
			<<gtrauma>><<gstress>><<trauma 6>><<stress 6>><<fameexhibitionism 10>><<npcincr Charlie love 1>>
		<<case "danceStudioHeelLesson">>
			一个<<girl>>在高潮中抽搐的景象和声音吸引了舞蹈室内的人的注意。他们都专注于查里，大多反应沉默，只有偶尔瞥你一眼。当你重新控制住自己时，你注意到查里脸红了。
			<<gtrauma>><<gstress>><<trauma 6>><<stress 6>><<fameexhibitionism 10>><<npcincr Charlie love 1>>
		<<case "cafe">>
			<<if $openinghours is 0>>
				<<set $_quiet to "cafe">>
			<<elseif $exposed gte 1>>
				<<set $_hidden to true>>
			<<else>>
				一个<<girl>>在高潮中抽搐的景象和声音引起了顾客们的注意。他们的反应不一。有的人避而不见，有些人恼怒地盯着你，但也有人为你欢呼。当你重新控制住自己时，你注意到咖啡馆里变得多么喧闹。你涨红了脸，尽量让自己看起来渺小而不起眼。
				<<gtrauma>><<gstress>><<trauma 6>><<stress 6>><<fameexhibitionism 10>>
			<</if>>
		<<case "arcade">>
			<<if Time.dayState is "night" or Time.dayState is "dawn">>
				<<set $_quiet to "arcade">>
			<<else>>
				随着痉挛消退，你重新控制住自己。幸运的是，嘈杂的环境声抑制了你的呻吟，昏暗的灯光让你的痉挛难以察觉。你环顾四周，注意到一个<<generatey1>><<person1>><<person>>正盯着你看，一脸惊讶和难以置信。 然而，<<His>>的注意力很快又回到了<<he>>正在玩的游戏上。
				<<endevent>>
				<<gtrauma>><<gstress>><<trauma 6>><<stress 6>><<fameexhibitionism 10>>
			<</if>>
		<<case "docks">>
			<<if Time.dayState is "night">>
				<<set $_quiet to "docks">>
			<<else>>
				随着痉挛消退，你重新控制住自己。你环顾四周，似乎没有人注意到你的高潮。直到你注意到一个<<generate1>><<person1>><<person>>远远地看着你。<<He>>给了你一个笑容，然后回去工作。
				<<endevent>>
				<<gtrauma>><<gstress>><<trauma 6>><<stress 6>><<fameexhibitionism 10>>
			<</if>>
		<<case "stripClub">>
			<<if Time.dayState isnot "night" and Time.dayState isnot "dusk" and Time.hour isnot 6>>
				<<set $_quiet to "club">>
			<<else>>
				随着痉挛消退，你重新控制住自己。幸运的是，嘈杂的环境声抑制了你的呻吟，昏暗的灯光让你的痉挛难以察觉。你环顾四周，注意到一位顾客正盯着你看。 然而，<<generate1>><<person1>><<He>>只是给了你一个笑容，然后起身离开。
				<<endevent>>
				<<gtrauma>><<gstress>><<trauma 6>><<stress 6>><<fameexhibitionism 10>>
			<</if>>
		<<case "shoppingCentre">>
			<<if Time.dayState is "night">>
				<<set $_quiet to "shopping centre">>
			<<elseif $exposed gte 1>>
				<<set $_hidden to true>>
			<<else>>
				一个<<girl>>在高潮中抽搐的景象和声音吸引了其他购物者的注意。他们的反应不一。有些人回避视线。有些人不高兴地盯着你。但有些人也会为你欢呼喝彩。当你重新控制住自己时，你注意到这个地方变得多么吵闹。你脸红着逃到一个角落。
				<<gtrauma>><<gstress>><<trauma 6>><<stress 6>><<fameexhibitionism 10>>
			<</if>>
		<<case "museum">>
			<<if Time.dayState is "night">>
				<<set $_quiet to "museum">>
			<<else>>
				一个<<girl>>在高潮中抽搐的景象和声音吸引了其他访客的注意。当你重新控制住自己时，你发现四面八方的人都在盯着你看。你红着脸逃离现场。
				<<gtrauma>><<gstress>><<trauma 6>><<stress 6>><<fameexhibitionism 10>>
			<</if>>
		<<case "brothel">>
			一个<<girl>>在高潮中抽搐的景象和声音引起了注意。妓院里的人一边为你喝彩，一边喊着各种脏话。当你重新控制住自己时，你注意到这个地方变得多么吵闹。你红着脸消失在拥挤处。
			<<gtrauma>><<gstress>><<trauma 6>><<stress 6>><<fameexhibitionism 10>>
		<<case "pub">>
			一个<<girl>>在高潮中抽搐的景象和声音引起了关注。酒吧里的人一边为你喝彩，一边喊着各种下流话。当你重新控制住自己时，你才注意到这个地方已变得有多么喧闹。你红着脸消失在了人群中。
			<<gtrauma>><<gstress>><<trauma 6>><<stress 6>><<fameexhibitionism 10>>
		<<case "spa">>
			<<if $openinghours is 0 and Time.hour isnot $closinghour>>
				<<set $_quiet to "spa">>
			<<else>>
				一个<<girl>>在高潮中抽搐的景象和声音吸引了顾客们的注意。他们的反应不一。有些人回避视线。有些人不高兴地盯着你。但有些人也会为你欢呼喝彩。当你重新控制住自己时，你注意到水疗中心变得多么吵闹。你红着脸躲在日晒床后面。
				<<gtrauma>><<gstress>><<trauma 6>><<stress 6>><<fameexhibitionism 10>>
			<</if>>
		<<case "temple">>
			<<if Time.dayState is "night">>
				<<set $_quiet to "temple walls">>
			<<elseif $exposed gte 1>>
				<<set $_hidden to true>>
			<<else>>
				一个<<girl>>在高潮中抽搐的景象和声音引起了注意。普遍的沉默只会让你的呻吟更加明显。大多数人都用蔑视的眼光看着你，但也有一些用好色的目光注视着。当你重新控制住自己时，你发现四面八方的人都在盯着你看。你红着脸躲在长椅后面。
				<<gtrauma>><<gstress>><<trauma 6>><<stress 6>><<fameexhibitionism 10>>
			<</if>>
		<<case "hospital">>
			<<if Time.dayState is "night">>
				<<set $_quiet to "hospital">>
			<<elseif $exposed gte 1>>
				<<set $_hidden to true>>
			<<else>>
				一个<<girl>>在高潮中抽搐的景象和声音引起了注意。医院里的人反应不一。有些人回避视线。有些人不高兴地盯着你。但有些人也会为你欢呼喝彩。当你重新控制住自己时，你注意到这个地方变得多么吵闹。你试图假装这是一种病症。
				<<gtrauma>><<gstress>><<trauma 6>><<stress 6>><<fameexhibitionism 10>>
			<</if>>
		<<case "countryside">>
			<<switch random(1,10)>>
				<<case 1 2 3>>
					随着痉挛消退，你重新控制住自己。一辆车从你身边经过。你想知道里面的人是否注意到你的高潮。
					<<gtrauma>><<gstress>><<trauma 6>><<stress 6>>
				<<case 4>>
					随着痉挛消退，你重新控制住自己。一辆卡车从你身边经过。你想知道司机是否注意到你的高潮。
					<<gtrauma>><<gstress>><<trauma 6>><<stress 6>>
				<<case 5>>
					随着痉挛消退，你重新控制住自己。一辆拖拉机从你身边经过。你想知道农夫是否注意到你的高潮。
					<<gtrauma>><<gstress>><<trauma 6>><<stress 6>>
				<<default>>
					<<set $_quiet to "countryside">>
			<</switch>>
		<<case "meadow">>
			<<if $rng gte 91>>
				你紧抓住叶片，随着痉挛消退，你重新控制住自己。你以为周围没有人在听，但你注意到一只
				<<if ($monsterchance gte 1 and $hallucinations gte 1) or ($monsterchance gte 1 and $monsterhallucinations is "f") or ($bestialitydisable is "t")>>
					<<if maleChance() lt random(1, 100)>>狐狸少女<<else>>狐狸少年<</if>>
				<<else>>
					狐狸
				<</if>>
				躲在草丛里盯着你。你还没来得及逃离，它就跑走了。
				<<gtrauma>><<gstress>><<trauma 6>><<stress 6>>
			<<else>>
				你紧抓住叶片，随着痉挛消退，你重新控制住自己。高潮的声音随风散开，幸好周围没有人听到。
			<</if>>
		<<case "alexFarmWork">>
			<<if Time.dayState is "night">>
				随着痉挛消退，你重新控制住自己，希望声音没有打扰到动物们。
			<<elseif ($exposed gte 2 and $uncomfortable.nude is true) or ($exposed is 1 and $uncomfortable.underwear is true)>>
				<<set $_hidden to true>>
			<<elseif ["shower","tending","admin","clearing"].includes($farm_work.alex)>>
				一个<<girl>>在高潮中抽搐的景象和声音激怒了你周围的动物。幸运的是，艾利克斯不在身边，不会看到你这种状态。你重新控制住自己，回去工作。
			<<else>>
				一个<<girl>>在高潮中抽搐的景象和声音激怒了你周围的动物。艾利克斯注意到了细微的骚动，看着你的高潮消退。你脸涨得通红，你们都避免眼神接触，努力装作什么都没发生。
				<<gtrauma>><<gstress>><<trauma 6>><<stress 6>><<npcincr Alex lust 1>><<glust>>
			<</if>>
		<<case "alexFarmTending">>
			注意到你的痉挛，艾利克斯过来看看你。然而，当<<nnpc_he "Alex">>明白了发生什么事，<<nnpc_he "Alex">>停了下来，看着你的高潮消退。你脸涨得通红，你们都避免眼神接触，努力装作什么都没发生。
			<<gtrauma>><<gstress>><<trauma 6>><<stress 6>><<npcincr Alex lust 1>><<glust>>
		<<case "alexFarmTendingAlone">>
			随着痉挛消退，你重新控制住自己，并为艾利克斯现在不在身边，不会看到你这种状态而感到庆幸。
		<<case "alexFarmAdmin">>
			你大声的呻吟声引起了艾利克斯和电话对面的注意。 "我、我很抱歉，"<<nnpc_he "Alex">>口吃着："那、那只是风声。"
			<br><br>
			<<nnpc_He "Alex">>的脸涨得通红地继续打电话，随着你的痉挛消退，你们都避免眼神接触。
			<<gtrauma>><<gstress>><<trauma 6>><<stress 6>><<npcincr Alex lust 1>><<glust>>
		<<case "sewers">>
			你响亮的呻吟声回荡在隧道里。
			<<if _args[1]>>
				当你的痉挛消退时，你希望声音没有引起别人更多的注意。
				<<gtrauma>><<gstress>><<trauma 6>><<stress 6>>
				<<set $sewerschasedstep -= 1>>
			<<else>>
				当你的痉挛消退时，你希望声音没有引起别人注意。
			<</if>>
		<<case "lake">>
			<<if _args[1]>>
				当你的痉挛消退时，你靠在一棵树上稳住自己。幸运的是，现在周围没有人看到你这种状态。
			<<elseif $exposed gte 1>>
				<<set $_hidden to true>>
			<<else>>
				随着痉挛消退，你重新控制住自己。幸运的是，嘈杂的环境声抑制了你的呻吟，树叶为你的痉挛提供了掩护。你环顾四周，注意到一个<<generatey1>><<person1>><<person>>正盯着你看。<<He>>给了你一个笑容，然后回到<<his>>的朋友身边。
				<<endevent>>
				<<gtrauma>><<gstress>><<trauma 6>><<stress 6>><<fameexhibitionism 10>>
			<</if>>
		<<case "campsite">>
			<<if $weather is "rain" or $weather is "snow" or Time.hour lt 18 or $daily.lakeCouple is 1>>
				当你的痉挛消退时，你靠在一棵树上稳住自己。幸运的是，现在周围没有人看到你这种状态。
			<<elseif $exposed gte 1>>
				<<set $_hidden to true>>
			<<else>>
				一个<<girl>>在高潮中抽搐的景象和声音吸引了露营人士们的注意。他们看起来很惊讶，但很快就对你的淫荡表现露出微笑。当你重新控制自己时，你注意到他们好色的目光。你红着脸逃离现场。
				<<gtrauma>><<gstress>><<trauma 6>><<stress 6>><<fameexhibitionism 10>>
			<</if>>
		<<case "moor">>
			你差点跌倒在草地上，但随着高潮的消退，你重新控制住自己。
	<</switch>>
	<<if $_hidden>>
		随着痉挛消退，你重新控制住自己，感觉自己暴露在外，你希望噪音没有暴露你的藏身之处。
	<</if>>
	<<if $_quiet>>
		你响亮的呻吟声回荡在空无一人的<<print $_quiet>>。当你的痉挛消退时，你希望声音没有引起别人注意。
	<</if>>
	<br><br>
<</widget>>

<<widget "breastfeed">>
	<<set $_milk_released to random(10, 50)>>
	<<if $cow gte 6>>
		<<set $_milk_released *= 2>>
	<</if>>
	<<set $_milk_released /= 10>>
	<<set $_milk_released to parseFloat($_milk_released.toFixed(1))>>

	<<if _args[0]>><<set $_milk_released *= _args[0]>><</if>>

	/* if the player doesn't have enough milk, set $_milk_released to whatever they have left */
	<<if $milk_amount lt $_milk_released>>
		<<set $_milk_released to $milk_amount>>
	<</if>>
	<<set $milk_produced_stat += Math.trunc($_milk_released)>>

	<<milkvolume 1>>

	<<if $worn.over_upper.exposed is 0 and $worn.upper.exposed is 0 and $worn.under_upper.exposed is 0>>
	<<else>>
		<<if $masturbating>>
			<<set $masturbation_milk += $_milk_released>>
		<</if>>
		<<if $masturbation_bowl is 1>>
			<!-- If the player is using both hands, only print this text the second time, and report the total milk released this turn -->
			<<set _milk_this_turn to (_milk_this_turn is undefined ? $_milk_released : _milk_this_turn + $_milk_released)>>
			<!-- _args[0] is how many times this widget has been called this turn -->
			<span class="gold">你收集了<<print (_milk_this_turn).toFixed(1)>>毫升的母乳。</span>
		<<elseif $leftaction is "mbreastpumppump" or $rightaction is "mbreastpumppump">>
			<span class="gold">你储存了<<print ($_milk_released).toFixed(1)>>mL你的乳汁。</span>
		<</if>>
	<</if>>

	<<milk_amount `-$_milk_released`>>
<</widget>>

<<widget "orgasmHourlyRecovery">>
	<<if $purity gte 990>>
		<<orgasmcount -1>>
	<<else>>
		<<set _orgmod to Math.floor((1100-$purity)/100)>>
		<<set _orgmod to Math.clamp(_orgmod, 2, 11)>>
		<<orgasmcount `-_orgmod`>>
	<</if>>
	<<if $cow gte 6>>
		<<semenvolume 1>>
		<<milkvolume 1>>
	<</if>>
	<<if $player.penisExist>>
		<<if $arousal gte $arousalmax * (4/5)>>
			<<set $_semen_gain to Math.floor($semen_volume * (3/24))>>
		<<elseif $arousal gte $arousalmax * (3/5)>>
			<<set $_semen_gain to Math.floor($semen_volume * (2/24))>>
		<<else>>
			<<set $_semen_gain to Math.floor($semen_volume * (1/24))>>
		<</if>>
		<<if $cow gte 6>>
			<<set $_semen_gain *= 2>>
		<</if>>
		<<if $drugged gte 1>>
			<<set $_semen_gain += Math.floor($semen_volume * (1/24))>>
		<</if>>
		<<semen_amount $_semen_gain>>

		<<if $semen_amount gte $semen_volume>>
			<<if $arousal gte $arousalmax * (4/5)>>
				<<semenvolume 2>>
			<<elseif $arousal gte $arousalmax * (3/5)>>
				<<semenvolume 1>>
			<</if>>
			<<if $drugged gte 1>>
				<<semenvolume 1>>
			<</if>>
			<<set $semen_amount to $semen_volume>>
		<</if>>
	<</if>>
	<<milk_amount `Math.floor(($milk_volume / 24))`>>
	<<if $milk_amount is $milk_volume and $lactating>>
		<<set $milkFullPain to Math.clamp(($milkFullPain || 0) + Math.ceil($milk_volume / 1000),0,200 + Math.ceil($milk_volume / 60))>>
	<<else>>
		<<set $milkFullPain to 0>>
	<</if>>
<</widget>>

<<widget "semenOrgasm">>
	<<set $_semen_released to calculateSemenReleased()>>

	<<if $semen_amount gte 1 and $worn.under_lower.vagina_exposed is 1 and $worn.lower.vagina_exposed is 1 and $mouth isnot "mpenis">>
		<<if $masturbating>>
			<<set $masturbation_semen += $_semen_released>>
		<</if>>
		<<if $masturbation_bowl is 1>>
			<<set _liquid_collection_text.push($masturbation_semen.toFixed(1) + " mL <<semen>>")>>
		<</if>>
	<</if>>

	<<if $femaleclimax isnot 1>>
		<<semenvolume 1>>
	<</if>>

	<<set $semen_produced_stat += $_semen_released>>
	<<semen_amount `-$_semen_released`>>
	<<set _semen_released to $_semen_released>>
<</widget>>

<<widget "wetnessCalculate">>
	<<if $player.vaginaExist>>
		<<vaginaWetnessCalculate>>
	<</if>>
	<<if $player.penisExist>>
		<<set $penisWetness to setup.bodyliquid.combined("penis") * 12>>
		<<set $penisWetness to Math.clamp($penisWetness, 0, 120)>>
	<</if>>
	<<set $anusWetness to (setup.bodyliquid.combined("anus") + setup.bodyliquid.combined("bottom")) * 6>>
	<<set $anusWetness to Math.clamp($anusWetness, 0, 120)>>
	<<if $combat is 1>>
		<<penetrationPainCalculate>>
	<</if>>
<</widget>>

<<widget "vaginaWetnessCalculate">>
	<<set _totalArousal = 0>>
	<<set _length to $trackedArousal.length>>
	<<for _ia to 0; _ia lt _length; _ia++>>
		<<set _totalArousal += $trackedArousal[_ia] / ((_length - _ia) * 1.5)>>
	<</for>>
	<<if $combat is 1>>
		<!-- combatWetBoost can be from 0 to 5, because max promiscuity/deviancy is 100. -->
		<<if $enemytype is "man">>
			<<set $combatWetBoost to Math.floor($promiscuity /20)>>
		<<elseif $enemytype is "tentacles" or $enemytype is "beast">>
			<<set $combatWetBoost to Math.floor($deviancy /20)>>
		<<else>>
			<<set $combatWetBoost to 0>>
		<</if>>
		<!-- combatArousalWetness has been replaced by vaginaArousalWetness but I don't want to remove it completely so it's commented out for now. -->
		/* <<set $_combatArousalWetness to 75 - Math.floor(Math.pow(0.99985,_totalArousal) * 75)>>
		<<set $combatWetBoost += $_combatArousalWetness>> */
	<<else>>
		<<set $combatWetBoost to 0>>
	<</if>>

	<<set $vaginaWetness to $vaginaArousalWetness + $combatWetBoost + (setup.bodyliquid.combined("vagina") + setup.bodyliquid.combined("vaginaoutside")) * 6>>
	<<set $vaginaWetness to Math.clamp($vaginaWetness, 0, 120)>>
<</widget>>

<<widget "penetrationPainCalculate">>
	<<set $vaginalPain to 0>>
	<<set $analPain to 0>>
	<<set $penisPain to 0>>
	<<if $demon lt 6 and $gamemode isnot "soft">>
		<<if $player.vaginaExist>>
			<<if $consensual is 1>>
				<<set $vaginalPain to Math.floor(3 * Math.pow(0.4,$vaginaWetness/8))>>
			<<else>>
				<<set $vaginalPain to Math.floor(6 * Math.pow(0.5,$vaginaWetness/25))>>
			<</if>>
		<</if>>
		<<if $player.penisExist>>
			<<if $consensual is 1>>
				<<set $penisPain to Math.floor(3 * Math.pow(0.4,$penisWetness/8))>>
			<<else>>
				<<set $penisPain to Math.floor(6 * Math.pow(0.5,$penisWetness/25))>>
			<</if>>
		<</if>>
		<<if $consensual is 1>>
			<<set $analPain to Math.floor(3 * Math.pow(0.4,$anusWetness/8))>>
		<<else>>
			<<set $analPain to Math.floor(6 * Math.pow(0.5,$anusWetness/25))>>
		<</if>>
		<<if $gamemode is "hard">>
			<<set $vaginalPain *= 2>>
			<<set $penisPain *= 2>>
			<<set $analPain *= 2>>
		<</if>>
	<</if>>
<</widget>>

<!-- Lube is only released when vaginaArousalWetness is over 60 (also, its max value is 100)-->
<!-- "passive" means the lube is dripping out, while "active" means it is being pushed out -->
<<widget "vaginaFluidPassive">>
	<<set $_lube_max to Math.round(30*Math.log10($vaginaArousalWetness - 59))>>
	<<set _lube_released to random(0, $_lube_max)/20>>
	<!-- Expected value is between 0 and 2.5, much more likely to be on the lower end due to wetness having a softcap -->
	<<set _lube_released to parseFloat(_lube_released.toFixed(1))>>

	<<set $masturbation_vaginaFluid += _lube_released>>
	<<set $lube_produced_stat += _lube_released>>
<</widget>>

<<widget "vaginaFluidActive">>
	<<set $_lube_max to Math.ceil(30*Math.log10($vaginaArousalWetness - 59))>>
	<<set _lube_released to random(10, $_lube_max)/10>>
	<!-- Expected value is between 1 and 5, much more likely to be on the lower end due to wetness having a softcap -->
	<<set _lube_released to parseFloat(_lube_released.toFixed(1))>>

	<<set $masturbation_vaginaFluid += _lube_released>>
	<<set $lube_produced_stat += _lube_released>>
<</widget>>

<<widget "vaginaFluidOrgasm">>
	<<addVaginalWetness 10>>
	<<if $vaginaArousalWetness gte 60>>
		<<set _lube_released to (2*Math.log10($vaginaArousalWetness - 59)) + 11>>
	<<elseif $vaginaArousalWetness gte 30>>
		<<set _lube_released to ($vaginaArousalWetness / 10) + 5>>
	<<else>>
		<<set _lube_released to 0>>
	<</if>>
	<!-- Expected value is either 0, or between 5 and 15 -->
	<<set _lube_released to parseFloat(_lube_released.toFixed(1))>>

	<<if $worn.under_lower.vagina_exposed is 1 and $worn.lower.vagina_exposed is 1>>
		<<if $masturbating>>
			<<set $masturbation_vaginaFluid += _lube_released>>
		<</if>>
		<<if $masturbation_bowl is 1>>
			<<set _liquid_collection_text.push($masturbation_vaginaFluid.toFixed(1) + " mL 爱液")>>
		<</if>>
	<<elseif $worn.under_lower.vagina_exposed is 0>>
		<<set $underlowerwet += Math.round(30 * Math.clamp((1 - $underlowerwet/100), 0, 1))>>
	<</if>>
	<<set $lube_produced_stat += _lube_released>>
<</widget>>

<<widget "tinyPenisDryOrgasmChance">>
	<<if !$player.penisExist or $player.penissize gte 0>>
		<!-- Cannot have a "femaleclimax" (aka an orgasm with no cum, but with extra humiliation) without a size -1 or lower penis -->
		<<set $femaleclimax to 0>>
	<<else>>
		<!-- Guaranteed at size -2 -->
		<<set $femaleclimax to 1>>
		<!-- chance at -1, if haven't cum in a while -->
		<<if $player.penissize is -1 and $orgasmdown lt 0>>
			<<set $_femaleclimaxchance to 50>>
			<<if ['penetrated', 'tentacle', 'tentacledeep', 'doublepenetrated'].includes($anusstate)>>
				<<set $_femaleclimaxchance += 40>>
				<<if $anusstate is "doublepenetrated">>
					<<set $_femaleclimaxchance += 20>>
				<</if>>
			<</if>>
			<<if ['penetrated', 'tentacle', 'tentacledeep'].includes($mouthstate)>>
				<<set $_femaleclimaxchance += 20>>
			<</if>>
			<<if ['penetrated', 'otheranus', 'tentacle', 'tentacledeep'].includes($penisstate)>>
				<<set $_femaleclimaxchance -= 40>>
			<</if>>
			<<set $femaleclimax to (random(1, 100) lte $_femaleclimaxchance ? 1 : 0)>>
		<</if>>
	<</if>>
<</widget>>

<<widget "orgasmcount">>
	<<if _args[0]>>
		<<set $orgasmcount += _args[0]>>
		<<set $orgasmcount = Math.clamp($orgasmcount, 0, 25)>>
	<</if>>
<</widget>>
