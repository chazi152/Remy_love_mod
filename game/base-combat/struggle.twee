:: Widgets Struggle [widget]
<<widget "struggle_init">>
	<<set $enemytype to "struggle">>
	<<set $struggle to {
		timer: 0,
		creature: "lurker",
		number: 1,
		warded: 0,
		done: 0,
		enemy: {}
	}>>
	<<set $feetaction to "evade">>
	<<set $leftaction to "guard">>
	<<set $rightaction to "guard">>
	<<if $worn.face.type.includes("gag")>>
		<<set $mouthuse to "gagged">>
	<</if>>
	<<if $worn.feet.type.includes("shackle")>>
		<<set $leftleg to "bound">>
		<<set $rightleg to "bound">>
		<<set $feetuse to "bound">>
	<</if>>
	/*<<if playerHasStrapon() and $worn.under_lower.size isnot undefined>>
		<<set $playerPenisSizeBackup to $player.penissize>>
		<<set $player.penissize to $worn.under_lower.size>>
	<</if>>*/
<</widget>>

<<widget "struggle_creatures">>
	<<set $struggle.number to _args[0]>>
	<<set $struggle.descriptions to ["缠绕的", "黏滑的", "啾啾声的", "滑溜的", "突然移动的", "迷人的", "大的", "小的", "多彩的", "磨损的", "颤动的", "颤抖的", "搏动的", "宽的", "薄的", "厚的", "嗡嗡声的", "闪闪发光的"]>>
	<<for _i to 0; _i lt $struggle.number; _i++>>
		<<generate_struggle_creature _i _args[1]>>
	<</for>>
	<<for _part range ["mouth", "vagina", "penis", "anus", "chest"]>>
		<<struggle_part_init _part>>
	<</for>>
<</widget>>

<<widget "struggle_add">>
	<<set _i to $struggle.number>>
	<<set $struggle.number += _args[0]>>
	<<for _i to _i; _i lt $struggle.number; _i++>>
		<<generate_struggle_creature _i _args[1]>>
	<</for>>
<</widget>>

<<widget "generate_struggle_creature">>
	<<set _slot = _args[0];
			_health = _args[1];
			_type = _args[2] ? _args[2] : $struggle.creature
	>>
	<<set $struggle.enemy[_slot] to {
		location: "lurking",
		health: _health,
		satisfied: 0,
		name: _type,
		description: $struggle.descriptions.pluck(),
		motion: {wasp: "flying", bee: "flying", squid: "swimming"}[_type] || "jumping",
		legs: {wasp: "legs", bee: "legs", squid: "tentacles"}[_type] || "none"
	}>>
<</widget>>

<<widget "struggle_part_init">>
	<<if ["mouth", "vagina", "penis", "anus", "chest"].includes(_args[0])>>
		<<set $_part to _args[0]>>
	<<else>>
		<span class="error">struggle_part_init error: invalid arguments: _args</span>
	<</if>>
	<!-- reset bodypart states -->
	<<set $struggle[$_part] to {
		grip: 0,
		creature: 0,
		progress: 0,
		success: 0,
		action: 0,
		action_default: 0,
		damage: 0
	}>>
	<<if !$struggle_start>>
		<!-- clean all creatures stuck to bodypart -->
		<<for _i to 0; _i lt $struggle.number; _i++>>
			<<if $struggle.enemy[_i].location is $_part>>
				<<set $struggle.enemy[_i].location to "fleeing">>

				<<if _args[1] is "cum">>
					<<set $struggle.enemy[_i].satisfied += 1>>
				<<else>>
					<<set $struggle.enemy[_i].health -= 1>>
				<</if>>
			<</if>>
		<</for>>

		<!-- clean hand states -->
		<<set $_actions to [$_part + '_strengthen', $_part + '_pull', $_part + '_spray', $_part + '_grasp', $_part + '_stroke']>>
		<<if $_actions.includes($leftactiondefault)>>
			<<if $carryblock>>
				<<set $leftactioncarry to "rest">>
			<<else>>
				<<set $leftactiondefault to "rest">>
			<</if>>
			<<set $leftarmstate to 0>>
			<<set $leftarm to 0>>
		<</if>>
		<<if $_actions.includes($rightactiondefault)>>
			<<if $carryblock>>
				<<set $rightactioncarry to "rest">>
			<<else>>
				<<set $rightactiondefault to "rest">>
			<</if>>
			<<set $rightarmstate to 0>>
			<<set $rightarm to 0>>
		<</if>>
	<</if>>
<</widget>>

<<widget "struggle_name">><<silently>>
	<!-- prints full description of an enemy in specified slot or location -->
	<<set $_loc to _args[0]>>
	<<if $_loc lt $struggle.number>>
	<!-- when _args[0] is a slot number -->
		<<set _fulldesc to $struggle.enemy[$_loc].description + ' ' + $struggle.enemy[$_loc].name>>
	<<elseif ["mouth", "vagina", "penis", "anus", "chest"].includes($_loc)>>
	<!-- when _args[0] is a location -->
		<<if $struggle[$_loc].description>>
		<!-- description doesn't exist in older versions -->
			<<set _fulldesc to $struggle[$_loc].description + ' ' + $struggle[$_loc].creature>>
		<<elseif $struggle[$_loc].creature>>
			<<for _i to 0; _i lt $struggle.number; _i++>>
				<<if $struggle.enemy[_i].location is $_loc>>
					<<set _fulldesc to $struggle.enemy[_i].description + ' ' + $struggle.enemy[_i].name>>
					<<set $struggle[$_loc].description to $struggle.enemy[_i].description>>
				<</if>>
			<</for>>
		<</if>>
	<</if>>
	<</silently>><<print _fulldesc>>
<</widget>>

<<widget "struggle">>
	<<struggle_effects>>
	<<struggle_enemy>>
	<<struggle_state>>
	<<struggle_actions>>
<</widget>>

<<widget "struggle_state">>
	<<for $_part range ["mouth", "vagina", "penis", "anus", "chest"]>>
		<<if $struggle[$_part].creature>>
			你
			<<switch $struggle[$_part].grip>>
				<<case 0>><span class="red">没有</span>
				<<case 1>><span class="pink">艰难地</span>
				<<case 2>><span class="purple">虚弱地</span>
				<<case 3>><span class="blue">勉强地</span>
				<<case 4>><span class="lblue">稳稳地</span>
				<<case 5>><span class="teal">有力的</span>
				<<default>><span class="green">牢牢地</span>
			<</switch>>
			握住那只抓在你
			<<switch $_part>>
				<<case "mouth">>嘴巴上的<<print $struggle[$_part].creature>>。
				<<case "vagina">>腹部上的<<print $struggle[$_part].creature>>。
				<<case "penis">>小腹上的<<print $struggle[$_part].creature>>。
				<<case "anus">>屁股上的<<print $struggle[$_part].creature>>。
				<<case "chest">>胸部上的<<print $struggle[$_part].creature>>。
			<</switch>>
			<br>
		<</if>>
	<</for>>
	<br>

	<<if $arousal gte $arousalmax and $orgasmdown lte 0>>
		<<orgasm>>
	<</if>>
	<<set $struggle.timer += 1>>
	<<sexcheck>>
<</widget>>

<<widget "struggle_end">>
	/*<<if playerHasStrapon()>>
			<<set $player.penissize to $playerPenisSizeBackup>>
	<</if>>*/
	<<unset $struggle>>
<</widget>>

<<widget "generateActionsStruggle">>
	<<set $combat to 1>>
	<<if _targetlist is undefined>>
		<<getTargetList>>
	<</if>>
	<<for _i to 0; _i lt $struggle.number; _i++>>
		<<if $struggle.enemy[_i].location is "fleeing" or $struggle.enemy[_i].location is "lurking">>
			<<struggle_name _i>>保持着距离。
			<br>
			<<if $farm_stage gte 10 and $lurkers_held lt 1>>
				<<set _lurker_net_possible to true>>
			<</if>>
		<</if>>
	<</for>>
	<hr>

	<div id="listContainer" style="margin-bottom:0px">
		<div id="leftaction" @class="$options.combatControls + 'Control'">
			<<leftActionInitStruggle>>
		</div>

		<div id="rightaction" @class="$options.combatControls + 'Control'">
			<<rightActionInitStruggle>>
		</div>
		<<if $dissociation lte 1 and $orgasmdown lte 0 and ($pain lt 100 or $willpowerpain is undefined)>>
			<div id="feetaction" @class="$options.combatControls + 'Control'">
				<<feetActionInitStruggle>>
			</div>
		<</if>>
	</div>

	<<if ($mouthuse is "struggle" and $struggle.mouth.creature) or ($mouthuse is 0 and !($dissociation lte 1 and $orgasmdown lte 0 and ($pain lt 100 or $willpowerpain is undefined)))>>
		<hr>
		<div id="listContainer" style="margin-bottom:0px">
			<div id="mouthaction" @class="$options.combatControls + 'Control'">
				<<mouthActionInitStruggle>>
			</div>
		</div>
	<</if>>

	<<if $dissociation lte 1 and $orgasmdown lte 0 and ($pain lt 100 or $willpowerpain is undefined)>>
		<<if $vaginastate isnot 0 and $player.vaginaExist>>
			<hr>
			<div id="listContainer" style="margin-bottom:0px">
				<div id="vaginaaction" @class="$options.combatControls + 'Control'">
					<<vaginaActionInitStruggle>>
				</div>
			</div>
		<</if>>

		<<if $penisstate isnot 0 and (playerHasStrapon() or $player.penisExist)>>
			<hr>
			<div id="listContainer" style="margin-bottom:0px">
				<div id="penisaction" @class="$options.combatControls + 'Control'">
					<<penisActionInitStruggle>>
				</div>
			</div>
		<</if>>

		<<if $anusstate isnot 0>>
			<hr>
			<div id="listContainer" style="margin-bottom:0px">
				<div id="anusaction" @class="$options.combatControls + 'Control'">
					<<anusActionInitStruggle>>
				</div>
			</div>
		<</if>>

		<<if $chestuse isnot 0 and $chestuse isnot "squeezed">>
			<hr>
			<div id="listContainer" style="margin-bottom:0px">
				<div id="chestaction" @class="$options.combatControls + 'Control'">
					<<chestActionInitStruggle>>
				</div>
			</div>
		<</if>>
	<</if>>
<</widget>>

<<widget "leftActionInitStruggle">>
	<<set $lefttarget to "struggle">>
	<<switch $leftarm>>
		<<case 0>>
			<<if $orgasmdown gte 1>>
				<<set _leftOptions to "orgasm">>
				<span class="lewd">你的左臂自由了，但你无法停止痉挛。</span>
			<<elseif $pain gte 100 and $willpowerpain is 0>>
				<<set _leftOptions to "pain">>
				<span class="red">你的左臂自由了，但疼痛使你动弹不得。</span>
			<<elseif $dissociation gte 2>>
				<<set _leftOptions to "unreal">>
				<span class="pink">你的左臂自由了，但感觉有些麻木。</span>
			<<else>>
				<<if _targetYourself is true and _targetnumber gt 1>>
					<<set _targetlistarms["你自己"] to "self">>
				<</if>>
				<<if not $options.combatControls.includes("adio") and _targetnumber gt 1>>
					<<targetListBox "left" _targetlistarms>>
				<</if>>
				<<set _leftOptions to "free">>
				<span @class="($lastOptions.left isnot _leftOptions ? 'gold' : '')">你的左臂是自由的。</span>
				<<if $options.combatControls.includes("adio") and _targetnumber gt 1>>
					<<targetListBox "left" _targetlistarms>>
					<br>
				<</if>>
			<</if>>
			<<if $options.combatControls.includes("adio")>><br><</if>>
		<<case "struggle">>
			<<if $orgasmdown gte 1>>
				<<set _leftOptions to "orgasm">>
				<span class="lewd">你用左臂抓住$struggle.creature，但你无法停止抽搐。</span>
			<<elseif $pain gte 100 and $willpowerpain is 0>>
				<<set _leftOptions to "bound">>
				<span class="red">你用左臂抓住$struggle.creature，但疼痛使你动弹不得。</span>
			<<elseif $dissociation gte 2>>
				<<set _leftOptions to "bound">>
				<span class="pink">你用左臂抓住$struggle.creature，但感觉有些麻木。</span>
			<<else>>
				<<set _leftOptions to "struggle">>
				<<switch $leftarmstate>>
					<<case "mouth_struggle">>
						<span @class="($lastOptions.left isnot _leftOptions ?'gold':'')">你的左臂抓住覆在你嘴上的<<print $struggle.mouth.creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>。</span>
					<<case "penis_struggle">>
						<span @class="($lastOptions.left isnot _leftOptions ?'gold':'')">你的左臂抓住覆在你<<penis>>上的$struggle.penis.creature</span>
					<<case "vagina_struggle">>
						<span @class="($lastOptions.left isnot _leftOptions ?'gold':'')">你的左臂抓住覆在你<<pussy>>上的$struggle.vagina.creature</span>
					<<case "anus_struggle">>
						<span @class="($lastOptions.left isnot _leftOptions ?'gold':'')">你的左臂抓住覆在你<<bottom>>上的$struggle.anus.creature。</span>
					<<case "chest_struggle">>
						<span @class="($lastOptions.left isnot _leftOptions ?'gold':'')">你的左臂抓住覆在你胸部上的$struggle.chest.creature。</span>
				<</switch>>
			<</if>>
			<<if $options.combatControls.includes("adio")>><br><</if>>
		<<case "bound">>
			<<set _leftOptions to "bound">>
			<<if $orgasmdown gte 1>>
				<span class="lewd">你的左臂因紧缚而抽搐。</span>
			<<elseif $pain gte 100 and $willpowerpain is 0>>
				<span class="red">你的左臂因束缚而阵痛。</span>
			<<elseif $dissociation gte 2>>
				<span class="pink">你的左臂因捆绑而瘫软无力。</span>
			<<else>>
				<span @class="($lastOptions.left isnot _leftOptions ?'gold':'')">你的左臂被束缚住了。</span>
			<</if>>
			<<if $options.combatControls.includes("adio")>><br><</if>>
		<<case "trapped">>
			<<set $_changetype to true>><<leftActionInitVore>>
		<<case "grappled" "penis" "othervagina" "vagina" "coverpenis" "anus" "behind">>
			<<set $_changetype to true>><<leftActionInit>>
		<<case "swarmgrappled">>
			<<set $_changetype to true>><<leftActionInitSwarm>>
		<<case "mechgrappled">>
			<<set $_changetype to true>><<leftActionInitMachine>>
		<<default>>
			<<set $_changetype to true>><<leftActionInitTentacle>>
	<</switch>>
	<<if $_changetype isnot true>>
		<<leftActionsStruggle>>
		<<if Object.keys(_leftaction).length gt 0>>
			<<if Object.values(_leftaction).includes($leftactiondefault)>>
				<<set $leftaction to $leftactiondefault>>
			<</if>>
			<<set _textColor to combatListColor('leftaction', (Object.values(_leftaction).includes($leftaction) ? $leftaction : Object.values(_leftaction)[0]), "Struggle")>>
			<<generateCombatActionOthers _leftaction "leftaction" _textColor $leftaction "Struggle">>
			<<if $options.combatControls.includes("ists")>>
				<div id="leftactionDifficulty">
					<<leftactionDifficulty>>
				</div>
			<</if>>
		<</if>>
		<<set $lastOptions.left to clone(_leftOptions)>>
	<</if>>
<</widget>>

<<widget "leftactionDifficultyStruggle">>/* Don't mind the blank widget. */
	<!-- Does nothing -->
<</widget>>

<<widget "leftActionsStruggle">>
	<<set _leftaction to {}>>
	<<switch _leftOptions>>
		<<case "free" "struggle">>
			<<set _leftaction["保持左臂静止"] to "rest">>
			<<if _lurker_net_possible is true>>
				<<set _leftaction["投掷捕捉网"] to "capture">>
			<</if>>
			<<set _leftaction["警惕"] to "guard">>
			<<leftclothesnew>>

			<<if not $options.combatControls.includes("adio")>>
				<<for $_part range ["mouth", "vagina", "penis", "anus", "chest"]>>
					<<if V[$_part + 'use'] is "struggle" and $struggle[$_part].creature>>
						<<set $_desc to ($leftactiondefault.includes($_part) ? '' : ' (' + $_part + ')')>>
						<<if $leftactiondefault.includes($_part) and $struggle[$_part].grip gte 1>>
							<!-- require hand on the creature before pulling or strengthening -->
							<<if $struggle[$_part].success lt 100>>
								<<set _leftaction["加强你的控制"] to $_part + '_strengthen'>>
							<</if>>
							<<set _leftaction["拉动"] to $_part + '_pull'>>
						<<elseif $struggle[$_part].success lt 100>>
							<<set _leftaction['抓住' + $_desc] to $_part + '_grasp'>>
						<</if>>
						<<if $spray gte 1 and $consensual isnot 1>>
							<<set _leftaction['朝' + $_desc + '喷雾'] to $_part + '_spray'>>
						<</if>>
						<<set _leftaction['抚摸' + $_desc] to $_part + '_stroke'>>
					<</if>>
				<</for>>
			<</if>>
		<<case "bound">>
		<<case "orgasm">>
			<<set _leftaction["交叉手臂"] to "leftfold">>
			<<set _leftaction["紧握"] to "leftgrip">>
		<<case "pain">>
			<<set _leftaction["挣扎"] to "leftstruggleweak">>
			<<set _leftaction["防护"] to "leftprotect">>
		<<case "unreal">>
			<<set _leftaction["戳自己"] to "leftpoke">>
			<<set _leftaction["把你的胳膊移开"] to "leftcurl">>
	<</switch>>
<</widget>>

<<widget "rightActionInitStruggle">>
	<<set $righttarget to "struggle">>
	<<switch $rightarm>>
		<<case 0>>
			<<if $orgasmdown gte 1>>
				<<set _rightOptions to "orgasm">>
				<span class="lewd">你的右臂自由了，但你无法停止痉挛。</span>
			<<elseif $pain gte 100 and $willpowerpain is 0>>
				<<set _rightOptions to "pain">>
				<span class="red">你的右臂自由了，但疼痛使你动弹不得。</span>
			<<elseif $dissociation gte 2>>
				<<set _rightOptions to "unreal">>
				<span class="pink">你的右臂自由了，但感觉有些麻木。</span>
			<<else>>
				<<if _targetYourself is true and _targetnumber gt 1>>
					<<set _targetlistarms["你自己"] to "self">>
				<</if>>
				<<if not $options.combatControls.includes("adio") and _targetnumber gt 1>>
				<</if>>
				<<set _rightOptions to "free">>
				<span @class="($lastOptions.right isnot _rightOptions ?'gold':'')">你的右臂是自由的。</span>
				<<if $options.combatControls.includes("adio") and _targetnumber gt 1>>
					<<targetListBox "right" _targetlistarms>>
					<br>
				<</if>>
			<</if>>
			<<if $options.combatControls.includes("adio")>><br><</if>>
		<<case "struggle">>
			<<if $orgasmdown gte 1>>
				<<set _rightOptions to "orgasm">>
				<span class="lewd">你用左臂抓住$struggle.creature,但你无法停止痉挛.</span>
			<<elseif $pain gte 100 and $willpowerpain is 0>>
				<<set _rightOptions to "bound">>
				<span class="red">你用右臂抓住$struggle.creature,但移动时会痛.</span>
			<<elseif $dissociation gte 2>>
				<<set _rightOptions to "bound">>
				<span class="pink">你用右臂抓住$struggle.creature,但感觉有些麻木.</span>
			<<else>>
				<<set _rightOptions to "struggle">>
				<<switch $rightarmstate>>
					<<case "mouth_struggle">>
						<span @class="($lastOptions.right isnot _rightOptions ?'gold':'')">你的右臂抓住覆在你嘴上的<<print $struggle.mouth.creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>。</span>
					<<case "penis_struggle">>
						<span @class="($lastOptions.right isnot _rightOptions ?'gold':'')">你的右臂抓住覆在你<<penis>>上的$struggle.penis.creature。</span>
					<<case "vagina_struggle">>
						<span @class="($lastOptions.right isnot _rightOptions ?'gold':'')">你的右臂抓住覆在你<<pussy>>上的$struggle.vagina.creature。</span>
					<<case "anus_struggle">>
						<span @class="($lastOptions.right isnot _rightOptions ?'gold':'')">你的右臂抓住覆在你<<bottom>>上的$struggle.anus.creature。</span>
					<<case "chest_struggle">>
						<span @class="($lastOptions.right isnot _rightOptions ?'gold':'')">你的右臂抓住覆在你胸部上的$struggle.chest.creature。</span>
				<</switch>>
			<</if>>
			<<if $options.combatControls.includes("adio")>><br><</if>>
		<<case "bound">>
			<<set _rightOptions to "bound">>
			<<if $orgasmdown gte 1>>
				<span class="lewd">你的右臂因紧缚而抽搐。</span>
			<<elseif $pain gte 100 and $willpowerpain is 0>>
				<span class="red">你的右臂因束缚而阵痛。</span>
			<<elseif $dissociation gte 2>>
				<span class="pink">你的右臂因捆绑而瘫软无力。</span>
			<<else>>
				<span @class="($lastOptions.right isnot _rightOptions ?'gold':'')">你的右臂被束缚住了。</span>
			<</if>>
			<<if $options.combatControls.includes("adio")>><br><</if>>
		<<case "trapped">>
			<<set $_changetype to true>><<rightActionInitVore>>
		<<case "grappled" "penis" "othervagina" "vagina" "coverpenis" "anus" "behind">>
			<<set $_changetype to true>><<rightActionInit>>
		<<case "swarmgrappled">>
			<<set $_changetype to true>><<rightActionInitSwarm>>
		<<case "mechgrappled">>
			<<set $_changetype to true>><<rightActionInitMachine>>
		<<default>>
			<<set $_changetype to true>><<rightActionInitTentacle>>
	<</switch>>
	<<if $_changetype isnot true>>
		<<rightActionsStruggle>>
		<<if Object.keys(_rightaction).length gt 0>>
			<<if Object.values(_rightaction).includes($rightactiondefault)>>
				<<set $rightaction to $rightactiondefault>>
			<</if>>
			<<set _textColor to combatListColor('rightaction', (Object.values(_rightaction).includes($rightaction) ? $rightaction : Object.values(_rightaction)[0]), "Struggle")>>
			<<generateCombatActionOthers _rightaction "rightaction" _textColor $rightaction "Struggle">>
			<<if $options.combatControls.includes("ists")>>
				<div id="rightactionDifficulty">
					<<rightactionDifficulty>>
				</div>
			<</if>>
		<</if>>
		<<set $lastOptions.right to clone(_rightOptions)>>
	<</if>>
<</widget>>

<<widget "rightactionDifficultyStruggle">>/* It's a necessary evil. */
	<!-- Does nothing. todo: investigate why combatButtonAdjustments() needs this -->
<</widget>>

<<widget "rightActionsStruggle">>
	<<set _rightaction to {}>>
	<<switch _rightOptions>>
		<<case "free" "struggle">>
			<<set _rightaction["保持右臂静止"] to "rest">>
			<<if _lurker_net_possible is true>>
				<<set _rightaction["投掷捕捉网"] to "capture">>
			<</if>>
			<<set _rightaction["警惕"] to "guard">>
			<<rightclothesnew>>

			<<if not $options.combatControls.includes("adio")>>
				<<for $_part range ["mouth", "vagina", "penis", "anus", "chest"]>>
					<<if V[$_part + 'use'] is "struggle" and $struggle[$_part].creature>>
						<<set $_desc to ($rightactiondefault.includes($_part) ? '' : ' (' + $_part + ')')>>
						<<if $rightactiondefault.includes($_part) and $struggle[$_part].grip gt 0>>
							<!-- require hand on the creature before pulling or strengthening -->
							<<if $struggle[$_part].success lt 100>>
								<<set _rightaction["用力抓紧"] to $_part + '_strengthen'>>
							<</if>>
							<<set _rightaction["拉动"] to $_part + '_pull'>>
						<<elseif $struggle[$_part].success lt 100>>
							<<set _rightaction['抓住' + $_desc] to $_part + '_grasp'>>
						<</if>>
						<<if $spray gte 1 and $consensual isnot 1>>
							<<set _rightaction['朝' + $_desc + '喷雾'] to $_part + '_spray'>>
						<</if>>
						<<set _rightaction['抚摸' + $_desc] to $_part + '_stroke'>>
					<</if>>
				<</for>>
			<</if>>
		<<case "bound">>
		<<case "orgasm">>
			<<set _rightaction["交叉手臂"] to "rightfold">>
			<<set _rightaction["紧握"] to "rightgrip">>
		<<case "pain">>
			<<set _rightaction["挣扎"] to "rightstruggleweak">>
			<<set _rightaction["防护"] to "rightprotect">>
		<<case "unreal">>
			<<set _rightaction["戳自己"] to "rightpoke">>
			<<set _rightaction["把你的胳膊移开"] to "rightcurl">>
	<</switch>>
<</widget>>

<<widget "feetActionInitStruggle">>
	<<set $feettarget to "struggle">>
	<<switch $feetuse>>
		<<case 0>>
			<<if _targetYourself is true and _targetnumber gt 1>>
				<<set _targetlistall["你自己"] to "self">>
			<</if>>
			<<if not $options.combatControls.includes("adio") and _targetnumber gt 1>>
				<<if ($leftleg is "grappled" and $rightleg is "grappled") or ($leftleg is "bound" and $rightleg is "bound")>>
				<<else>>
					<<targetListBox "feet" _targetlistall>>
				<</if>>
			<</if>>
			<<if $leftleg is 0 and $rightleg is 0>>
				<<set _feetOptions to "free">>
				<span @class="($lastOptions.feet isnot _feetOptions ?'gold':'')">你的双脚是自由的。</span>
			<<elseif $leftleg is 0>>
				<<set _feetOptions to "leftfree">>
				<span @class="($lastOptions.feet isnot _feetOptions ?'gold':'')">你的左腿是自由的。</span>
			<<elseif $rightleg is 0>>
				<<set _feetOptions to "rightfree">>
				<span @class="($lastOptions.feet isnot _feetOptions ?'gold':'')">你的右腿是自由的。</span>
			<<elseif $leftleg is "grappled" and $rightleg is "grappled">>
				<<set $_changetype to true>><<feetActionInitTentacle>>
			<<elseif $leftleg is "bound" and $rightleg is "bound">>
				<<set $_changetype to true>><<feetActionInitTentacle>>
			<<else>>
				<<set _feetOptions to "free">>
				<span @class="($lastOptions.feet isnot _feetOptions or _feetGold is true ?'gold':'')">你的双脚是自由的。</span>
			<</if>>
			<<if $options.combatControls.includes("adio") and _targetnumber gt 1 and _feetOptions.toLowerCase().includes("free")>>
				<<targetListBox "feet" _targetlistall>>
			<</if>>
			<<if _targetnumber is 1>>
				<<set $feettarget to _firsttarget>>
			<</if>>
			<<if $options.combatControls.includes("adio")>><br><</if>>
		<<case "penis" "othervagina" "bound" "walk" "run" "strut" "none">>
			<<set $_changetype to true>><<feetActionInit>>
		<<case "mechgrappled">>
			<<set $_changetype to true>><<feetActionInitMachine>>
		<<default>>
			<<set $_changetype to true>><<feetActionInitTentacle>>
	<</switch>>
	<<if $_changetype isnot true>>
		<<feetActionsStruggle>>
		<<if Object.keys(_feetaction).length gt 0>>
			<<if !(Object.values(_feetaction).includes($feetactiondefault))>>
				<<set $feetactiondefault to "rest">>
			<</if>>
			<<set $feetaction to $feetactiondefault>>
			<<set _textColor to combatListColor('feetaction', (Object.values(_feetaction).includes($feetaction) ? $feetaction : Object.values(_feetaction)[0]), "Struggle")>>
			<<generateCombatActionOthers _feetaction "feetaction" _textColor $feetaction "Struggle">>
			<<if $options.combatControls.includes("ists")>>
				<div id="feetactionDifficulty">
					<<feetactionDifficulty>>
				</div>
			<</if>>
		<</if>>
		<<set $lastOptions.feet to clone(_feetOptions)>>
	<</if>>
<</widget>>

<<widget "feetactionDifficultyStruggle">>/* "How so", you ask? */
	<!-- Does nothing -->
<</widget>>

<<widget "feetActionsStruggle">>
	<<set _feetaction to {}>>
	<<set _feetaction["保持不动"] to "rest">>
	<<set _feetaction["躲避攻击"] to "evade">>
	<<set _feetaction["站稳防御"] to "plant">>
<</widget>>

<<widget "mouthActionInitStruggle">>
	<<if $orgasmdown gte 1>>
		<<mouthActionInit>>
	<<elseif $pain gte 100 and $willpowerpain is 0>>
		<<mouthActionInit>>
	<<elseif $dissociation gte 2>>
		<<mouthActionInit>>
	<<else>>
		<<set $mouthtarget to "struggle">>
		<<switch $mouthuse>>
			<<case "struggle">>
				<span @class="($lastOptions.mouth isnot _mouthOptions or _mouthGold is true ?'gold':'')"><<print $struggle.mouth.creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>紧贴着你的脸。</span>
				<<if $leftarmstate is "mouth_struggle" and $rightarmstate is "mouth_struggle">>
					你用双手抓住它。
				<<elseif $leftarmstate is "mouth_struggle">>
					你用左手抓住它。
				<<elseif $rightarmstate is "mouth_struggle">>
					你用右手抓住它。
				<</if>>
				<<if $options.combatControls.includes("adio")>><br><</if>>
			<<case "tentacle">>
				<<set $_changetype to true>><<mouthActionInitTentacle>>
			<<default>>
				<<set $_changetype to true>><<mouthActionInit>>
		<</switch>>
		<<if $_changetype isnot true>>
			<<set _mouthaction to {}>>
			<<if $mouthstate is "struggle" and !$worn.face.type.includes("covered") and !$worn.face.type.includes("gag")>>
				<<set _mouthaction["保持不放"] to "rest">>
				<<set _mouthaction["张嘴"] to "open">>
			<<elseif $worn.face.type.includes("covered") or $worn.face.type.includes("gag")>>
				<<set _mouthaction["休息"] to "rest">>
			<<elseif $mouthstate is "struggle_pen">>
				<<set _mouthaction["休息"] to "rest">>
				<<set _mouthaction["吸吮"] to "suck">>
				<<if $consensual isnot 1>>
					<<set _mouthaction["咬"] to "bite">>
				<</if>>
			<</if>>
			<<if Object.keys(_mouthaction).length gt 0>>
				<<if !(Object.values(_mouthaction).includes($mouthactiondefault))>>
					<<if !["open", "suck", "bite"].includes($mouthactiondefault)>>
						<<set $mouthactiondefault to "rest">>
					<</if>>
				<</if>>
				<<set $mouthaction to $mouthactiondefault>>
				<<set _textColor to combatListColor('mouthaction', (Object.values(_mouthaction).includes($mouthaction) ? $mouthaction : Object.values(_mouthaction)[0]), "Struggle")>>
				<<if $options.combatControls.includes("adio")>>
				<span>嘴:
					<<generateCombatActionOthers _mouthaction "mouthaction" _textColor $mouthaction "Struggle">>
				</span>
				<<else>>
					<<generateCombatActionOthers _mouthaction "mouthaction" _textColor $mouthaction "Struggle">>
				<</if>>

				<<if $options.combatControls.includes("ists")>>
					<div id="mouthactionDifficulty">
						<<mouthactionDifficulty>>
					</div>
				<</if>>
			<</if>>
			<<if $options.combatControls is "radio">>
				<<handsActionsStruggleRadio "mouth">>
			<</if>>
			<<if $options.combatControls is "columnRadio">>
				<<handsActionsStruggleColumnRadio "mouth">>
			<</if>>
			<<set $lastOptions.mouth to clone(_mouthOptions)>>
		<</if>>
	<</if>>
<</widget>>

<<widget "mouthactionDifficultyStruggle">>/* Simply put, there's a JavaScript macro that needs it. */
	<!-- Does nothing -->
<</widget>>

<<widget "penisActionInitStruggle">>
	<<set $penistarget to "struggle">>
	<<if $dissociation lte 1 and $orgasmdown lte 0 and ($pain lt 100 or $willpowerpain is undefined)>>
		<<switch $penisstate>>
			<<case "struggle" "struggle_pen">>
				<span @class="(_gold_penis ? 'gold' : '')"><<print $struggle.penis.creature>>紧贴着你的小腹，威胁着你的<<penisSimple>>。</span>
				<<if $leftarmstate is "penis_struggle" and $rightarmstate is "penis_struggle">>
					你用双手抓住它。
				<<elseif $leftarmstate is "penis_struggle">>
					你用左手抓住它。
				<<elseif $rightarmstate is "penis_struggle">>
					你用右手抓住它。
				<</if>>
			<<case "tentacleentrance" "tentacleimminent" "tentacle" "tentacledeep" "tentaclerub">>
				<<set $_changetype to true>><<penisActionInitTentacle>>
			<<default>>
				<<set $_changetype to true>><<penisActionInit>>
		<</switch>>
		<<if $_changetype isnot true and $options.combatControls is "radio">>
			<<handsActionsStruggleRadio penis>>
		<</if>>
		<<if $_changetype isnot true and $options.combatControls is "columnRadio">>
			<<handsActionsStruggleColumnRadio penis>>
		<</if>>
	<</if>>
<</widget>>

<<widget "vaginaActionInitStruggle">>
	<<set $vaginatarget to "struggle">>
	<<switch $vaginastate>>
		<<case "struggle" "struggle_pen">>
			<span @class="(_gold_vagina ? 'gold' : '')"><<print $struggle.vagina.creature>>紧贴着你的盆部，威胁着你的下体。</span>
			<<if $leftarmstate is "vagina_struggle" and $rightarmstate is "vagina_struggle">>
				你用双手抓住它。
			<<elseif $leftarmstate is "vagina_struggle">>
				你用左手抓住它。
			<<elseif $rightarmstate is "vagina_struggle">>
				你用右手抓住它。
			<</if>>
		<<case "tentacleentrance" "tentacleimminent" "tentacle" "tentacledeep" "tentaclerub">>
			<<set $_changetype to true>><<vaginaActionInitTentacle>>
		<<default>>
			<<set $_changetype to true>><<vaginaActionInit>>
	<</switch>>
	<<if $_changetype isnot true and $options.combatControls is"radio">>
		<<handsActionsStruggleRadio "vagina">>
	<</if>>
	<<if $_changetype isnot true and $options.combatControls is "columnRadio">>
		<<handsActionsStruggleColumnRadio "vagina">>
	<</if>>
<</widget>>

<<widget "anusActionInitStruggle">>
	<<set $anustarget to "struggle">>
	<<if $bottomuse is "mouth" or $bottomuse is "penis">>
		<<set $_changetype to true>><<anusActionInit>>
	<<else>>
		<<switch $anusstate>>
			<<case "struggle" "struggle_pen">>
				<span @class="(_gold_anus ? 'gold' : '')"><<print $struggle.anus.creature>>紧贴着你的臀部。</span>
				<<if $leftarmstate is "anus_struggle" and $rightarmstate is "anus_struggle">>
					你用双手抓住它。
				<<elseif $leftarmstate is "anus_struggle">>
					你用左手抓住它。
				<<elseif $rightarmstate is "anus_struggle">>
					你用右手抓住它。
				<</if>>
			<<case "tentacleentrance" "tentacleimminent" "tentacle" "tentacledeep" "tentaclerub">>
				<<set $_changetype to true>><<anusActionInitTentacle>>
			<<default>>
				<<set $_changetype to true>><<anusActionInit>>
		<</switch>>
	<</if>>
	<<if $_changetype isnot true and $options.combatControls is "radio">>
		<<handsActionsStruggleRadio "anus">>
	<</if>>
	<<if $_changetype isnot true and $options.combatControls is "columnRadio">>
		<<handsActionsStruggleColumnRadio "anus">>
	<</if>>
<</widget>>

<<widget "chestActionInitStruggle">>
	<<switch $chestuse>>
		<<case "struggle">>
			<span @class="(_gold_chest ? 'gold' : '')"><<print $struggle.chest.creature>>紧贴着你的胸部。</span>
			<<if $leftarmstate is "chest_struggle" and $rightarmstate is "chest_struggle">>
				你用双手抓住它。
			<<elseif $leftarmstate is "chest_struggle">>
				你用左手抓住它。
			<<elseif $rightarmstate is "chest_struggle">>
				你用右手抓住它。
			<</if>>
		<<case "tentaclerub">>
			<<set $_changetype to true>><<chestActionInitTentacle>>
		<<case "penis">>
			<<set $_changetype to true>><<chestActionInit>>
	<</switch>>
	<<if $_changetype isnot true and $options.combatControls is "radio">>
		<<handsActionsStruggleRadio "chest">>
	<</if>>
	<<if $_changetype isnot true and $options.combatControls is "columnRadio">>
		<<handsActionsStruggleColumnRadio "chest">>
	<</if>>
<</widget>>

<<widget "struggle_actions">>
	<<if !($struggle.mouth.progress gte 6 and $struggle.mouth.progress lte 14) and !$underwater>>
		<<oxygen 50>>
	<</if>>

	<<willpowerpain>>
	<<willpowerorgasm>>
	<<actioncarry>>
	<<actioncarrydrop>>

	<<combatstate>>
	<<carryblock>>

	<<if $trance lte 0 and $panicparalysis is 0 and $panicviolence is 0 and $options.combatControls isnot "radio_old">>
		<<struggle_difficulty_set>>
		<<if $options.combatControls.includes("adio")>>
			<<set $leftaction to $leftactiondefault>>
			<<set $rightaction to $rightactiondefault>>
		<</if>>
		<<generateActionsStruggle>>
	<</if>>

	<<if $trance lte 0 and $dissociation lte 1 and $panicparalysis is 0 and $panicviolence is 0
	and $orgasmdown lte 0 and ($pain lt 100 or $willpowerpain is undefined) and $options.combatControls is "radio_old">>
		<<struggle_difficulty_set>>
		<!-- arms bound set -->
		<<if $leftarm is "bound" and $rightarm is "bound">>
			<span class="pink">你的手臂被无助地束缚住，让你毫无防备。</span>
		<<elseif $leftarm is "grappled" and $rightarm is "grappled">>
			<span class="pink">你的手臂被抓住，让你毫无防备。</span>
		<<elseif $leftarm is "grappled" or $leftarm is "bound">>
			<span class="purple">你的左臂被抓住。</span>
		<<elseif $rightarm is "grappled" or $rightarm is "bound">>
			<span class="purple">你的右臂被抓住。</span>
		<<else>>
			你的手臂自由了。
		<</if>>
		<!-- arms line -->
		<<set $leftaction to $leftactiondefault>>
		<<if $leftarm isnot "grappled" and $leftarm isnot "bound">>
			<label><span class="meek">保持左臂静止</span><<radiobutton "$leftaction" "rest" autocheck>></label>
			<<set _pipe to 1>>
		<</if>>
		<<set $rightaction to $rightactiondefault>>
		<<if $rightarm isnot "grappled" and $rightarm isnot "bound">>
			<<if _pipe>>| <</if>><label><span class="meek">保持右臂不动</span> <<radiobutton "$rightaction" "rest" autocheck>></label>
		<</if>>
		<<set _pipe to 0>>
		<br>
		<!-- feet line -->
		<<set $feetaction to $feetactiondefault>>
		<<if $feetuse is 0>>
			你的脚自由了。
			<<set $feetaction to $feetactiondefault>>
			<label><span class="meek">保持不动</span><<radiobutton "$feetaction" "rest" autocheck>></label>
			|<label><span class="meek">躲闪</span><<radiobutton "$feetaction" "evade" autocheck>></label>
			| <label><span class="meek">站在原地</span> <<radiobutton "$feetaction" "plant" autocheck>></label>
		<</if>>
		<br>
		<hr>
		<!-- attached lurkers -->
		<!-- mouth -->
		<<if $mouthuse is "struggle" and $struggle.mouth.creature>>
			<<struggle_name "mouth">>紧贴着你的脸。
			<br>
			<span>
			嘴:
			<<if $mouthstate is "struggle">>
				<<set $mouthaction to ($mouthactiondefault is "open" ? "open" : "rest")>>
				<label>保持不放<<radiobutton "$mouthaction" "rest" autocheck>></label>
				|<label><span class="sub">放开</span><<radiobutton "$mouthaction" "open" autocheck>></label>
			<<elseif $mouthstate is "struggle_pen">>
				<<if $mouthactiondefault is "suck" or ($consensual isnot 1 and $mouthactiondefault is "bite")>>
					<!-- all is good -->
				<<else>>
					<<set $mouthactiondefault to "rest">>
				<</if>>
				<<set $mouthaction to $mouthactiondefault>>
				<label>休息<<radiobutton "$mouthaction" "rest" autocheck>></label>
				|<label><span class="sub">吸吮</span><<radiobutton "$mouthaction" "suck" autocheck>></label>
				<<if $consensual isnot 1>>
					|<label><span class="def">咬</span><<radiobutton "$mouthaction" "bite" autocheck>></label>
				<</if>>
			<</if>>
			</span>
		<<if $options.combatControls is "radio">>
			<br>
			<hr>
			<<handsActionsStruggleRadio "mouth">>
		<<elseif $options.combatControls is "columnRadio">>
			<<handsActionsStruggleColumnRadio "mouth">>
		<</if>>
		<</if>>
		<!-- the rest of it -->
		<<for _part range ["vagina", "penis", "anus", "chest"]>>
			<<if V[_part + 'use'] is "struggle">>
				<<struggle_name _part>>紧贴着你的<<struggle_region _part>><<if ["vagina", "penis"].includes(_part)>>，威胁着你的<<struggle_bodypart _part>><</if>>。
				<br>
				<<if $options.combatControls is "radio">>
				<<handsActionsStruggleRadio _part>>
				<hr>
					<<elseif $options.combatControls is "columnRadio">>
				<<handsActionsStruggleColumnRadio _part>>
				<</if>>

			<</if>>
		<</for>>

		<!-- distant lurkers -->
		<<set _dlurkers to []>>
		<<for _i to 0; _i lt $struggle.number; _i++>>
			<<if $struggle.enemy[_i].location is "fleeing" or $struggle.enemy[_i].location is "lurking">>
				<<set _dlurkers.push(_i)>>
			<</if>>
		<</for>>
		<<if _dlurkers.length gt 0>>
			那只
			<<for _i to _dlurkers.length - 1; _i gte 0; _i-->>
				<<struggle_name _dlurkers[_i]>><<if _i gte 2>>，<<elseif _i is 1>>和<</if>>
			<</for>>
			拉开距离。
			<<if $farm_stage gte 10 and $lurkers_held lt 1>>
				<<if $leftarm isnot "grappled" and $leftarm isnot "bound">>
					<br>
					左臂：<label><span class="def">投掷捕捉网</span><<radiobutton "$leftaction" "capture" autocheck>></label>
				<</if>>
				<<if $rightarm isnot "grappled" and $rightarm isnot "bound">>
					<br>
					右臂：<label><span class="def">投掷捕捉网</span><<radiobutton "$rightaction" "capture" autocheck>></label>
				<</if>>
			<</if>>
			<br>
			<hr>
		<</if>>
	<</if>>
	<br><br>

	<<setupMidOrgasm>>
<</widget>>

<<widget "handsActionsStruggleRadio">>
	<<set _hpart to _args[0]>>
	<<set V[_hpart + 'target'] to "struggle">>
	<<if V[_hpart + 'use'] is "struggle">>
		<br>
		<<for _hhand range ["left", "right"]>>
			<<if ["free", "struggle"].includes(_leftOptions)>>
				<<print (_hhand is "left" ? "左" : "右")>>臂:
				<<if V[_hhand + 'actiondefault'].includes(_hpart) and $struggle[_hpart].grip gte 1>>
					<!-- require hand on the creature before pulling or strengthening -->
					<<if $struggle[_hpart].success lt 100>>
						<label><<radiobutton `'$' + _hhand + 'action'` `_hpart + '_strengthen'` autocheck>> <span class="brat">加强你的控制</span></label> |
					<</if>>
					<label><<radiobutton `'$' + _hhand + 'action'` `_hpart + '_pull'` autocheck>> <span class="def">拉动</span></label> |
				<<elseif $struggle[_hpart].success lt 100>>
					<label><<radiobutton `'$' + _hhand + 'action'` `_hpart + '_grasp'` autocheck>> <span class="brat">抓牢</span></label> |
				<</if>>
				<<if $spray gte 1 and !$consensual>>
					<label><<radiobutton `'$' + _hhand + 'action'` `_hpart + '_spray'` autocheck>> <span class="def">喷洒喷雾</span></label> |
				<</if>>
				<label><<radiobutton `'$' + _hhand + 'action'` `_hpart + '_stroke'` autocheck>> <span class="sub">抚摸它</span></label> |
			<</if>>
			<br>
		<</for>>
	<</if>>
<</widget>>

<<widget "handsActionsStruggleColumnRadio">>
	<<set _hpart to _args[0]>>
	<<set V[_hpart + 'target'] to "struggle">>
	<<if V[_hpart + 'use'] is "struggle">>
		<span>
		<<for _hhand range ["left", "right"]>>
			<<if ["free", "struggle"].includes(_leftOptions)>>
				<span><<print (_hhand is "left" ? "左" : "右")>>臂：</span>
				<<if V[_hhand + 'actiondefault'].includes(_hpart) and $struggle[_hpart].grip gte 1>>
					<!-- require hand on the creature before pulling or strengthening -->
					<<if $struggle[_hpart].success lt 100>>
						<label><<radiobutton `'$' + _hhand + 'action'` `_hpart + '_strengthen'` autocheck>> <span class="brat">加强你的控制</span></label> |
					<</if>>
					<label><<radiobutton `'$' + _hhand + 'action'` `_hpart + '_pull'` autocheck>> <span class="def">拉动</span></label> |
				<<elseif $struggle[_hpart].success lt 100>>
					<label><<radiobutton `'$' + _hhand + 'action'` `_hpart + '_grasp'` autocheck>> <span class="brat">抓牢</span></label> |
				<</if>>
				<<if $spray gte 1 and !$consensual>>
					<label><<radiobutton `'$' + _hhand + 'action'` `_hpart + '_spray'` autocheck>> <span class="def">喷洒喷雾</span></label> |
				<</if>>
				<label><<radiobutton `'$' + _hhand + 'action'` `_hpart + '_stroke'` autocheck>><span class="sub">抚摸它</span></label>
			<</if>>
			<br>
		<</for>>
		</span>
	<</if>>
<</widget>>

<<widget "handsActionsStruggleRadiobkp">>
	<<set _hpart to _args[0]>>
	<<set V[_hpart + 'target'] to "struggle">>
	<<if V[_hpart + 'use'] is "struggle">>
		<br>
		<<for _hhand range ["left", "right"]>>
			<<if V[_hhand + 'arm'] isnot "bound" and !(V[_hhand + 'arm'] and V[_hhand + 'arm'].includes("grappled"))>>
				<<print (_hhand is "left" ? "左" : "右")>>臂:
				<<if $struggle[_hpart].success lt 100>>
					<<if !V[_hhand + 'armstate'].includes(_hpart)>>
						<label><<radiobutton `'$' + _hhand + 'action'` `_hpart + '_grasp'` autocheck>> <span class="brat">抓牢</span></label> |
					<<else>>
						<label><<radiobutton `'$' + _hhand + 'action'` `_hpart + '_strengthen'` autocheck>> <span class="brat">加强你的控制</span></label> |
					<</if>>
				<</if>>
				<<if $struggle[_hpart].grip gte 1>>
					<label><<radiobutton `'$' + _hhand + 'action'` `_hpart + '_pull'` autocheck>> <span class="def">拉动</span></label> |
				<</if>>
				<<if $spray gte 1 and !$consensual>>
					<label><<radiobutton `'$' + _hhand + 'action'` `_hpart + '_spray'` autocheck>> <span class="def">喷洒喷雾</span></label> |
				<</if>>
				<label><<radiobutton `'$' + _hhand + 'action'` `_hpart + '_stroke'` autocheck>> <span class="sub">抚摸它</span></label> |
			<</if>>
			<br>
		<</for>>
	<</if>>
<</widget>>

<<widget "struggle_effects">>
	<<pain -0.25>>

	<<if $trance gte 1 or $dissociation gte 2>>
		<<if $position is "stalk">>
			你在茫然中徘徊，对周围的情况一无所知。
		<<else>>
			你直勾勾地盯向前方，身体被动的顺应着。
		<</if>>
	<</if>>

	<<if $underwater is 1>>
		<<set $underwatertime += 1>>
		<<if $underwatertime lte 5>>
			你在水下，无法说话。
		<<elseif $underwatertime lte 10>>
			<span class="blue">你在水下，并且无法呼吸。</span>
			<<gstress>><<stress 1>>
		<<elseif $underwatertime lte 15>>
			<span class="purple">你在水下，并且无法呼吸。</span>
			<<gstress>><<stress 2>>
		<<elseif $underwatertime lte 20>>
			<span class="pink">你在水下，并且呼吸越来越困难。</span>
			<<gtrauma>><<gstress>><<stress 4>><<trauma 2>>
		<<else>>
			<span class="red">你在水下快要窒息了。</span>
			<<pain 20 1>><<gtrauma>><<gstress>><<gpain>><<stress 6>><<trauma 4>>
			<br><br>
		<</if>>
	<</if>>

	<<effectspain>>
	<<effectsorgasm>>
	<<effectsdissociation>>

	<!-- MOUTH -->
	<<if $mouthaction is "rest">>
		<!-- nothing to do. add some flavour text maybe? -->
	<<elseif $mouthaction is "open" and $mouthstate is "struggle">>
		<<set $mouthactiondefault to "suck">>
		你张大嘴巴让它进入。
		<<set _mouthOpen to true>>
		<<if $struggle.mouth.progress gte 1 and $struggle.mouth.progress lte 3>>
			<<set $struggle.mouth.progress to 4>><<submission 1>>
		<</if>>
	<<elseif $mouthaction is "suck" and $mouthstate is "struggle_pen">>
		你吸吮着<<struggle_name mouth>>的<<struggle_appendage mouth>><<if $struggle.mouth.progress gte 8>>，迫使它释放更多甜美液体流入你的喉咙中<</if>>。
		<<neutral 5 "mouth">><<struggle_fluid mouth>><<purity -1>><<internalejac>><<bodyliquid "mouth" "goo">><<submission 2>>
		<<if $struggle.mouth.progress gt 7 and $struggle.mouth.progress lt 13>>
			<<set $struggle.mouth.progress += 1>>
		<</if>>
	<<elseif $mouthaction is "bite" and $mouthstate is "struggle_pen">>
		<<if $transformationParts.traits.fangs isnot "disabled">>
			<<set _rng to random(1, 5)>>
			<<switch _rng>>
				<<case 1>>
					你用你的尖牙咬了<<struggle_name mouth>>的<<struggle_appendage mouth>>.
				<<case 2>>
					你的尖牙深深的咬进了<<struggle_name mouth>>的<<struggle_skin mouth>>.
				<<case 3>>
					你的尖牙撕裂了<<struggle_name mouth>>的<<struggle_skin mouth>>.
				<<case 4>>
					你的尖牙刺穿了<<struggle_name mouth>>的<<struggle_skin mouth>>.
				<<default>>
					你的尖牙串起了<<struggle_name mouth>>的<<struggle_skin mouth>>.
			<</switch>>
			<span class="green">它从你的脸上跳下来.</span>
			<<set $mouthuse to 0>>
			<<set $mouthstate to 0>>
			<<struggle_part_init "mouth">>
			<<set $struggle.warded += 1>>
			<<defiance 2>> <<control 5>>
			<<struggleClearActions "mouth_">>
			<br>
		<<else>>
			<<set _rng to random(1, 5)>>
			<<switch _rng>>
				<<case 1>>
					不管你多努力咬它的<<struggle_appendage mouth>>,<span class="red">它都没有反应.</span>
				<<case 2>>
					你咬了上去,<span class="red">但是你的牙齿没有</span>穿透<<struggle_name mouth>>的<<struggle_skin mouth>>.
				<<case 3>>
					你咬了上去,<span class="red">但你的牙无法咬伤</span><<struggle_name mouth>>的坚固的<<struggle_skin mouth>>.
				<<case 4>>
					你咬进了<<struggle_name mouth>>的坚固的<<struggle_skin mouth>>，<span class="red">但是这还不足以引起反应。</span>
				<<default>>
					你咬了下去,<span class="red">但是你的牙不能紧紧咬住</span><<struggle_name mouth>>的<<struggle_skin mouth>>.
			<</switch>>
			<<defiance 1>>
		<</if>>
	<</if>>
	<<if !$carryblock>>
		<<set $mouthactiondefault to ($mouthaction is "bite" ? "rest" : $mouthaction)>>
		<<set $mouthaction to 0>>
	<</if>>

	<!-- FEET -->
	<<set _grip_strength to currentSkillValue('physique') / 20 + $handskill>>
	<<if $feetaction is "rest">>
		<<unset $dodging>>
		你放松自己的双脚。
	<<elseif $feetaction is "evade">>
		<<set $dodging to 1>>
		<<if $underwater is 1 or ["sea","lake"].includes($location)>>
			你放松双腿，让自己漂浮起来，准备闪避接下来的攻击。
		<<else>>
			你保持脚下轻盈，准备闪避接下来的攻击。
		<</if>>
	<<elseif $feetaction is "plant">>
		<<unset $dodging>>
		<<set _grip_strength += $feetskill>>
		<<if $underwater is 1 or ["sea","lake"].includes($location)>>
			你踩着水，帮助你稳定浮在水中。
		<<else>>
			你把脚站稳，帮助你抓得更牢。
		<</if>>
		<<feetskilluse>>
	<</if>>
	<<if !$carryblock>>
		<<set $feetactiondefault to ($feetaction ? $feetaction : "rest")>>
		<<set $feetaction to 0>>
	<</if>>

	<!-- HANDS -->
	<<set _actionPriority = ["rest", "stroke", "grasp", "strengthen", "pull", "spray"]>>
	<<set _hands = [{id: "left", handaction: $leftaction},{id: "right", handaction: $rightaction}]
		.map(h => {
			let [,part, action] = /(?:([^_]+)_)?(.*)/.exec(h.handaction);
			return Object.assign(h, {part, action});
		}).sort((a,b) => _actionPriority.indexOf(a.action) - _actionPriority.indexOf(b.action))
	>>
	<<for _i, _handObj range _hands>>
	<!-- iterate once per hand, unless $leftaction is $rightaction, in which case do stuff for the other hand immediately and <<break>> -->
		/* <<set {id: _hand, part: _actionpart, action: _action} = _Hand>> */
		<<set _hand = _handObj.id, _actionpart = _handObj.part, _action = _handObj.action>>
		<<set _otherHand to _hands[1-_i].id>>
		<<if !_action or V[_hand + "action"] is 0>><<continue>><</if>>
		<<if _action.includes("upper") or _action.includes("lower")>><<set _action to "clothes">><</if>>
		<<set _gripped to _grip_strength gte random(2000)>>
		<!-- _grip_strength is set above in the FEET section -->
		<<switch _action>>
			<<case "rest">>
				/* nothing to do */
			<<case "stroke">>
				<<if _actionpart is "mouth">>
					你抚摸着<<struggle_name _actionpart>>，希望能使它放松下来。
				<<else>>
					你轻抚着<<struggle_name _actionpart>>的<<struggle_appendage _actionpart>>，希望能够激发它的反应。
					<<if $struggle[_actionpart].progress gt 7 and $struggle[_actionpart].progress lt (_actionpart is "chest" ? 12 : 13)>>
						<<set $struggle[_actionpart].progress++>>
						<<bodyliquid _actionpart "goo">>
						<<if ["vagina", "anus"].includes(_actionpart)>>
							<<struggle_fluid _actionpart>>
							<<purity -1>>
							<<internalejac>>
						<</if>>
					<</if>>
				<</if>>
				<br>
				<<neutral 5>><<submission 2>>

				<<set V[_hand + 'arm'] to "struggle">>
				<<set V[_hand + 'armstate'] to _actionpart + '_struggle'>>
				<<if $leftaction is $rightaction>>
					<<set V[_otherHand + "armstate"] to _actionpart + '_struggle'>>
					<<set V[_otherHand + "arm"] to "struggle">>
					<<submission 2>>
					<<break>>
				<</if>>
			<<case "grasp">>
				你抬起你的<<if $leftaction is $rightaction>>双手<<else>><<print _hand.replace("left","左").replace("right","右")>>手<</if>>，试图抓住附在你的<<struggle_region _actionpart>>上的<<print $struggle[_actionpart].creature>>，但很难找到可抓的地方。
				<<set V[_hand + 'arm'] to "struggle">>
				<<set V[_hand + 'armstate'] to _actionpart + '_struggle'>>
				<<set $struggle[_actionpart].grip += 1 + _gripped>>
				<<set V[_hand + 'action'] to _actionpart + '_strengthen'>>
			<<case "strengthen">>
				你<<if $leftaction is $rightaction>>用双手<</if>>用力握紧附在你的<<struggle_region _actionpart>>上的<<print $struggle[_actionpart].creature>>。
				<<set V[_hand + 'arm'] to "struggle">>
				<<set V[_hand + 'armstate'] to _actionpart + '_struggle'>>
				<<if _gripped>>
					你的抓握<span class="teal">好多了。</span>
					<<set $struggle[_actionpart].grip += 2>>
				<<else>>
					你的抓握<span class="blue">稍微好了一点。</span>
					<<set $struggle[_actionpart].grip += 1>>
				<</if>>
				<br>
				<<handskilluse>>

				<<if $leftaction is $rightaction and _i == 0>>
					<<set $struggle[_actionpart].grip += 1 + _gripped>>
					<<set V[_otherHand + "arm"] to "struggle">>
					<<set V[_otherHand + "armstate"] to _actionpart + '_struggle'>>
					<<break>>
				<</if>>
			<<case "pull">>
				<br>
				你用指甲夹住<<print $struggle[_actionpart].creature>>，试图将其从你的<<struggle_region _actionpart>>上拽下来。
				<<struggle_difficulty_set>>
				<<if $struggle[_actionpart].success gte random(1, 100) || ($leftaction is $rightaction and $struggle[_actionpart].success gte random(1, 100))>>
					<span class="green">你把它扔得远远的。</span>
					<<set V[_actionpart + 'use'] to 0>>
					<<set V[_actionpart + 'state'] to 0>>
					<<struggle_part_init _actionpart>>
					<<set $struggle.warded++>>
					<<struggleClearActions `_actionpart + '_'`>>
				<<else>>
					<!-- TODO: maybe add some skill and random checks, with possibilities (and corresponding flavour text) to retain the grip -->
					你无法保持握力，<span class="red">你的手指松开了那个生物。</span>
					<<set $struggle[_actionpart].grip to 0>>
					<<set V[_hand + 'action'] to _actionpart + '_grasp'>>
				<</if>>

				<<if $leftaction is $rightaction>>
					<<break>>
				<</if>>

			<<case "spray">>
				<<if $spray gte 1>>
					你喷洒喷雾在<<print $struggle[_actionpart].creature>>上。<span class="green">它从你的<<struggle_region _actionpart>>跳开了。</span>
					<<set $spraystat++>><<spray -1>>
					<<set V[_actionpart + 'use'] to 0>>
					<<set V[_actionpart + 'state'] to 0>>
					<<struggle_part_init _actionpart>>
					<<set $struggle.warded++>>
					<<struggleClearActions _actionpart>>
				<<else>>
					你试图喷洒喷雾到附在你的<<struggle_region _actionpart>>上的<<print $struggle[_actionpart].creature>>，<span class="purple">但你的喷雾已经用完了！</span>
				<</if>>
				<br>
				<<if $leftaction is $rightaction>>
					<<break>>
				<</if>>

			<<case "clothes">>
				<<effectshandsclothes>>
				<br>
				<<if _hand is "left" and ($rightaction.toString().includes("upper") or $rightaction.toString().includes("lower"))>>
					<<break>>
				<</if>>
		<</switch>>
	<</for>>


	/* lose grasp on the lurkers that you have no contact with */
	<<if !$carryblock>>
		<<for _part range ["mouth", "vagina", "penis", "anus", "chest"]>>
			<<if $struggle[_part].grip gt 0 and (!$leftaction or !$leftaction.includes(_part)) and (!$rightaction or !$rightaction.includes(_part))>>
				转换所有的注意力，<span class="red">你失去了对附在你<<struggle_region _part>>的<<print $struggle[_part].creature>>的所有控制。</span>
				<<set $struggle[_part].grip to 0>>
				<!-- reset arm state -->
				<<if $leftarmstate.toString().includes(_part)>>
					<<set $leftarmstate to 0>>
					<<set $leftarm to 0>>
				<</if>>
				<<if $rightarmstate.toString().includes(_part)>>
					<<set $rightarmstate to 0>>
					<<set $rightarm to 0>>
				<</if>>
				<!-- prevent attempts to strenghten what hasn't been grasped after orgasm, disassociation, etc -->
				<!-- pretty useless unless !$carryblock check above goes away some day -->
				<<if $rightactioncarry is (_part + '_strengthen')>>
					<<set $rightactioncarry to (_part + '_grasp')>>
				<</if>>
				<<if $leftactioncarry is (_part + '_strengthen')>>
					<<set $leftactioncarry to (_part + '_grasp')>>
				<</if>>
			<</if>>
		<</for>>
	<</if>>

	/* capture calculations should go independently */
	<<if $leftaction is "capture" or $rightaction is "capture">>
		<<set _capture_chance to (!!($leftaction is "capture") + !!($rightaction is "capture")) * 30>>
		<!-- select the best target -->
		<<for _i to 0; _i lt $struggle.number; _i++>>
			<<if $struggle.enemy[_i].location is "fleeing">>
				<<set _capture_chance *= 2>>
				<<set _capture_creature to _i>>
				<<break>>
			<<elseif $struggle.enemy[_i].location is "lurking">>
				<<set _capture_creature to _i>>
			<</if>>
		<</for>>
		<<if _capture_creature isnot undefined>>
		<!-- do a strict check for undefined and not something else! otherwise the check will fail on 0 -->
			你<<if $leftaction is $rightaction>>用双手<</if>>甩网捕捉了<<if $struggle.enemy[_capture_creature] is "fleeing">><span class="green">后退中的</span><</if>><<print $struggle.enemy[_capture_creature].name.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>。
			<<if $prof.net / 20 + _capture_chance gte random(100)>>
				<<set _succ to true>>
			<</if>>
		<<else>>
			你准备用网来捕捉<<print $struggle.creature>>，<span class="pink">但它们靠得太近了。</span> 你必须先赶走其中一些。
		<</if>>
		<<if _succ>>
			<span class="green">网结实地接住了它。</span>你将这个生物控制到你的手中。
			<<if $struggle.enemy[_capture_creature].name is "lurker">>
				<<set $lurkers_held += 1>>
				<<set $stat_lurkers_captured += 1>>
			<</if>>
			<<set $struggle.done += 1>>
			<<set $struggle.enemy[_capture_creature].location to "fled">>
			<<if $leftaction is "capture">>
				<<set $leftaction to "rest">>
			<</if>>
			<<if $rightaction is "capture">>
				<<set $rightaction to "rest">>
			<</if>>
		<<else>>
			<span class="red">生物扭动着身子躲到一边。</span><<gnet>><<prof net 1>>
		<</if>>
	<</if>>

	<<if $leftaction is "guard" and $rightaction is "guard">>
		你举起双臂，准备击退任何攻击。
		<<set $left_guard to 1>>
		<<set $right_guard to 1>>
	<<elseif $leftaction is "guard">>
		你抬起左臂，准备击退任何攻击。
		<<set $left_guard to 1>>
	<<elseif $rightaction is "guard">>
		你抬起右臂，准备击退任何攻击。
		<<set $right_guard to 1>>
	<</if>>

	<<if !$carryblock>>
		<<set $leftactiondefault to ($leftaction ? $leftaction : "rest"); $leftaction to 0>>
		<<set $rightactiondefault to ($rightaction ? $rightaction : "rest"); $rightaction to 0>>
	<</if>>
	<br>
<</widget>>

<<widget "struggle_enemy">>
	<<if $struggle.mouth.creature>>
		<<switch $struggle.mouth.progress>>
			<<case 0>>
				<<if $struggle.mouth.legs is "tentacles">>
					<<print $struggle.mouth.creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>的触须缠绕在你的脖子上。<<neutral 2>>
				<<elseif $worn.face.type.includes("covered") or $worn.face.type.includes("gag")>>
					<<print $struggle.mouth.creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>的<<struggle_appendage mouth>>在你的$worn.face.cn_name_cap上磨蹭着。<<neutral 1>>
				<<else>>
					<<print $struggle.mouth.creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>的<<struggle_appendage mouth>>磨蹭着你的脸颊。<<neutral 1>>
				<</if>>
			<<case 1>>
				<<if $worn.face.type.includes("covered") or $worn.face.type.includes("gag")>>
					<<print $struggle.mouth.creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>玩弄着你的$worn.face.cn_name_cap，<span class="blue">寻找进入的途径。</span><<neutral 2 "mouth">>
					/*<<struggle_clothes mouth>>*/
				<<else>>
					<<print $struggle.mouth.creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>玩弄着你的嘴唇，<span class="blue">寻找进入的途径。</span><<neutral 2 "mouth">>
				<</if>>
			<<case 2>>
				<<struggle_clothes mouth>>
				/*The <<print $struggle.mouth.creature>>'s <<struggle_appendage mouth>> <span class="purple">pushes against your lips.</span><<neutral 4 "mouth">>*/
			<<case 3>>
				<<print $struggle.mouth.creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>><<struggle_appendage mouth>>的顶端开始分开你的嘴唇。<span class="pink">马上就要完全插进来了。</span><<neutral 5 "mouth">>
			<<case 4>>
				<<if $player.virginity.oral isnot true>>
					<<print $struggle.mouth.creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>><span class="pink"><<print (_mouthOpen ?'滑入':'强推进')>>它的<<struggle_appendage mouth>>进你的嘴里</span>.随着进入你的嘴里的越来越多,你的嘴被撑得越来越大.
					<<submission 10>>
				<<else>>
					<<print $struggle.mouth.creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>><span class="pink"><<print (_mouthOpen ?'滑入':'强推进')>>它的<<struggle_appendage mouth>>进你的嘴里</span>.<span class="red">它尝起来味道很怪.</span>
					<<submission 30>><<takeVirginity $struggle.mouth.creature "oral">>
				<</if>>
				<<if $consensual isnot 1>><<bruise face>><<violence 1>><<raped>><</if>>
				<<oralstat>><<neutral 5 "mouth">><<set $mouthstate to "struggle_pen">><<set $mouthaction to 0>>
			<<case 5>>
				<<print $struggle.mouth.creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>在你的嘴里插得更深。<<neutral 5 "mouth">>
			<<case 6>>
				<<print $struggle.mouth.creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>的<<struggle_appendage mouth>>插进你的喉咙。<<if $underwater isnot 1>><span class="purple">你无法呼吸！</span><</if>><<neutral 5 "mouth">>
			<<case 7>>
				<<print $struggle.mouth.creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>><span class="pink">抖动着向你的喉咙泵出甜蜜的液体。</span><<neutral 5 "mouth">><<struggle_fluid mouth>><<purity -1>><<internalejac>><<bodyliquid "mouth" "goo">><<oralejacstat>><<ejacstat>>
			<<case 13>>
				<<if $struggle.creature is "lurker">>
					<<impregnateParasite "Lurker" 400>><<fertiliseParasites>>
					<<if _impreg is true>>
						<<print $struggle.mouth.creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>的<<struggle_appendage mouth>><span class="red">再度胀大</span>，但是升高的压力很快消失。感觉它好像留下了什么东西。<<neutral 5 "mouth">><<struggle_fluid mouth>><<purity -1>><<internalejac>><<bodyliquid "mouth" "goo">>
					<<else>>
						<<set _failedImpreg to true>>
					<</if>>
					<<set _impreg to false>>
				<<else>>
					<<set _failedImpreg to true>>
				<</if>>
				<<if _failedImpreg>>
					<<print $struggle.mouth.creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>在向你的喉咙泵出甜蜜的液体。<<neutral 5 "mouth">><<struggle_fluid mouth>><<purity -1>><<internalejac>><<bodyliquid "mouth" "goo">>
				<</if>>
			<<case 14>>
				<<print $struggle.mouth.creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>颤抖着，<span class="blue">将它的<<struggle_appendage mouth>>从你喉咙里抽出。</span>它从你脸上跳开。<<neutral 5 "mouth">><<struggle_fluid mouth>>
				<<set $mouthuse to 0>>
				<<set $mouthstate to 0>>
				<<struggle_part_init "mouth" "cum">>
			<<default>>
				<<print $struggle.mouth.creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>在向你的喉咙泵出甜蜜的液体。<<neutral 5 "mouth">><<struggle_fluid mouth>><<purity -1>><<internalejac>><<bodyliquid "mouth" "goo">>
		<</switch>>
		<<if $struggle.mouth.progress gte 6 and $struggle.mouth.progress lte 14>>
			<<if $underwater isnot 1>>
				<<oxygen -150>>
			<</if>>
			<<if $oxygen gte 900>>
				<!-- TODO: maybe add something here? -->
			<<elseif $oxygen gte 600>>
			<<elseif $oxygen gte 300>>
			<<elseif $oxygen gte 1>>
			<<else>>
				<<violence 15>>
			<</if>>
		<</if>>
		<<set $struggle.mouth.progress += 1>>
		<br>
	<</if>>

	<<if $struggle.vagina.creature>>
		<<switch $struggle.vagina.progress>>
			<<case 0>>
				<<if $struggle.vagina.legs is "tentacles">>
					<<print $struggle.vagina.creature>>的触手抓住并粘在你的小腹上。<<neutral 2 "genitals">>
				<<else>>
					<<print $struggle.vagina.creature>>的<<struggle_appendage vagina>>插入你的小腹，好像在寻找什么东西。<<neutral 1 "genitals">>
				<</if>>
			<<case 1>>
				<<print $struggle.vagina.creature>>在你的阴唇上滑动，<span class="blue">寻找进入的途径。</span><<neutral 2 "genitals">>
			<<case 2>>
				<<struggle_clothes vagina>>
			<<case 3>>
				<<print $struggle.vagina.creature>><<struggle_appendage vagina>>的顶端抵住你的<<pussy>>。<span class="pink">它要全部插进来了。</span><<neutral 5 "genitals">>
			<<case 4>>
				<<set _pain to $vaginalPain>>
				<<if $player.virginity.vaginal isnot true>>
					<<print $struggle.vagina.creature>><span class="pink">强行将它的<<struggle_appendage vagina>>插进你的<<pussy>>。</span>它的<<struggle_appendage vagina>>随着深入不断变大。
					<<sex 30 "genitals">>
				<<else>>
					<<print $struggle.vagina.creature>><span class="pink">强行将它的<<struggle_appendage vagina>>插进你的<<pussy>>。</span>
					<<if $sexStats.vagina.pregnancy.totalBirthEvents gt 0>>
						<span class="red">尽管你没有处女膜,但当你的童贞和纯洁被夺走时,你感觉到你内心的某些东西发生了变化.</span>
					<<else>>
						<span class="red">捅破了你的处女膜,永远剥夺了你的纯洁.</span>
					<</if>>
					<<sex 100 "genitals">><<takeVirginity $struggle.vagina.creature "vaginal">>
				<</if>>
				<<if $consensual isnot 1>><<bruise vagina>><<violence 2>><<pain _pain>><<raped>><<vaginaraped>><</if>>
				<<vaginalstat>><<set $vaginastate to "struggle_pen">><<neutral 5 "genitals">>
			<<case 5>>
				<<print $struggle.vagina.creature>>让自己插向你的<<pussy>>的更深处。<<neutral 5 "genitals">>
			<<case 6>>
				<<print $struggle.vagina.creature>>的<<struggle_appendage vagina>>开始插入你的<<pussy>>。<<neutral 5 "genitals">>
			<<case 7>>
				<<print $struggle.vagina.creature>><span class="pink">颤抖着向你的<<pussy>>泵入温暖的液体。</span><<neutral 5 "genitals">><<struggle_fluid vagina>><<purity -1>><<internalejac>><<bodyliquid "vagina" "goo">><<vaginalejacstat>><<ejacstat>>
			<<case 13>>
				<<impregnateParasite $struggle.vagina.creature 50 "vagina">>
				<<if _impreg is true>>
					<<print $struggle.vagina.creature>>的<<struggle_appendage mouth>><span class="red">再度胀大</span>，但是升高的压力很快消失。感觉它好像留下了什么东西。<<neutral 5 "genitals">><<bodyliquid "vagina" "goo">><<struggle_fluid vagina>><<purity -1>><<internalejac>><<bodyliquid "vagina" "goo">>
					<<set _impreg to false>>
				<<else>>
					<<print $struggle.vagina.creature>>的<<struggle_appendage vagina>>插入你的<<pussy>>。<<neutral 5 "genitals">><<bodyliquid "vagina" "goo">><<struggle_fluid vagina>><<purity -1>><<internalejac>><<bodyliquid "vagina" "goo">>
				<</if>>
			<<case 14>>
				<<print $struggle.vagina.creature>>颤抖着，<span class="blue">随后将它的<<struggle_appendage vagina>>从你的<<pussy>>里抽出。</span>它从你的小腹上跳远。<<neutral 5 "genitals">><<struggle_fluid vagina>>
				<<set $vaginause to 0>>
				<<set $vaginastate to 0>>
				<<struggle_part_init "vagina" "cum">>
			<<default>>
				<<print $struggle.vagina.creature>>将温暖的液体泵入你的<<pussy>>。<<neutral 5 "genitals">><<struggle_fluid vagina>><<purity -1>><<internalejac>><<bodyliquid "vagina" "goo">>
			<</switch>>
		<<set $struggle.vagina.progress += 1>>
		<br>
	<</if>>

	<<if $struggle.penis.creature>>
		<<switch $struggle.penis.progress>>
			<<case 0>>
				<<if $struggle.penis.legs is "tentacles">>
					<<print $struggle.penis.creature>>在它的触手抓住你的<<penis>>撸动的同时，把自己降下对准你的肉棒。<<neutral 2 "genitals">>
				<<else>>
					<<print $struggle.penis.creature>>把自己降下对准你的<<penis>>。<<neutral 1 "genitals">>
				<</if>>
			<<case 1>>
				<<print $struggle.penis.creature>>抵住你的<<penis>>，<span class="blue">尝试将其包裹住。</span><<neutral 2 "genitals">>
			<<case 2>>
				<<struggle_clothes penis>>
			<<case 3>>
				<<print $struggle.penis.creature>>压向你的<<penis>>，<span class="pink">尝试将其整根包裹住。</span><<neutral 5 "genitals">>
			<<case 4>>
				<<set _pain to $penisPain>>
				<<if playerHasStrapon() or $player.virginity.penile isnot true>>
					<<print $struggle.penis.creature>><span class="pink">强迫你的<<penis>>插入它的体内。</span>它随着深入不断变紧。
					<<sex 30 "genitals">>
				<<else>>
					<<print $struggle.penis.creature>><span class="pink">强迫你的<<penis>>插进它的体内，</span><span class="red">你的包皮从龟头上剥开，永远剥夺了你的纯洁。</span>
					<<sex 100 "genitals">><<takeVirginity $struggle.penis.creature "penile">>
				<</if>>
				<<if playerHasStrapon()>><<violence 2 1 1 0>>
				<<elseif $consensual isnot 1>><<bruise penis>><<violence 2>><<pain _pain>><<raped>><<penisraped>><</if>>
				<<penilestat>><<neutral 5 "genitals">><<set $penisstate to "struggle_pen">>
			<<case 5>>
				<<print $struggle.penis.creature>>将你的<<penis>>插入体内更深处。<<neutral 5 "genitals">>
			<<case 6>>
				<<print $struggle.penis.creature>>开始套弄你的<<penis>>。<<neutral 5 "genitals">>
			<<case 7>>
				<span class="pink">当你的<<penis>>插到它的核心时</span><<print $struggle.penis.creature>>颤抖起来。<<neutral 5 "genitals">><<bodyliquid "penis" "goo">>
			<<case 14>>
				<<print $struggle.penis.creature>>颤抖起来，<span class="blue">随后松开你的<<penis>>。</span>它从你小腹上跳开。<<neutral 5 "genitals">>
				<<set $penisuse to 0>>
				<<set $penisstate to 0>>
				<<struggle_part_init "penis" "cum">>
			<<default>>
				<<print $struggle.penis.creature>>套弄着你的<<penis>>。<<neutral 5 "genitals">><<bodyliquid "penis" "goo">>
		<</switch>>
		<<set $struggle.penis.progress += 1>>
		<br>
	<</if>>

	<<if $struggle.anus.creature>>
		<<switch $struggle.anus.progress>>
			<<case 0>>
				<<if $struggle.anus.legs is "tentacles">>
					<<print $struggle.anus.creature>>划过并抓住你的<<bottom>>。<<neutral 2 "anus">>
				<<else>>
					<<print $struggle.anus.creature>>的<<struggle_appendage anus>>滑过你<<bottom>>。<<neutral 1 "anus">>
				<</if>>
			<<case 1>>
				<<print $struggle.anus.creature>>的<<struggle_appendage anus>>抓住你的<<bottom>>，<span class="blue">试图找到一个入口。</span><<neutral 2 "anus">>
			<<case 2>>
				<<struggle_clothes anus>>
			<<case 3>>
				<<print $struggle.anus.creature>>的<<struggle_appendage anus>>抵住你的<<bottom>>，<span class="pink">将要完全插入你的体内。</span><<neutral 5 "anus">>
			<<case 4>>
				<<set _pain to $analPain>>
				<<if $player.virginity.anal isnot true>>
					<<print $struggle.anus.creature>>的<<struggle_appendage anus>><span class="pink">插入你的<<bottom>>。</span>随着深入不断变大。
					<<sex 30 "anus">>
				<<else>>
					<<print $struggle.anus.creature>>的<<struggle_appendage anus>><span class="pink">插入你的<<bottom>>，</span><span class="red">以你意想不到的方式侵犯着你。</span>
					<<sex 100 "anus">><<takeVirginity $struggle.anus.creature "anal">>
				<</if>>
				<<if $consensual isnot 1>><<bruise anus>><<violence 2>><<raped>><<anusraped>><</if>>
				<<analstat>><<neutral 5 "anus">><<pain _pain>><<anusraped>><<set $anusstate to "struggle_pen">>
			<<case 5>>
				<<print $struggle.anus.creature>>的<<struggle_appendage anus>>插入你的<<bottom>>的更深处。<<neutral 5 "anus">>
			<<case 6>>
				<<print $struggle.anus.creature>>的<<struggle_appendage anus>>开始抽插你的<<bottom>>。<<neutral 5 "anus">>
			<<case 7>>
				<<print $struggle.anus.creature>><span class="pink">颤抖着向你的<<bottom>>泵入温暖的液体。</span><<neutral 5 "anus">><<struggle_fluid anus>><<purity -1>><<internalejac>><<bodyliquid "anus" "goo">><<analejacstat>><<ejacstat>>
			<<case 13>>
				<<impregnateParasite $struggle.anus.creature 50>>
				<<if _impreg is true>>
					<<print $struggle.anus.creature>>的<<struggle_appendage mouth>><span class="red">再度胀大</span>，但是增大的压力很快消失。它好像留下了什么东西。<<neutral 5 "anus">><<bodyliquid "anus" "goo">><<struggle_fluid anus>><<purity -1>><<internalejac>><<bodyliquid "anus" "goo">>
					<<set _impreg to false>>
				<<else>>
					<<print $struggle.anus.creature>>的<<struggle_appendage anus>>插入你的<<bottom>>。<<neutral 5 "anus">><<bodyliquid "anus" "goo">><<struggle_fluid anus>><<purity -1>><<internalejac>><<bodyliquid "anus" "goo">>
				<</if>>
			<<case 14>>
				<<print $struggle.anus.creature>>颤抖了起来<span class="blue">随后将它的<<struggle_appendage anus>>抽回，</span>从你的<<bottom>>上跳开，<<neutral 5 "anus">><<struggle_fluid anus>>
				<<set $anususe to 0>>
				<<set $anusstate to 0>>
				<<struggle_part_init "anus" "cum">>
			<<default>>
				<<print $struggle.anus.creature>>的<<struggle_appendage anus>>插入你的<<bottom>>。<<neutral 5 "anus">><<bodyliquid "anus" "goo">><<struggle_fluid anus>><<purity -1>><<internalejac>><<bodyliquid "anus" "goo">>
		<</switch>>
		<<set $struggle.anus.progress += 1>>
		<br>
	<</if>>

	<<if $struggle.chest.creature>>
		<<switch $struggle.chest.progress>>
			<<case 0>>
				<<neutral 2 "breasts">>
				<<if $struggle.chest.legs is "tentacles">>
					<<print $struggle.chest.creature>>的触手抓住你的<<breasts>>，
					<<if $player.breastsize gte 3>>
						将它们挤在一起的同时，<span class="blue">一条肉棒形状的<<struggle_appendage chest>>摩擦着它们。</span>
					<<else>>
						玩弄它们的同时，<span class="blue">一条肉棒形状的<<struggle_appendage chest>>摩擦着它们。</span>
					<</if>>
				<<elseif $struggle.chest.legs is "legs">>
					<<print $struggle.chest.creature>>的腿抓住你的
					<<if $player.breastsize gte 3>>
						<<breasts>>。<span class="blue">一根肉棒形状的<<struggle_appendage chest>>从生物身上长出</span>摩擦着胸部。
					<<else>>
						<<breasts>>，玩弄着胸部的同时<span class="blue">一根肉棒形状的<<struggle_appendage chest>>从生物身上长出，</span>加入狂欢。
					<</if>>
				<<else>>
					<<print $struggle.chest.creature>>的身体滑过你<<breasts>>。
					<<if $player.breastsize gte 3>>
						<span class="blue">一条肉棒形状的<<struggle_appendage chest>>从生物的身上长出，</span>摩擦着它们。
					<<else>>
						它在玩弄它们的同时<span class="blue">一条肉棒形状的<<struggle_appendage chest>>从生物身上长出。</span>
					<</if>>
				<</if>>
			<<case 1>>
				<<struggle_clothes chest>>
			<<case 2>>
				<<if $player.breastsize gte 3>>
					<<if $struggle.chest.legs is "tentacles">>
						<<print $struggle.chest.creature>>的触手<span class="pink">缠绕着你的胸部。</span><<neutral 5 "breasts">>
					<<else>>
						<<print $struggle.chest.creature>>把你的<<breasts>>挤压在一起，随后<span class="pink">用它的<<struggle_appendage chest>>在它们中间抽插着。</span><<neutral 3 "breasts">>
					<</if>>
				<<else>>
					<<if $struggle.chest.legs is "tentacles">>
						<<print $struggle.chest.creature>>的触手抓住并不时挤着你的<<breasts>>。<<neutral 5 "breasts">>
					<<else>>
						<<print $struggle.chest.creature>>的触手抓住并玩弄你的<<breasts>>。<<neutral 3 "breasts">>
					<</if>>
				<</if>>
				<<if $lactating is 1 and $breastfeedingdisable is "f" and $milk_amount gte 1>>
					<span class="pink">你感觉乳汁从你的乳头漏出。</span>
					<<breastfeed>>
					<<milkvolume 1>>
				<<else>>
					<<milkvolume 1>>
				<</if>>
			<<case 3>>
				<<if $player.breastsize gte 3>>
					<<if $struggle.chest.legs is "tentacles">>
						<<if $lactating is 1 and $breastfeedingdisable is "f" and $milk_amount gte 1>>
							<<print $struggle.chest.creature>>的触手<span class="pink">从你的<<breasts>>榨取乳汁。</span>
							<<breastfeed>>
						<<else>>
							<<print $struggle.chest.creature>>的触手挤压着你的<<breasts>>的同时其他的触手在不时戳着你的乳头。
							<<milkvolume 1>>
						<</if>>
						<<sex 5 "breasts">>
					<<else>>
						<<if $lactating is 1 and $breastfeedingdisable is "f" and $milk_amount gte 1>>
							<<print $struggle.chest.creature>><span class="pink">将它的<<struggle_appendage chest>>在你的<<breasts>>间抽插着</span>，<span class="pink">奶水从你的乳头漏出。</span>
							<<breastfeed>>
						<<else>>
							<<print $struggle.chest.creature>><span class="pink">将它的<<struggle_appendage chest>>在你的<<breasts>>间抽插着</span>
							<<milkvolume 1>>
						<</if>>
						<<sex 5 "breasts">>
					<</if>>
				<<else>>
					<<struggle_flat_chest>>
				<</if>>
			<<case 4>>
				<<if $player.breastsize gte 3>>
					<<if $struggle.chest.legs is "tentacles">>
						<<if $lactating is 1 and $breastfeedingdisable is "f" and $milk_amount gte 1>>
							<<print $struggle.chest.creature>>的附肢<span class="pink">抵着你的<<breasts>></span>的同时<span class="pink">触手在继续从你的乳头榨出乳汁。</span>
							<<breastfeed>>
						<<else>>
							<<print $struggle.chest.creature>>的附肢<span class="pink">抵着你的<<breasts>></span>的同时<span class="pink">触手在继续挤着你的胸部。</span>
							<<milkvolume 1>>
						<</if>>
						<<sex 5 "breasts">>
					<<else>>
						<<if $lactating is 1 and $breastfeedingdisable is "f" and $milk_amount gte 1>>
							<<print $struggle.chest.creature>>抽插着你的<<breasts>>时<span class="pink">乳汁从你的乳头漏出。</span>生物颤抖着<span class="purple">从它的<<struggle_appendage chest>>里射出一股温暖的液体。</span>
							<<breastfeed>>
						<<else>>
							<<print $struggle.chest.creature>>的<<struggle_appendage chest>>抽插着你的<<breasts>>。生物颤抖着<span class="purple">从它的<<struggle_appendage chest>>里射出一股温暖的液体。</span>
							<<milkvolume 1>>
						<</if>>
						<<sex 5 "breasts">><<bodyliquid "chest" "goo">>
					<</if>>
				<<else>>
					<<struggle_flat_chest>>
				<</if>>
			<<case 5>>
				<<if $player.breastsize gte 3>>
					<<if $struggle.chest.legs is "tentacles">>
						<<if $lactating is 1 and $breastfeedingdisable is "f" and $milk_amount gte 1>>
							<<print $struggle.chest.creature>>的附肢<span class="pink">在你的<<breasts>>间抽插着</span>同时<span class="pink">触手在继续从你的乳头榨出乳汁。</span>
							<<breastfeed>>
						<<else>>
							<<print $struggle.chest.creature>>的附肢<span class="pink">在你的<<breasts>>间抽插着</span>同时<span class="pink">触手在继续挤着你的胸部。</span>
							<<milkvolume 1>>
						<</if>>
						<<sex 5 "breasts">>
					<<else>>
						<<if $lactating is 1 and $breastfeedingdisable is "f" and $milk_amount gte 1>>
							<<print $struggle.chest.creature>>的<<struggle_appendage chest>>抽插着你的<<breasts>>，伴随着每次抽插射出温暖的液体，同时<span class="pink">乳汁从你的乳头漏出。</span>
							<<breastfeed>>
						<<else>>
							<<print $struggle.chest.creature>>的<<struggle_appendage chest>>在你的<<breasts>>间不断地抽插着，射出温暖的液体。
							<<milkvolume 1>>
						<</if>>
						<<sex 5 "breasts">><<bodyliquid "chest" "goo">>
					<</if>>
				<<else>>
					<<struggle_flat_chest>>
				<</if>>
			<<case 6>>
				<<if $player.breastsize gte 3>>
					<<if $struggle.chest.legs is "tentacles">>
						<<if $lactating is 1 and $breastfeedingdisable is "f" and $milk_amount gte 1>>
							<<print $struggle.chest.creature>>的附肢在你的<<breasts>>间抽插着，同时<span class="pink">触手在继续从你的乳头榨出乳汁。</span>生物颤抖着将一股温暖的液体自它的<<struggle_appendage chest>>射出。
							<<breastfeed>>
						<<else>>
							<<print $struggle.chest.creature>>的附肢在你的<<breasts>>间抽插着，同时<span class="pink">触手在继续挤着你的胸部。</span>生物颤抖着将一股温暖的液体自它的<<struggle_appendage chest>>射出。
							<<milkvolume 1>>
						<</if>>
						<<sex 5 "breasts">><<bodyliquid "chest" "goo">>
					<<else>>
						<<if $lactating is 1 and $breastfeedingdisable is "f" and $milk_amount gte 1>>
							<<print $struggle.chest.creature>>的<<struggle_appendage chest>>抽插着你的<<breasts>>，伴随着每次抽插射出温暖的液体，同时<span class="pink">乳汁从你的乳头漏出。</span>
							<<breastfeed>>
						<<else>>
							<<print $struggle.chest.creature>>的<<struggle_appendage chest>>在你的<<breasts>>间不断地抽插着，射出温暖的液体。
							<<milkvolume 1>>
						<</if>>
						<<sex 5 "breasts">><<bodyliquid "chest" "goo">>
					<</if>>
				<<else>>
					<<struggle_flat_chest>>
				<</if>>
			<<case 12>>
				<<if $player.breastsize gte 3>>
					<<print $struggle.chest.creature>>颤抖着<span class="blue">将它的<<struggle_appendage chest>>抽出，</span>从你的<<breasts>>跳开。<<bodyliquid "chest" "goo">>
				<<else>>
					<<print $struggle.chest.creature>><span class="blue">从你的<<breasts>>跳开。</span>
				<</if>>
				<<set $chestuse to 0>>
				<<set $cheststate to 0>>
				<<struggle_part_init "chest" "cum">>
			<<default>>
				<<if $player.breastsize gte 3>>
					<<if $struggle.chest.legs is "tentacles">>
						<<if $lactating is 1 and $breastfeedingdisable is "f" and $milk_amount gte 1>>
							<<print $struggle.chest.creature>>的附肢在你的<<breasts>>间不断地抽插着，射出温暖的液体的同时<span class="pink">触手在继续从你的乳头榨出乳汁。</span>
							<<breastfeed>>
						<<else>>
							<<print $struggle.chest.creature>>的附肢在你的<<breasts>>间不断地抽插着，射出温暖的液体。
							<<milkvolume 1>>
						<</if>>
						<<sex 5 "breasts">><<bodyliquid "chest" "goo">>
					<<else>>
						<<if $lactating is 1 and $breastfeedingdisable is "f" and $milk_amount gte 1>>
							<<print $struggle.chest.creature>>的<<struggle_appendage chest>>抽插着你的<<breasts>>，伴随着每次抽插射出温暖的液体，同时<span class="pink">乳汁从你的乳头漏出。</span>
							<<breastfeed>>
						<<else>>
							<<print $struggle.chest.creature>>的<<struggle_appendage chest>>在你的<<breasts>>间不断地抽插着，射出温暖的液体。
							<<milkvolume 1>>
						<</if>>
						<<sex 5 "breasts">><<bodyliquid "chest" "goo">>
					<</if>>
				<<else>>
					<<struggle_flat_chest>>
				<</if>>
		<</switch>>
		<<set $struggle.chest.progress += 1>>
		<br>
	<</if>>

	<!-- populate an array of unoccupied bodyparts to target -->
	<<set _targets to []>>
	<<if $mouthuse is 0>><<set _targets.push("mouth")>><</if>>
	<<if $vaginause is 0 and $player.vaginaExist>><<set _targets.push("vagina")>><</if>>
	<<if $penisuse is 0 and (playerHasStrapon() or $player.penisExist)>><<set _targets.push("penis")>><</if>>
	<<if $anususe is 0 and $analdisable is "f">><<set _targets.push("anus")>><</if>>
	<<if $chestuse is 0>><<set _targets.push("chest")>><</if>>

	<<for _i to 0; _i lt $struggle.number; _i++>>
		<<if $struggle.enemy[_i].location is "fleeing">>
			<<print $struggle.enemy[_i].description>><<print $struggle.enemy[_i].name.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>
			<<if $struggle.enemy[_i].health gte 1 and $struggle.enemy[_i].satisfied lt 1>>
				<<if $underwater is 1 or $struggle.enemy[_i].motion is "swimming">>
					在你周围游来游去,
				<<elseif $struggle.enemy[_i].motion is "flying">>
					在你周围飞来飞去,
				<<else>>
					降落在附近，
				<</if>>
				<span class="blue">准备侵犯。</span>
				<<set $struggle.enemy[_i].location to "lurking">>
			<<else>>
				<<if $underwater is 1 or $struggle.enemy[_i].motion is "swimming">>
					游进了黑暗中。
				<<elseif $struggle.enemy[_i].motion is "flying">>
					飞走了。
				<<else>>
					跳开。
				<</if>>
				<span class="green">不会再回来了.</span>
				<<set $struggle.done += 1>>
				<<set $struggle.enemy[_i].location to "fled">>
			<</if>>
			<br>
		<<elseif $struggle.enemy[_i].location is "lurking" and _targets.length gt 0>>
			<!-- lurkers attacc -->
			<<rng>>
			<<if $dodging gte 1>>
				<<set _doge_chance to (($feetskill / 3) + (currentSkillValue('danceskill') / 3) - $drunk - (!!$worn.feet.type.includes("heels") * 200))>>
				<<feetskilluse>>
			<</if>>
			<<if $left_guard is 1>>
				<<set _left_guard_chance to ($handskill / 3)>>
				<<handskilluse>>
			<</if>>
			<<if $right_guard is 1>>
				<<set _right_guard_chance to ($handskill / 3)>>
				<<handskilluse>>
			<</if>>
			<<set _hit_chance to random(1, 1000)>>
			<<if _doge_chance gte _hit_chance>>
				<<struggle_bide_the>> <<print $struggle.enemy[_i].description>> <<print $struggle.enemy[_i].name>>
				<<if $underwater is 1 or $struggle.enemy[_i].motion is "swimming">>
					游向你,
				<<elseif $struggle.enemy[_i].motion is "flying">>
					飞向你,
				<<else>>
					向你扑来,
				<</if>>
				<<set $dodging -= 1>>
				<<if $drunk gte 60>>
					但是你酒后踉跄地偏离了道路<<if !random(100)>>仿佛酒神一般<</if>>，
				<<elseif $feetskill gte 800 or currentSkillValue('danceskill') gte 400>>
					但你跳到了一旁，
				<<elseif $feetskill gte 200>>
					但如果你让开,
				<<else>>
					但你却跌跌撞撞地走到一边,
				<</if>>
				<<if _doge_chance - _hit_chance gte 200>>
					<span class="green">躲避了它。</span>
				<<else>>
					<span class="teal">勉强躲过了。</span>
					<<for $_slot range setup.clothingLayer.torso>>
						<<if $worn[$_slot].name isnot "naked">>
							<<set $worn[$_slot].integrity -= random(10, 15)>>
							<<set _clothesdamaged to true>>
							它擦过时脱下了你的$worn[$_slot].cn_name_cap。
							<<break>>
						<</if>>
					<</for>>
					<<if !_clothesdamaged>>
						它在经过时鞭打着你。<<pain 2>>
					<</if>>
					<<neutral 2>>
				<</if>>
			<<elseif _left_guard_chance gte _hit_chance or _right_guard_chance gte _hit_chance>>
				<<struggle_bide_the>> <<print $struggle.enemy[_i].description>> <<print $struggle.enemy[_i].name>>
				<<if $underwater is 1 or $struggle.enemy[_i].motion is "swimming">>
					游向你,
				<<elseif $struggle.enemy[_i].motion is "flying">>
					飞向你,
				<<else>>
					向你扑来,
				<</if>>
				<<if $handskill gte 800>>
					但你恰到好处地打击了它,
				<<elseif $handskill gte 200>>
					但如果你把它撇在一边,
				<<else>>
					但是你的挥舞把它推到一边,
				<</if>>
				<<if _left_guard_chance - _hit_chance gte 200 or _right_guard_chance - _hit_chance gte 200>>
					<span class="green">拍打着地面.</span>
					<<set $struggle.enemy[_i].health -= 1>>
				<<else>>
					<span class="teal">勉强躲过了。</span>
					<<for $_slot range ["over_upper", "over_lower", "upper", "lower", "under_upper", "under_lower"]>>
						<<if $worn[$_slot].name isnot "naked">>
							<<set $worn[$_slot].integrity -= random(10, 15)>>
							<<set _clothesdamaged to true>>
							它擦过时撕坏了你的$worn[$_slot].cn_name_cap。
							<<break>>
						<</if>>
					<</for>>
					<<if !_clothesdamaged>>
						它在经过时鞭打着你。<<pain 2>>
					<</if>>
					<<neutral 2>>
				<</if>>
				<<if _left_guard_chance gte _hit_chance>>
					<<unset $left_guard>>
				<<elseif _right_guard_chance gte _hit_chance>>
					<<unset $right_guard>>
				<</if>>
			<<elseif $rng lte 66 and _targets.length gt 0>>
				<<set _target to _targets.pluck()>>
				<<struggle_bide_the>> <<print $struggle.enemy[_i].description>> <<print $struggle.enemy[_i].name>>
				<<if $underwater is 1 or $struggle.enemy[_i].motion is "swimming">>
					游向你,
				<<elseif $struggle.enemy[_i].motion is "flying">>
					飞向你,
				<<else>>
					向你扑来,
				<</if>>
				<span class="blue">降落在你的<<struggle_region _target>>.</span>
				<<struggle_attach _target>>
				<<set V[_target + 'use'] to "struggle">>
				<<set V[_target + 'state'] to "struggle">>
				<<set V[_target + 'target'] to "struggle">>
			<<elseif random(1, 2) is 2>>
				一条附肢从<<print $struggle.enemy[_i].description>><<print $struggle.enemy[_i].name.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>上长出，并且<span class="blue">对你射出一连串黏液。</span>
				<<random_goo>>
			<<else>>
				<<print $struggle.enemy[_i].description>><<print $struggle.enemy[_i].name.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>等待着可以插入的地方。
				<<set $struggle.enemy[_i].bide to true>>
			<</if>>
			<br>
		<</if>>
	<</for>>
	<<unset $left_guard>>
	<<unset $right_guard>>
	<<if $oxygen lt $oxygenmax and $underwater isnot 1 and _strangle is 1>>
		<<unset _strangle>>
		<br>空气: <<oxygencaption>>
	<</if>>
	<br>
	<<turnend>>
<</widget>>


<<widget "struggle_difficulty">>/*Unused for now*/
	<!-- can be slapped at the end of _pull actions to show difficulty -->
	<<set $_chance to $struggle[_args[0]].success>>
	<<struggle_difficulty_set>>

	| 成功概率 :
	<<if $_chance gte 100>>
		<span class="green"><<print $_chance>>%</span>
	<<elseif $_chance gte 80>>
		<span class="teal"><<print $_chance>>%</span>
	<<elseif $_chance gte 60>>
		<span class="lblue"><<print $_chance>>%</span>
	<<elseif $_chance gte 40>>
		<span class="blue"><<print $_chance>>%</span>
	<<elseif $_chance gte 20>>
		<span class="purple"><<print $_chance>>%</span>
	<<elseif $_chance gte 1>>
		<span class="pink"><<print $_chance>>%</span>
	<<else>>
		<span class="red"><<print $_chance>>%</span>
	<</if>>
<</widget>>

<<widget "struggle_difficulty_set">>
	<<for $_part range ["mouth", "vagina", "penis", "anus", "chest"]>>
		<<set $struggle[$_part].success to Math.trunc(($struggle[$_part].grip * 17) + (currentSkillValue('physique') / 600))>>
		<<if $struggle[$_part].success gte 100>>
			<!-- can't strengthen anymore, default to pull -->
			<<if $leftactiondefault is $_part + '_strengthen'>>
				<<set $leftactiondefault to $_part + '_pull'>>
			<</if>>
			<<if $rightactiondefault is $_part + '_strengthen'>>
				<<set $rightactiondefault to $_part + '_pull'>>
			<</if>>
		<</if>>
	<</for>>
<</widget>>

<<widget "struggle_bide_the">>
	<<if $struggle.enemy[_i].bide is true>>
		<<set $struggle.enemy[_i].bide to false>>
		看到可以插入的地方，那只
	<<else>>
		那只
	<</if>>
<</widget>>

<<widget "struggle_fluid">>
	<<if ["mouth", "vagina", "anus"].includes(_args[0])>>
		<<if $struggle[_args[0]].creature is "lurker" or $struggle.mouth.creature is "slime">>
			<<drugs 25>>
		<<elseif $struggle[_args[0]].creature is "pale slime">>
			<<drugs 50>>
			<<hallucinogen 40>>
		<</if>>
	<</if>>
<</widget>>

<<widget "struggle_clothes">>
	<<if _args[0] is "vagina" or _args[0] is "penis">>
		<<if $worn.over_lower.vagina_exposed is 0 or (setup.clothes.over_lower[clothesIndex('over_lower', $worn.over_lower)].skirt is 1 and $worn.over_lower.skirt_down is 1)>>
			<<set _struggle_exposed to "over">>
		<<elseif $worn.lower.vagina_exposed is 0 or (setup.clothes.lower[clothesIndex('lower', $worn.lower)].skirt is 1 and $worn.lower.skirt_down is 1)>>
			<<set _struggle_exposed to "main">>
		<<elseif $worn.under_lower.vagina_exposed is 0 or (setup.clothes.under_lower[clothesIndex('under_lower', $worn.under_lower)].skirt is 1 and $worn.under_lower.skirt_down is 1)>>
			<<set _struggle_exposed to "under">>
		<<elseif playerChastity()>>
			<<set _struggle_exposed to "genitals">>
		<<else>>
			<<set _struggle_exposed to "naked">>
		<</if>>
	<<elseif _args[0] is "anus">>
		<<if (setup.clothes.over_lower[clothesIndex('over_lower', $worn.over_lower)].skirt is 1 and $worn.over_lower.skirt_down is 1) or $worn.over_lower.anus_exposed is 0>>
			<<set _struggle_exposed to "over">>
		<<elseif $worn.lower.anus_exposed is 0 or (setup.clothes.lower[clothesIndex('lower', $worn.lower)].skirt is 1 and $worn.lower.skirt_down is 1)>>
			<<set _struggle_exposed to "main">>
		<<elseif $worn.under_lower.anus_exposed is 0 or (setup.clothes.under_lower[clothesIndex('under_lower', $worn.under_lower)].skirt is 1 and $worn.under_lower.skirt_down is 1)>>
			<<set _struggle_exposed to "under">>
		<<elseif playerChastity("anus")>>
			<<set _struggle_exposed to "genitals">>
		<<else>>
			<<set _struggle_exposed to "naked">>
		<</if>>
	<<elseif _args[0] is "chest">>
		<<if !$worn.over_upper.type.includes("naked") and $worn.over_upper.exposed lt 2>>
			<<set _struggle_exposed to "over_top">>
		<<elseif !$worn.upper.type.includes("naked") and $worn.upper.exposed lt 2>>
			<<set _struggle_exposed to "main_top">>
		<<elseif !$worn.under_upper.type.includes("naked") and $worn.under_upper.exposed is 0>>
			<<set _struggle_exposed to "under_top">>
		<<else>>
			<<set _struggle_exposed to "naked">>
		<</if>>
	<<elseif _args[0] is "mouth">>
		<<if $worn.face.type.includes("covered") or $worn.face.type.includes("gag")>>
			<<set _struggle_exposed to "mask">>
		<<else>>
			<<set _struggle_exposed to "naked">>
		<</if>>
	<</if>>

	<<if _struggle_exposed is "over_top">>
		<<set $struggle[_args[0]].progress -= 1>>
		<<if $struggle[_args[0]].legs is "tentacles">>
			<<print $struggle[_args[0]].creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>的触手撕破你的$worn.over_upper.cn_name_cap寻找着插入的地方。<<neutral 2>><<set $worn.over_upper.integrity -= 10>>
		<<else>>
			<<print $struggle[_args[0]].creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>的附肢穿过你$worn.over_upper.cn_name_cap进入你的<<struggle_bodypart _args[0]>>。<<neutral 1>>
		<</if>>
		<<set $worn.over_upper.integrity -= 10>>
		<<if $struggle[_args[0]].creature is "slime">>
			<span class="purple">布料在粘液中溶解时发出嘶嘶声.</span><<set $worn.over_upper.integrity -= 30>>
		<<elseif $struggle[_args[0]].creature is "pale slime">>
			<span class="purple">衣物伴随着强烈的嘶嘶声在苍白史莱姆里溶解。</span><<set $worn.over_upper.integrity -= 50>>
		<</if>>
		<<if $worn.over_upper.integrity lte 0>>
			<<integritycheck no_text>><<exposure>>
			<<if $struggle[_args[0]].legs is "tentacles">>
				触手卷起衣物的边缘，随后<span class="pink">瞬间就将它们从你身上撕下，露出你的<<top>>。</span>
			<<else>>
				它的附肢刺穿衣物，随后<span class="pink">瞬间就将它们从你身上撕下，露出你的<<top>>。</span>
			<</if>>
		<</if>>
	<<elseif _struggle_exposed is "main_top">>
		<<set $struggle[_args[0]].progress -= 1>>
		<<if $struggle[_args[0]].legs is "tentacles">>
			<<print $struggle[_args[0]].creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>的触手撕破你的$worn.upper.cn_name_cap寻找着插入的地方。<<neutral 2>><<set $worn.upper.integrity -= 10>>
		<<else>>
			<<print $struggle[_args[0]].creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>的附肢穿过你$worn.upper.cn_name_cap进入你的<<struggle_bodypart _args[0]>>。<<neutral 1>>
		<</if>>
		<<set $worn.upper.integrity -= 10>>
		<<if $struggle[_args[0]].creature is "slime">>
			<span class="purple">衣物伴随着嘶嘶声在史莱姆里溶解。</span><<set $worn.upper.integrity -= 30>>
		<<elseif $struggle[_args[0]].creature is "pale slime">>
			<span class="purple">衣物伴随着强烈的嘶嘶声在苍白史莱姆里溶解。</span><<set $worn.upper.integrity -= 50>>
		<</if>>
		<<if $worn.upper.integrity lte 0>>
			<<integritycheck no_text>><<exposure>>
			<<if $struggle[_args[0]].legs is "tentacles">>
				触手缠绕着你的衣服，随后<span class="pink">瞬间就将它撕掉，露出你的<<undertop>>。</span>
			<<else>>
				它的附肢刺穿衣物，随后<span class="pink">瞬间就将它撕掉，露出你的<<undertop>>。</span>
			<</if>>
		<</if>>
	<<elseif _struggle_exposed is "under_top">>
		<<set $struggle[_args[0]].progress -= 1>>
		<<if $struggle[_args[0]].legs is "tentacles">>
			<<print $struggle[_args[0]].creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>的触手撕开你的$worn.under_upper.cn_name_cap找寻可以插入的地方。<<neutral 3>><<set $worn.under_upper.integrity -= 10>>
		<<else>>
			<<print $struggle[_args[0]].creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>的附肢戳入你的$worn.under_upper.cn_name_cap。
		<</if>>
		<<set $worn.under_upper.integrity -= 10>>
		<<if $struggle[_args[0]].creature is "slime">>
			<span class="purple">布料在粘液中溶解时发出嘶嘶声.</span><<set $worn.under_upper.integrity -= 30>>
		<<elseif $struggle[_args[0]].creature is "pale slime">>
			<span class="purple">衣物伴随着强烈的嘶嘶声在苍白史莱姆里溶解。</span><<set $worn.under_upper.integrity -= 50>>
		<</if>>
		<<if $worn.under_upper.integrity lte 0>>
			<<integritycheck no_text>><<exposure>>
			<<if $struggle[_args[0]].legs is "tentacles">>
				触手缠绕着你的衣服，随后<span class="pink">瞬间就将它撕掉，露出你的<<breasts>>。</span>
			<<else>>
				它的附肢刺穿衣物，随后<span class="pink">瞬间就将它撕掉，露出你的<<breasts>>。</span>
			<</if>>
		<</if>>
	<<elseif _struggle_exposed is "over">>
		<<set $struggle[_args[0]].progress -= 1>>
		<<if $struggle[_args[0]].legs is "tentacles">>
			<<print $struggle[_args[0]].creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>的触手撕开你的$worn.over_lower.cn_name_cap，想要够到下面的<<struggle_bodypart _args[0]>>。<<neutral 2>><<set $worn.over_lower.integrity -= 10>>
		<<else>>
			<<print $struggle[_args[0]].creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>的触手撕开你的$worn.over_lower.cn_name_cap，想要够到下面的<<struggle_bodypart _args[0]>>。<<neutral 1>>
		<</if>>
		<<set $worn.over_lower.integrity -= 10>>
		<<if $struggle[_args[0]].creature is "slime">>
			<span class="purple">布料在粘液中溶解时发出嘶嘶声.</span><<set $worn.over_lower.integrity -= 30>>
		<<elseif $struggle[_args[0]].creature is "pale slime">>
			<span class="purple">衣物伴随着强烈的嘶嘶声在苍白史莱姆里溶解。</span><<set $worn.over_lower.integrity -= 50>>
		<</if>>
		<<if $worn.over_lower.integrity lte 0>>
			<<integritycheck no_text>><<exposure>>
			<<if $struggle[_args[0]].legs is "tentacles">>
				触手缠绕着你的衣服，随后<span class="pink">瞬间就将它撕掉，露出你的<<crotch>>。</span>
			<<else>>
				它的附肢刺穿衣物，随后<span class="pink">瞬间就将它撕掉，露出你的<<crotch>>。</span>
			<</if>>
		<</if>>
	<<elseif _struggle_exposed is "main">>
		<<set $struggle[_args[0]].progress -= 1>>
		<<if $struggle[_args[0]].legs is "tentacles">>
			<<print $struggle[_args[0]].creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>的触手撕开你的$worn.lower.cn_name_cap，想要够到下面的<<struggle_bodypart _args[0]>>。<<neutral 2>><<set $worn.lower.integrity -= 10>>
		<<else>>
			<<print $struggle[_args[0]].creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>的触手撕开你的$worn.lower.cn_name_cap，想要够到下面的<<struggle_bodypart _args[0]>>。<<neutral 1>>
		<</if>>
		<<set $worn.lower.integrity -= 10>>
		<<if $struggle[_args[0]].creature is "slime">>
			<span class="purple">布料在粘液中溶解时发出嘶嘶声.</span><<set $worn.lower.integrity -= 30>>
		<<elseif $struggle[_args[0]].creature is "pale slime">>
			<span class="purple">衣物伴随着强烈的嘶嘶声在苍白史莱姆里溶解。</span><<set $worn.lower.integrity -= 50>>
		<</if>>
		<<if $worn.lower.integrity lte 0>>
			<<integritycheck no_text>><<exposure>>
			<<if $struggle[_args[0]].legs is "tentacles">>
				触手缠绕着你的衣服，随后<span class="pink">瞬间就将它撕掉，露出你的<<undies>>。</span>
			<<else>>
				它的附肢刺穿衣物，随后<span class="pink">瞬间就将它撕掉，露出你的<<undies>>。</span>
			<</if>>
		<</if>>
	<<elseif _struggle_exposed is "under">>
		<<set $struggle[_args[0]].progress -= 1>>
		<<if $struggle[_args[0]].legs is "tentacles">>
			<<print $struggle[_args[0]].creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>的触手蜂拥进你的$worn.under_lower.cn_name_cap，想要够到下面的<<struggle_bodypart _args[0]>>。<<neutral 2>><<set $worn.under_lower.integrity -= 10>>
		<<else>>
			<<print $struggle[_args[0]].creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>的触手撕开你的$worn.under_lower.cn_name_cap，想要够到下面的<<struggle_bodypart _args[0]>>。<<neutral 1>>
		<</if>>
		<<set $worn.under_lower.integrity -= 10>>
		<<if $struggle[_args[0]].creature is "slime">>
			<span class="purple">布料在粘液中溶解时发出嘶嘶声.</span><<set $worn.under_lower.integrity -= 30>>
		<<elseif $struggle[_args[0]].creature is "pale slime">>
			<span class="purple">衣物伴随着强烈的嘶嘶声在苍白史莱姆里溶解。</span><<set $worn.under_lower.integrity -= 50>>
		<</if>>
		<<if $worn.under_lower.integrity lte 0>>
			<<integritycheck no_text>><<exposure>>
			<<if $struggle[_args[0]].legs is "tentacles">>
				它的触手蜂拥进衣物，随后<span class="pink">瞬间就将它撕掉，露出你的<<genitals>>。</span>
			<<else>>
				它的附肢刺穿衣物，随后<span class="pink">瞬间就将它撕掉，露出你的<<genitals>>。</span>
			<</if>>
		<</if>>
	<<elseif _struggle_exposed is "genitals">>
		<<set $struggle[_args[0]].progress -= 1>>
		<<if $struggle[_args[0]].legs is "tentacles">>
			<<print $struggle[_args[0]].creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>的触手蜂拥在你的$worn.genitals.cn_name_cap下方，摩擦着你的<<struggle_bodypart _args[0]>>想要找到可以插入的地方。<<neutral 2 "genitals">><<set $worn.genitals.integrity -= 10>>
		<<else>>
			<<print $struggle[_args[0]].creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>的触手撕扯着你的$worn.under_lower.cn_name_cap，想要进到你的<<struggle_bodypart _args[0]>>下方。<<neutral 1 "genitals">><<set $worn.genitals.integrity -= 10>>
		<</if>>
		<<if $struggle[_args[0]].creature is "slime">>
			<span class="purple">物质在粘液中溶解时发出嘶嘶声.</span><<set $worn.genitals.integrity -= 30>>
		<<elseif $struggle[_args[0]].creature is "pale slime">>
			<span class="purple">衣物伴随着强烈的嘶嘶声在苍白史莱姆里溶解。</span><<set $worn.genitals.integrity -= 50>>
		<</if>>
		<<if $worn.genitals.integrity lte 0>>
			<<integritycheck no_text>><<exposure>>
			<<if $struggle[_args[0]].legs is "tentacles">>
				触手缠绕并拉扯着物质。物质发出不堪重负的声音<span class="pink">瞬间<<print $struggle[_args[0]].creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>就将它从你身上扯下，露出你的<<genitals>>。</span>
			<<else>>
				它的附肢穿刺并拉扯着物质。物质发出不堪重负的声音<span class="pink">瞬间<<print $struggle[_args[0]].creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>就将它从你身上扯下，露出你的<<genitals>>。</span>
			<</if>>
		<<else>>
			<<if $struggle[_args[0]].damage gte 10>>
				它在扯下物质时把自己伤到了，<span class="green">从你身上跳开。</span>
				<<if _args[0] is "vagina">>
					<<set $vaginause to 0>>
					<<set $vaginastate to 0>>
					<<struggle_part_init "vagina">>
					<<set $struggle.warded += 1>>
					<<struggleClearActions "vagina_">>
				<<elseif _args[0] is "penis">>
					<<set $penisuse to 0>>
					<<set $penisstate to 0>>
					<<struggle_part_init "penis">>
					<<set $struggle.warded += 1>>
					<<struggleClearActions "penis_">>
				<<else>>
					<<set $anususe to 0>>
					<<set $anusstate to 0>>
					<<struggle_part_init "anus">>
					<<set $struggle.warded += 1>>
					<<struggleClearActions "anus_">>
				<</if>>
			<<else>>
				它在扯下物质时把自己伤到了。
				<<set $struggle[_args[0]].damage += 1>>
			<</if>>
		<</if>>
	<<elseif _struggle_exposed is "mask">>
		<<set $struggle[_args[0]].progress -= 1>>
		<<if $struggle[_args[0]].legs is "tentacles">>
			<<print $struggle[_args[0]].creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>的触手蜂拥进你的$worn.face.cn_name_cap，想要够到下面的<<struggle_bodypart _args[0]>>。<<neutral 2>><<damageFaceCover 5 struggle>>
		<<else>>
			<<print $struggle[_args[0]].creature.replace("pale slime","苍白史莱姆").replace("slime","史莱姆").replace("slug","蛞蝓").replace("lurker","潜伏者").replace("wasp","黄蜂").replace("bee","蜜蜂").replace("squid","鱿鱼").replace("mosquito","蚊子")>>撕扯着你的$worn.face.cn_name_cap，想要够到下面的<<struggle_bodypart _args[0]>>。<<neutral 1>>
		<</if>>
		<<damageFaceCover 5 struggle>>
		<<if $struggle[_args[0]].creature is "slime">>
			<span class="purple">布料在粘液中溶解时发出嘶嘶声.</span><<damageFaceCover 20 struggle>>
		<<elseif $struggle[_args[0]].creature is "pale slime">>
			<span class="purple">衣物伴随着强烈的嘶嘶声在苍白史莱姆里溶解。</span><<damageFaceCover 30 struggle>>
		<</if>>
		<<if $worn.face.integrity lte 0>>
			<<if $struggle[_args[0]].legs is "tentacles">>
				触手蜂拥进衣物下面，随后<span class="pink">瞬间将它从你身上撕下，露出你的嘴巴。</span>
			<<else>>
				它的附肢刺穿衣物，随后<span class="pink">瞬间就将它撕掉，露出你的嘴巴。</span>
			<</if>>
			<<faceruined>><<set $worn.face.type.push("broken")>>
		<</if>>
	<<elseif _struggle_exposed is "naked">>
		<<if _args[0] is "vagina">>
			<<print $struggle[_args].creature>>的附肢<span class="purple">抵在你的<<pussy>>上。</span><<neutral 4 "genitals">>
		<<elseif _args[0] is "penis">>
			<<print $struggle[_args].creature>><span class="purple">将小穴抵在你的<<penis>>上。</span><<neutral 4 "genitals">>
		<<elseif _args[0] is "anus">>
			<<print $struggle[_args].creature>>的附肢<span class="purple">抵在你的<<bottom>>上。</span><<neutral 4 "bottom">>
		<<elseif _args[0] is "chest">>
			<<print $struggle[_args].creature>>的附肢<span class="purple">抵在你的<<breasts>>上。</span><<neutral 4 "breasts">>
		<<elseif _args[0] is "mouth">>
			<<print $struggle[_args].creature>>的附肢<span class="purple">抵在你的嘴上。</span><<neutral 4 "mouth">>
		<</if>>
	<</if>>
<</widget>>

<<widget "struggle_bodypart">><<silently>>
	<<switch _args[0]>>
		<<case "vagina">>
			<<pussy>>
		<<case "penis">>
			<<penis>>
		<<case "anus">>
			<<bottom>>
		<<case "chest">>
			<<breasts>>
		<<case "mouth">>
			<<set _text_output to "嘴巴">>
	<</switch>>
<</silently>><<print _text_output>>
<</widget>>

<<widget "struggle_appendage">><<silently>>
	<<switch $struggle[_args[0]].creature>>
		<<case "wasp" "bee">>
			<<set $_text_output to "刺">>
		<<case "squid">>
			<<set $_text_output to "触手">>
		<<default>>
			<<set $_text_output to "附肢">>
	<</switch>>
<</silently>><<print $_text_output>>
<</widget>>

<<widget "struggle_skin">><<silently>>
	<<switch $struggle[_args[0]].creature>>
		<<case "wasp" "bee">>
			<<set $_text_output to "甲壳">>
		<<default>>
			<<set $_text_output to "肉体">>
	<</switch>>
<</silently>><<print $_text_output>>
<</widget>>

<<widget "struggle_flat_chest">>
	<<if $struggle.chest.legs is "tentacles">>
		<<if $lactating is 1 and $breastfeedingdisable is "f" and $milk_amount gte 1>>
			<<print $struggle.chest.creature>>的触手不时挤着你的<<breasts>>，<span class="pink">乳汁从你的乳头漏出。</span>
		<<else>>
			<<print $struggle.chest.creature>>的触手不时挤着并玩弄你的<<breasts>>
		<</if>>
		<<sex 5 "breasts">>
	<<else>>
		<<if $lactating is 1 and $breastfeedingdisable is "f" and $milk_amount gte 1>>
			<<print $struggle.chest.creature>>吸吮着你的<<breasts>>，<span class="pink">乳汁从你的乳头漏出。</span>
			<<breastfeed>><<sex 3 "breasts">>
		<<else>>
			<<print $struggle.chest.creature>>吮吸着你的<<breasts>>的同时它的<<struggle_appendage chest>>摩擦着你的小腹。
			<<milkvolume 1>><<sex 5 "breasts">>
		<</if>>
		<<sex 3 "breasts">>
	<</if>>
<</widget>>

<<widget "struggle_attach">>
	<<set $struggle[_args[0]].creature to $struggle.enemy[_i].name>>
	<<set $struggle[_args[0]].description to $struggle.enemy[_i].description>>
	<<set $struggle[_args[0]].legs to $struggle.enemy[_i].legs>>
	<<set $struggle.enemy[_i].location to _args[0]>>
	<!-- temp var to highlight newly attached lurkers -->
	<<set T['gold_' + _args[0]] to true>>
<</widget>>


<<widget "struggleClearActions">>
	<<if _args[0]>>
		<<if ($mouthaction).toString().includes(_args[0])>>
			<<set $mouthactiondefault to $mouthaction>><<set $mouthaction to 0>>
		<</if>>
		<<if ($leftaction).toString().includes(_args[0])>>
			<<set $leftactiondefault to $leftaction>><<set $leftaction to 0>>
		<</if>>
		<<if ($rightaction).toString().includes(_args[0])>>
			<<set $rightactiondefault to $rightaction>><<set $rightaction to 0>>
		<</if>>
		<<if ($leftarmstate).toString().includes(_args[0])>>
			<<set $leftarm to 0>><<set $leftarmstate to 0>>
		<</if>>
		<<if ($rightarmstate).toString().includes(_args[0])>>
			<<set $rightarm to 0>><<set $rightarmstate to 0>>
		<</if>>
	<</if>>
<</widget>>

<<widget "struggle_region">><<silently>>
	<<if ["mouth","vagina","penis","anus","chest"].includes(_args[0])>>
		<<switch _args[0]>>
			<<case "mouth">><<set _text_output to "头">>
			<<case "vagina">><<set _text_output to "小腹">>
			<<case "penis">><<set _text_output to "腹部">>
			<<case "anus">><<set _text_output to "屁股">>
			<<case "chest">><<set _text_output to "胸口">>
		<</switch>>
	<</if>>
	<</silently>><<print _text_output>>
<</widget>>
