:: Widgets Market [widget]
<<widget "stall_actions">>
	<<if $stress gte $stressmax>>
		<<passoutstreet>>
	<<elseif $worn.upper.type.includes("naked") and $player.gender_appearance is "f">>
		<<if $player.gender is "m">>
			你不能在露出<<breasts>>的情况下这样做。至少在看起来像个女孩儿的情况下是不可以的。你应该避免人群并且想办法逃跑。
		<<else>>
			你不能在露出<<breasts>>的情况下这样做。你躲避并逃跑。
		<</if>>
		<br><br>
		<<link [[继续|Connudatus Street]]>><<endevent>><<endstall>><<clotheson>><<set $eventskip to 1>><</link>>
		<br>
	<<else>>
		<<if random(1, 10000) is 10000>>
			<<link [[资本主义 呵! (0:20)|Stall]]>><<endevent>><<endstall>><<pass 20>><</link>>
			<br>
		<<else>>
			<<link [[继续 (0:20)|Stall]]>><<endevent>><<endstall>><<pass 20>><</link>>
			<br>
		<</if>>
		<<if $worn.lower.name isnot "naked">>
			<<if $worn.under_lower.name isnot "naked">>
				<<if $worn.upper.set isnot $worn.lower.set>>
					<<if $exhibitionism gte 15>>
						<<link [[脱下你的下装|Stall Bottoms Strip]]>><<endevent>><<endstall>><</link>><<if $daily.ex.stall isnot 1>><<exhibitionist2>><</if>>
						<br>
					<</if>>
				<</if>>
			<<else>>
				<<if $worn.upper.set isnot $worn.lower.set>>
					<<if $exhibitionism gte 55>>
						<<link [[脱下你的下装|Stall Bottoms Strip]]>><<endevent>><<endstall>><</link>><<if $daily.ex.stall isnot 1>><<exhibitionist4>><</if>>
						<br>
					<</if>>
				<</if>>
			<</if>>
		<<elseif $worn.under_lower.name isnot "naked">>
			<<if $worn.under_lower.set isnot $worn.under_upper.set>>
				<<if $exhibitionism gte 55>>
					<<link [[脱掉你的内裤|Stall Undies Strip]]>><<endevent>><<endstall>><</link>><<if $daily.ex.stall isnot 1>><<exhibitionist4>><</if>>
					<br>
				<</if>>
			<</if>>
		<</if>>
		<<if $exhibitionism gte 35>>
			<<link [[自慰|Stall Masturbation]]>><<endevent>><<endstall>><<set $phase to 0>><<set $masturbationstart to 1>><</link>><<if $daily.ex.stall isnot 1>><<exhibitionist3>><</if>>
			<br>
		<</if>>
		<<link [[离开|Connudatus Street]]>><<endevent>><<endstall>><<clotheson>><<set $eventskip to 1>><</link>>
		<br>
	<</if>>
<</widget>>

<<widget "stall_inventory">>
	<<silently>>
		<<set $plant_inventory to []>>
		<<set _plant_keys to Object.keys($plants)>>
		<<set _total_worth to 0>>
		<<set _total_amount to 0>>
		<<set _total_sold_amount to 0>>
		<<for _t to 0; _t lt _plant_keys.length; _t++>>
			<<if ndef $stall_stats[_plant_keys[_t]]>>
				<<set $stall_stats[_plant_keys[_t]] to { inventory:{amount:0, price:0, total:0}, sold:{amount:0, total:0} }>>
			<</if>>
			<<if $plants[_plant_keys[_t]].amount gte 1>>
				<<set _plant_value to Math.round(setup.plants[$plants[_plant_keys[_t]].name].plant_cost)>>
				<<set _total_worth += $plants[_plant_keys[_t]].amount * _plant_value>>
				<<set _total_amount += $plants[_plant_keys[_t]].amount>>
				<<set _inventory_found to 1>>
				<<run $plant_inventory.push($plants[_plant_keys[_t]].name)>>
				<<if ($stall_expensive is undefined) or ($plants[$stall_expensive].amount lte 0) or (setup.plants[$plants[_plant_keys[_t]].name].plant_cost gte setup.plants[$stall_expensive].plant_cost)>>
					<<set $stall_expensive to clone(setup.plants[$plants[_plant_keys[_t]].name].name)>>
				<</if>>
				<<set $stall_stats[_plant_keys[_t]].inventory to {amount:$plants[_plant_keys[_t]].amount, price:_plant_value, total:($plants[_plant_keys[_t]].amount * _plant_value)}>>
			<<else>>
				<<set $stall_stats[_plant_keys[_t]].inventory to {amount:0, price:Math.round(setup.plants[$plants[_plant_keys[_t]].name].plant_cost), total:0}>>
			<</if>>
			<<set _total_sold_amount += $stall_stats[_plant_keys[_t]].sold.amount>>
		<</for>>
	<</silently>>

	<<switch $mathstrait>>
		<<case -1>><!-- F -->
			<<set _canmath to ($maths_exam lt 50 ? 0 : 1)>>
		<<case 0>><!-- D -->
			<<set _canmath to ($maths_exam lt 50 ? 2 : 3)>>
		<<case 1>><!-- C -->
			<<set _canmath to 4>>
		<<case 2>><!-- B -->
			<<set _canmath to 5>>
		<<case 3 4>><!-- A, A* -->
			<<set _canmath to 6>>
		<<default>>
			<<set _canmath to 0>>
	<</switch>>

	<<set _mobile to ($options.useNarrowMarket and _canmath gt 4)>>

	<!-- <<for _mobile to 0; _mobile lt 2; _mobile++>><<for _canmath to 0; _canmath lt 7; _canmath++>><center>---mobile:_mobile math:_canmath---</center> -->

	<!--
	_canmath			:	0		1		2		3		4		5		6
	table				:	-		-		-		x		x		x		x

	item inventory worth	:	-		-		-		-		x		x		x
	total inventory worth	:	-		-		txt		txt		x		x		x

	sold average			:	-		-		-		-		-		-		x
	per item sold			:	-		-		-		-		-		x		x
	total sold				:	-		txt		txt		txt		txt		x		x

	math skill min			:	F		F50		D		D50		C		B		A	A*
	colums					:	-		-		-		2+0		3+0		3+2		3+3
	total colums			:	-		-		-		2		3		5		6
	-->

	<<if _canmath gte 3>>
		<center style="max-height:50vh;overflow-y:auto">
			<table border="1" style="background-color:#c0ffff08;font-size:95%"><!-- TODO: Put that CSS in some stylesheet -->
				<<if _mobile and 0>>
					<tr>
						<<switch _canmath>>
							<<case 3>>
								<th colspan="2" align="left">物品</th>
							<<case 4>>
								<th colspan="3" align="left">物品</th>
							<<case 5>>
								<th colspan="4" align="left">物品</th>
							<<case 6>>
								<th colspan="6" align="left">物品</th>
						<</switch>>
					</tr>
				<</if>>
				<tr>
					<<if not _mobile>>
						<th rowspan="2" style="border-bottom-width:2px" valign="middle" width="40%" align="left">物品</th>
					<</if>>
					<<switch _canmath>>
						<<case 3>>
							<th colspan="2" align="center">物品栏</th>
						<<case 4 5 6>>
							<th colspan="3" align="center">物品栏</th>
					<</switch>>
					<<switch _canmath>>
						<<case 5>>
							<th colspan="2" align="center">已售出</th>
						<<case 6>>
							<th colspan="3" align="center">已售出</th>
					<</switch>>
				</tr>
				<tr>
					<th style="border-bottom-width:2px;min-width:7ch" align="center">数量</th>
					<th style="border-bottom-width:2px;min-width:7ch" align="center">单价</th>
					<<if _canmath gte 4>>
						<th style="border-bottom-width:2px;min-width:7ch" align="center">总价</th>
					<</if>>
					<<if _canmath gte 5>>
						<th style="border-bottom-width:2px;min-width:7ch" align="center">数量</th>
						<<if _canmath gte 6>>
							<th style="border-bottom-width:2px;min-width:7ch" align="center">均价</th>
						<</if>>
						<th style="border-bottom-width:2px;min-width:7ch" align="center">总价</th>
					<</if>>
				</tr>

				<<for _t to 0; _t lt _plant_keys.length; _t++>>
					<<if $stall_stats[_plant_keys[_t]].inventory.amount gt 0 or (_canmath gte 5 and $stall_stats[_plant_keys[_t]].sold.amount gt 0)>>
						<<if _mobile>>
							<tr>
								<td align="left" colspan="6" style="border-top-width:2px"><<print $plants[_plant_keys[_t]].plural.charAt(0).toUpperCase() + $plants[_plant_keys[_t]].plural.slice(1)>></td>
							</tr>
						<</if>>
						<tr>
							<<if not _mobile>>
								<td align="left"><<print $plants[_plant_keys[_t]].plural.charAt(0).toUpperCase() + $plants[_plant_keys[_t]].plural.slice(1)>></td>
							<</if>>
							<<if $stall_stats[_plant_keys[_t]].inventory.amount gt 0>>
								<td align="right"><<print $stall_stats[_plant_keys[_t]].inventory.amount>></td>
								<td align="right"><<printmoney $stall_stats[_plant_keys[_t]].inventory.price>></td>
								<<if _canmath gte 4>>
									<td align="right"><<printmoney $stall_stats[_plant_keys[_t]].inventory.total>></td>
								<</if>>
							<<else>>
								<td align="right">-&nbsp;</td>
								<td align="right"><<printmoney $stall_stats[_plant_keys[_t]].inventory.price>></td>
								<<if _canmath gte 4>>
									<td align="right">-&nbsp;</td>
								<</if>>
							<</if>>
							<<if _canmath gte 5>>
								<<if $stall_stats[_plant_keys[_t]].sold.amount gt 0>>
									<td align="right"><<print $stall_stats[_plant_keys[_t]].sold.amount>></td>
									<<if _canmath gte 6>>
										<td align="right"><<set _avg to Math.round($stall_stats[_plant_keys[_t]].sold.total / $stall_stats[_plant_keys[_t]].sold.amount)>><<printmoney _avg>></td>
									<</if>>
									<td align="right"><<printmoney $stall_stats[_plant_keys[_t]].sold.total>></td>
								<<else>>
									<td align="right">-&nbsp;</td>
									<<if _canmath gte 6>>
										<td align="right">-&nbsp;</td>
									<</if>>
									<td align="right">-&nbsp;</td>
								<</if>>
							<</if>>
						</tr>
					<</if>>
				<</for>>

				<<if _canmath gte 4>>
					<tr>
						<<if not _mobile>>
							<th style="border-top-width:4px;border-top-style:double" align="left">总共</th>
						<</if>>
						<td style="border-top-width:4px;border-top-style:double" align="right">_total_amount</td>
						<td style="border-top-width:4px;border-top-style:double"></td>
						<td style="border-top-width:4px;border-top-style:double" align="right"><<printmoney _total_worth>></td>
						<<if _canmath gte 5>>
							<td style="border-top-width:4px;border-top-style:double" align="right">_total_sold_amount</td>
							<<if _canmath gte 6>>
								<td style="border-top-width:4px;border-top-style:double"></td>
							<</if>>
							<td style="border-top-width:4px;border-top-style:double" align="right"><<printmoney $stall_money>></td>
						<</if>>
					</tr>
				<</if>>
			</table>
		</center>
	<<elseif _inventory_found is 1>>
		库存:
		<<set _first to 1>>
		<<for _t to 0; _t lt _plant_keys.length; _t++>>
			<<if $stall_stats[_plant_keys[_t]].inventory.amount gt 0>>
				<<if _first>>
					<<if $options.images is 1 and $plants[_plant_keys[_t]].icon>>
						<img class="tending_icon" @src="`img/misc/icon/tending/` + $plants[_plant_keys[_t]].icon">
					<</if>>
					<span class="gold"><<print $stall_stats[_plant_keys[_t]].inventory.amount>></span>
					<<print $plants[_plant_keys[_t]].plural.charAt(0).toUpperCase() + $plants[_plant_keys[_t]].plural.slice(1)>>
					(单价：<<printmoney _plant_value>>)
				<<else>>
					|
					<<if $options.images is 1 and $plants[_plant_keys[_t]].icon>>
						<img class="tending_icon" @src="`img/misc/icon/tending/` + $plants[_plant_keys[_t]].icon">
					<</if>>
					<span class="gold"><<print $stall_stats[_plant_keys[_t]].inventory.amount>></span>
					<<print $plants[_plant_keys[_t]].plural>>
					(单价：<<printmoney _plant_value>>)
				<</if>>
				<<set _first to 0>>
			<</if>>
		<</for>>
		<br>
	<<else>>
		物品栏：已售罄！<br>
	<</if>>

	<<switch _canmath>>
		<<case 1>>
			<<if $stall_money is 0>>
				你还没开张。
			<<else>>
				你今天已经获得了<<printmoney $stall_money>>。
			<</if>>
		<<case 2>>
			<<if $stall_money is 0>>
				<<if _inventory_found is 1>>
					你的物品总价值为<<printmoney _total_worth>>。
				<</if>>
				你还没开张。
			<<else>>
				<<if _inventory_found is 1>>
					你剩余的物品总价值为<<printmoney _total_worth>>。
				<</if>>
				你今天已经获得了<<printmoney $stall_money>>。
			<</if>>
		<<case 3>>
			<center>
				<<if $stall_money is 0>>
					<<if _inventory_found is 1>>
						你的物品总价值为<<printmoney _total_worth>>。
					<</if>>
					你还没开张。
				<<else>>
					<<if _inventory_found is 1>>
						你剩余的物品总价值为<<printmoney _total_worth>>。
					<</if>>
					你今天已经获得了<<printmoney $stall_money>>。
				<</if>>
			</center>
		<<case 4>>
			<center>
				<<if $stall_money is 0>>
					你还没开张。
				<<else>>
					你今天已经获得了<<printmoney $stall_money>>。
				<</if>>
			</center>
	<</switch>>

	<!-- <</for>><</for>> -->
<</widget>>

<<widget "endstall">>
	<<unset $plant_inventory>>
	<<unset $stall_amount>>
	<<unset $stall_plant>>
	<<unset $stall_cost>>
	<<unset $stall_expensive>>
<</widget>>

<<widget "stall_sell">>
	<<if ndef $stall_stats[$stall_plant]>>
		<<set $stall_stats[$stall_plant] to { inventory:{amount:0, price:0, total:0}, sold:{amount:0, total:0} }>>
	<</if>>
	<<set $stall_stats[$stall_plant].sold.amount += $stall_amount>>
	<<set $stall_stats[$stall_plant].sold.total += Math.round($stall_cost * $stall_amount)>>

	<<set $plants[$stall_plant].amount -= $stall_amount>>
	<<set $money += Math.round($stall_cost * $stall_amount)>>
	<<set $stall_money += Math.round($stall_cost * $stall_amount)>>
	<<set $produce_sold += $stall_amount>>
	你出售
	<<if $stall_amount gte 2>>
		$stall_amount个<<print setup.plants[$stall_plant].plural>>
	<<else>>
		一个<<print setup.plants[$stall_plant].plural>>
	<</if>>
	，获得了<<printmoney `$stall_cost * $stall_amount`>>
	<<if $stall_cost * $stall_amount / 100 gte 10000>>
		赚大钱的滋味真棒。
		<<ltrauma>><<lstress>>
	<</if>>
	<<famebusiness 1>>
<</widget>>

<<widget "eventsstall">>
	<<rng 10>>
	<<if $stall_rejected gte random(1, 200)>>
		<<if $rng is 1>>
			<<generate1>><<person1>>
			你听到了身后的脚步声。
			<<if $worn.lower.type.includes("naked")>>
				<<if $worn.under_lower.type.includes("naked")>>
					没等你转身，一双手就抓住了你的腰，并抓到了你的<<genitals>>上
					<<gtrauma>><<gstress>><<trauma 6>><<stress 6>>
					<br><br>

					"早听说这个小摊的摊主是个浪货"一个<<personsimple>>的声音说道"但我可没想到<<phim>>下面居然什么都没穿"<<He>>把玩着你。
					<br><br>

				<<else>>
					没等你转身，一双手就环住了你的腰，并隔着你的$worn.under_lower.cn_name_cap开始把玩你那<<genitals>>
					<<gtrauma>><<gstress>><<trauma 6>><<stress 6>>
					<br><br>

					"早听说这个小摊的摊主是个浪货"一个<<personsimple>>的声音说道"但我可没想到<<phim>>下面居然只穿了条内衣"<<He>>把玩着你。
					<br><br>
				<</if>>
			<<else>>
				<<if $player.gender_appearance is "f">>
					没等你转身，一双手就从你的腋下钻出，揉捏起了你的<<breasts>>
					<<gtrauma>><<gstress>><<trauma 6>><<stress 6>>
					<br><br>

					"别骗我了"一个<<personsimple>>的声音说道。<<His>>手逐渐游移向了你的<<genitals>>."你摆起这个摊只是想引人注意.你想要了"<<He>>把玩着你
					<br><br>
				<<else>>
					在你转身之前，一双手腋下钻出抓住了你的<<genitals>>。
					<<gtrauma>><<gstress>><<trauma 6>><<stress 6>>
					<br><br>

					"不要对我撒谎," 那个<<personsimple>>'的 声音响起. "你设置这个地方就是是为了吸引起人们的眼球. 你想要这个."<<He>>继续抚摸着你.
					<br><br>
				<</if>>
			<</if>>
			<<link [[Endure (0:05)|Stall Endure]]>><<pass 5>><<trauma 6>><<stress 6>><<arousal 300 "genitals">><<arousal 300 "breasts">><</link>><<gtrauma>><<gstress>><<garousal>>
			<br>
			<<link [[推开|Stall Shove]]>><<set $stall_rejected += 1>><<trauma -6>><</link>><<glewdity>><<ltrauma>>
			<br>
		<<elseif $rng is 2>>
			<<generate1>><<person1>>
			你听到你身后有动静。在你转身之前, 一只手紧紧捂住了你的嘴。"我听说过你，" 那个<<personsimple>>在你耳边细语道："骚货。"<<He>>踢向你的膝关节, 把你摔倒在地。
			<br><br>

			<<link [[继续|Stall Rape]]>><<set $molestationstart to 1>><</link>>
			<br>
		<<elseif $rng is 3>>
			<<generate1>><<person1>>
			<<if $worn.upper.type.includes("naked") and $worn.over_upper.type.includes("naked")>>
				<<if $worn.under_upper.type.includes("naked")>>
					一个<<person>>走进摊位，欣赏着你的商品。突然，<<he>>隔着桌子直接伸手摸了一下你的<<breasts>>便逃走了。
					<<gtrauma>><<gstress>><<garousal>><<trauma 6>><<stress 6>><<arousal 600 "breasts">>
					<br><br>
				<<else>>
					<<set $worn.under_upper.integrity -= 20>>
					一个<<person>>走到你的摊位前, 看向你的商品柜. 毫无征兆的,<<he>>突然把手伸过来隔着桌子抓住了你的$worn.under_upper.cn_name_cap。
					<<gtrauma>><<gstress>><<trauma 6>><<stress 6>>
					<<integritycheck>><<exposure>>
					<br>
					<<if $worn.under_upper.name is "naked">>
						<<his>>的手中紧握着你的衣物，接着<<He>>就跑走了。<<covered>>
						<br><br>
					<<else>>
						<<He>>把它拽下来, 露出了你的<<breasts>>在你能够挣脱<<his>>的手.<<He>>转身逃离了.
						<br><br>
					<</if>>
				<</if>>
			<<elseif !$worn.over_upper.type.includes("naked")>>
				<<set $worn.over_upper.integrity -= 20>>
				<<if $worn.under_upper.type.includes("naked") and $worn.upper.type.includes("naked")>>
					一个<<person>>到你的摊位前, 看向你的商品柜. 毫无征兆的,<<he>>突然把手伸过来隔着桌子抓住了你的$worn.over_upper.cn_name_cap
					<<gtrauma>><<gstress>><<trauma 6>><<stress 6>>
					<<integritycheck>><<exposure>>
					<br>
					<<if $worn.over_upper.name is "naked">>
						<<his>>的手中紧握着你的衣物，接着<<He>>就跑走了。<<covered>>
						<br><br>
					<<else>>
						<<He>>把它拽下来, 露出了你的<<breasts>>在你能够挣脱<<his>>的手.<<He>>转身逃离了.
						<br><br>
					<</if>>
				<<else>>
					一个<<person>>到你的摊位前, 看向你的商品柜. 毫无征兆的,<<he>>突然把手伸过来隔着桌子抓住了你的$worn.over_upper.cn_name_cap
					<<gtrauma>><<gstress>><<trauma 6>><<stress 6>>
					<<integritycheck>><<exposure>>
					<br>
					<<if $worn.over_upper.name is "naked">>
						<<his>>的手中紧握着你的衣物，接着<<He>>就跑走了。<<covered>>
						<br><br>
					<<else>>
						<<He>>把它拽下来,露出了你的$worn.over_upper.cn_name_cap在你能够挣脱<<his>>的手.<<He>>转身逃离了.
						<br><br>
					<</if>>
				<</if>>
			<<else>>
				<<set $worn.upper.integrity -= 20>>
				<<if $worn.under_upper.type.includes("naked")>>
					一个<<person>>到你的摊位前,看向你的商品柜.毫无征兆的,<<he>>突然把手伸过来隔着桌子抓住了你的$worn.upper.cn_name_cap.
					<<gtrauma>><<gstress>><<trauma 6>><<stress 6>>
					<<integritycheck>><<exposure>>
					<br>
					<<if $worn.upper.name is "naked">>
						<<his>>的手中紧握着你的衣物，接着<<He>>就跑走了。<<covered>>
						<br><br>
					<<else>>
						<<He>>把它拽下来, 露出了你的<<breasts>>在你能够挣脱<<his>>的手.<<He>>转身逃离了.
						<br><br>
					<</if>>
				<<else>>
					一个<<person>>到你的摊位前,看向你的商品柜.毫无征兆的,<<he>>突然把手伸过来隔着桌子抓住了你的$worn.upper.cn_name_cap.
					<<gtrauma>><<gstress>><<trauma 6>><<stress 6>>
					<<integritycheck>><<exposure>>
					<br>
					<<if $worn.upper.name is "naked">>
						<<his>>的手中紧握着你的衣物，接着<<He>>就跑走了。<<covered>>
						<br><br>
					<<else>>
						<<He>>把它拽下来,露出了你的$worn.under_upper.cn_name_cap在你能够挣脱<<his>>的手.<<He>>转身逃离了.
						<br><br>
					<</if>>
				<</if>>
			<</if>>
			<<stall_actions>>
		<<elseif $rng is 4>>
			<<generate1>><<person1>>
			你发现街对面有一个<<person>>用相机对着<<his>>的脸. 它看起来像是在指着你. 你感到很不舒服.
			<<gstress>><<stress 6>>
			<br><br>

			<<stall_actions>>
		<<elseif $rng is 5>>
			<<generate1>><<person1>>
			<<stall_init>><<set $enemyarousal += 20>><<set $enemytrust -= 20>>
			一个<<person>>走到你的商品柜前.<<He>><<stall_check_text>>. "这个<span class="green"><<stall_amount>></span>多少钱?"<<he>>问.<<He>>明目张胆地盯着你看.
			<br><br>

			<<stall_trust>>
			<br><br>

			<<stall_sell_actions>>
		<<elseif $rng is 6>>
			<<generate1>><<person1>>
			<<stall_init>><<set $enemyarousal += 20>><<set $enemytrust -= 20>>
			那个<<person>>走到你的商品柜前.<<He>><<stall_check_text>>."这个<span class="green"><<stall_amount>></span>多少钱?"<<he>>问道:"不要妄想用甜言蜜语来搞定我.我听说过你."
			<br><br>

			<<stall_trust>>
			<br><br>

			<<stall_sell_actions>>
		<<elseif $rng is 7>>
			<<generate1>><<person1>>
			<<stall_init>><<set $enemyarousal += 20>><<set $enemytrust -= 20>>
			你看到一个<<person>>在远处看着你.<<He>>当你们的目光相遇时, 他走了过来.<<He>><<stall_check_text>>."这个<span class="green"><<stall_amount>></span>多少钱?"<<he>>问道.
			<br><br>

			<<stall_trust>>
			<br><br>

			<<stall_sell_actions>>
		<<elseif $rng is 8>>
			<<generate1>><<person1>>
			<<stall_init>><<set $enemyarousal += 20>><<set $enemytrust -= 20>>
			你看到一个<<person>>路过, 并在你的摊位前停下.<<His>>眼睛在你的脸上和胸前掠过<<he>><<stall_check_text>>."这个<span class="green"><<stall_amount>></span>多少钱?"<<he>>问道.
			<br><br>

			<<stall_trust>>
			<br><br>

			<<stall_sell_actions>>
		<<elseif $rng is 9>>
			<<generate1>><<person1>>
			<<stall_init>><<set $enemyarousal += 40>><<set $enemytrust -= 20>>
			一个<<person>>大摇大摆地走到你的商品柜前. 毫无征兆的,<<he>>突然把手伸过来隔着柜台抓住了你的肩膀.<<He>>拽着你, 直到你俯身在柜台上, 然后<<he>>靠过来舔你的屁股瓣.
			<<gtrauma>><<gstress>><<trauma 6>><<stress 6>>
			<br><br>
			<<He>>放开了你, 接着<<stall_check_text>>."这个<span class="green"><<stall_amount>></span>多少钱?"<<he>>靠着柜台问道.
			<br><br>

			<<stall_trust>>
			<br><br>

			<<stall_sell_actions>>
		<<else>>
			<<generate1>><<person1>>
			<<stall_init>><<set $enemyarousal += 20>><<set $enemytrust -= 20>>
			一个<<person>>走到你的商品柜前.<<He>><<stall_check_text>>. "这个 <span class="green"><<stall_amount>></span> 多少钱?"<<he>>问,靠着桌子.
			<br><br>

			<<stall_trust>>
			<br><br>

			<<stall_sell_actions>>
		<</if>>
	<<elseif $rng is 1>>
		<<generate1>><<person1>>
		<<stall_init>>
		<<person>>匆匆走过，审视的目光看着着你的产品。
		<br><br>

		<<link [[交谈|Stall Shuffle Talk]]>><</link>>
		<br>
		<<link [[保持缄默|Stall Shuffle Silent]]>><</link>>
		<br>
	<<elseif $rng is 2>>
		<<generate1>><<person1>>
		<<stall_init>>
		<<person>>路过，随便瞅了瞅你的产品。
		<br><br>

		<<link [[交谈|Stall Walk Talk]]>><</link>>
		<br>
		<<link [[保持缄默|Stall Walk Silent]]>><</link>>
	<<elseif $rng is 3>>
		<<generate1>><<person1>>
		<<stall_init>>
		一个<<person>>走到你的摊位前。<<He>>拿起一个<span class="green"><<print setup.plants[$stall_plant].plural>></span>，闻了闻。
		<br><br>
		<<if $stall_amount gte 2>>
			"多少钱?"<<he>>问, 又拿起几个直到<<his>>的篮子里一共有<span class="green"><<stall_amount>></span>个。
		<<else>>
			" <span class="green">一个</span>这个卖多少钱?"<<he>>问。
		<</if>>
		<br><br>

		<<stall_trust>>
		<br><br>

		<<stall_sell_actions>>
	<<elseif $rng is 4>>
		<<generate1>><<person1>>
		<<stall_init>>
		一个<<person>>走了过来，背着<<his>>的手，在<<his>>的身后。"啊哈，"<<he>>说，偷瞄<span class="green"><<print setup.plants[$stall_plant].plural>></span>。<<He>>靠得更近了，并开始谈论。<<He>>好像很懂的样子。
		<br><br>

		<<link [[有礼貌地倾听 (0:10)|Stall Listen]]>><<set $enemytrust += 20>><</link>><<gtrust>>
		<br>
		<<link [[催促|Stall Hurry]]>><<set $enemytrust -= 20>><</link>><<ltrust>>
		<br>
		<<link [[交流|Stall Converse]]>><</link>><<tendingdifficulty 1 400>>
		<br>
	<<elseif $rng is 5>>
		<<generate1>><<person1>>
		<<stall_init>>
		你看到一个<<person>>在摊位前移动.<<He>>在每个摊位前停下看看, 不管他们卖的是什么, 他都和摊主攀谈. 最后<<he>>来到你的摊位前.
		<br><br>
		"哇哦，"<<he>>说，拿起了<span class="green"><<print setup.plants[$stall_plant].plural>></span>。"这些真可爱。是你自己生产的吗?"
		<br><br>
		<<link [[诚实地回答|Stall Honest]]>><<set $enemytrust += 20>><</link>><<gtrust>>
		<br>
		<<link [[闪烁其词|Stall Evasive]]>><<set $enemytrust -= 20>><</link>><<ltrust>>
		<br>
	<<elseif $rng is 6>>
		<<generate1>><<person1>>
		<<stall_init>>
		<<set $enemyarousal += 20>>
		一个<<person>>大摇大摆地走过来倚着柜台。"嘿美人儿，"<<he>>说道。"你这儿的货不错。"<<His>>的眼神停留在你身上。<<He>>甚至都没有瞥一眼你的商品柜。
		<br><br>

		<<link [[进行推销|Stall Encourage]]>><</link>>
		<br>
		<<link [[调情|Stall Flirt]]>><<set $enemytrust += 20>><<set $enemyarousal += 20>><</link>><<promiscuous1>><<gtrust>><<glust>>
		<br>
		<<link [[请他们离开|Stall Leave]]>><</link>>
		<br>
	<<elseif $rng is 7>>
		<<generate1>><<person1>>
		<<stall_init>>
		你看到一个<<person>>在你的摊位前停下。"我给<<spouse>>随便买点什么，"<<he>>说道。<<He>>弯下腰来<<stall_check_text>>。"<span class="green"><<stall_amount>></span>个这种多少钱？"
		<br><br>

		<<stall_trust>>
		<br><br>

		<<stall_sell_actions>>
	<<elseif $rng is 8>>
		<<generate1>><<person1>>
		<<stall_init>>
		一个<<person1>><<person>>抢走了一个<span class="green"><<print setup.plants[$stall_expensive].plural>></span><<he>>在得手之后便逃之夭夭了.
		<br><br>

		<<if $worn.lower.type.includes("naked")>>
			<<if $worn.under_lower.type.includes("naked")>>
				你追的有些忘我<<him>>, 现在才想起自己<span class="lewd">下半身什么也没穿.</span>
				<br><br>
				<<if $exhibitionism gte 75>>
					<<link [[继续追吧|Stall Chase Naked]]>><</link>><<exhibitionist5>><<athleticsdifficulty 1 1200>>
					<br>
				<</if>>
			<<else>>
				你追的有些忘我, 现在才想起自己<span class="lewd">下半身只穿了内裤.</span>
				<br><br>

				<<if $exhibitionism gte 35>>
					<<link [[继续追吧|Stall Chase Undies]]>><</link>><<exhibitionist3>><<athleticsdifficulty 1 1200>>
					<br>
				<</if>>
			<</if>>
		<<else>>
			<<link [[追赶|Stall Chase]]>><</link>><<athleticsdifficulty 1 1200>>
		<</if>>
		<br>
		<<link [[让他们离开|Stall Go]]>><</link>>
		<br>
	<<elseif $rng is 9>>
		<<generate1>><<person1>>
		<<stall_init>>
		<<person1>><<person>>在附近晃荡。
		<br><br>

		<<link [[尝试引起他们的注意|Stall Attention]]>><</link>>
		<br>
		<<link [[无视|Stall Ignore]]>><</link>>
		<br>
	<<else>>
		<<generate1>><<person1>>
		<<stall_init>>
		一个<<person1>><<person>>对你的 <span class="green"><<print setup.plants[$stall_plant].plural>></span>印象深刻。"这种<span class="green"><<stall_amount>></span>个多少钱？"<<he>>问.
		<br><br>

		<<stall_trust>>
		<br><br>

		<<stall_sell_actions>>
	<</if>>
<</widget>>

<<widget "stall_chance">>
	你的吸引力
	<<if $attractiveness gte 5000>>
		为你带来了<span class="green">大量</span>顾客的目光
	<<elseif $attractiveness gte 4000>>
		为你带来了<span class="teal">许多</span>顾客的目光
	<<elseif $attractiveness gte 3000>>
		为你带来了<span class="lblue">不少</span>顾客的目光
	<<elseif $attractiveness gte 2000>>
		为你带来了<span class="blue">像样的</span>顾客的目光
	<<elseif $attractiveness gte 1000>>
		为你带来了<span class="purple">少量</span>顾客的目光
	<<else>>
		只为带来一些<span class="pink">聊胜于无的</span>目光
	<</if>>
	；
	你在商业方面的名声起到了
	<<if $fame.business gte 1000>>
		<span class="green">大量的作用；</span>
	<<elseif $fame.business gte 800>>
		<span class="teal">很多作用；</span>
	<<elseif $fame.business gte 600>>
		<span class="lblue">适量的作用；</span>
	<<elseif $fame.business gte 400>>
		<span class="blue">一些作用；</span>
	<<elseif $fame.business gte 200>>
		<span class="purple">些许作用；</span>
	<<else>>
		<span class="pink">少许作用；</span>
	<</if>>
	而你的护理技能起到了
	<<if currentSkillValue('tending') gte 1200>>
		<span class="gold">极大的作用。</span>
	<<elseif currentSkillValue('tending') gte 1000>>
		<span class="green">大量的作用。</span>
	<<elseif currentSkillValue('tending') gte 800>>
		<span class="teal">很多作用。</span>
	<<elseif currentSkillValue('tending') gte 600>>
		<span class="lblue">像样的作用。</span>
	<<elseif currentSkillValue('tending') gte 400>>
		<span class="blue">些许的作用。</span>
	<<elseif currentSkillValue('tending') gte 200>>
		<span class="purple">一点点作用。</span>
	<<else>>
		<span class="pink">少许的作用。</span>
	<</if>>
	<<if $plant_inventory.length gte 6>>
		你摆出一个<span class="green">卓越的</span>样品。
	<<elseif $plant_inventory.length gte 5>>
		你摆出一个<span class="teal">优秀的</span>样品。
	<<elseif $plant_inventory.length gte 4>>
		你摆出一个<span class="lblue">不错的</span>样品。
	<<elseif $plant_inventory.length gte 3>>
		你摆出了一个<span class="blue">还行的</span>样品。
	<<elseif $plant_inventory.length gte 2>>
		你摆出了一个<span class="purple">劣质的</span>样品。
	<<elseif $plant_inventory.length is 1>>
		只有<span class="pink">一个</span>物品可出售可能会降低你的成功几率。
	<<else>>
		<span class="red">已售罄！</span>
	<</if>>
	<<if $stall_rejected gte 100>>
		一种<span class="lewd">淫荡的</span>氛围弥漫了整个区域。 <span class="red">一群人在远处用毫不掩饰的下流目光盯着你看。</span>
	<<elseif $stall_rejected gte 60>>
		一种<span class="lewd">淫荡的</span>氛围弥漫了整个区域。<span class="pink">你感觉得到来自在远处的视线，但当你寻找的时候人们都转过身去了。</span>
	<<elseif $stall_rejected gte 30>>
		一种<span class="lewd">淫荡的</span>氛围弥漫了整个区域。 <span class="purple">人们不时向你的方向投来奇怪的目光。</span>
	<<elseif $stall_rejected gte 10>>
		一种<span class="lewd">淫荡的</span>氛围弥漫了整个区域。
	<</if>>
<</widget>>

<<widget "stall_trust">>
	<<He>>看起来
	<<if $enemytrust gte 50>>
		<span class="green">心醉神迷。</span>
	<<elseif $enemytrust gte 30>>
		<span class="teal">十分热切。</span>
	<<elseif $enemytrust gte 10>>
		<span class="lblue">很满意。</span>
	<<elseif $enemytrust gte -10>>
		<span class="blue">很感兴趣。</span>
	<<elseif $enemytrust gte -30>>
		<span class="purple">被惹恼了。</span>
	<<else>>
		<span class="pink">很愤怒。</span>
	<</if>>
	<<if $enemyarousal gte 20>>
	也看起来
		<<if $enemyarousal gte 100>>
			<span class="red">欲壑难填。</span>
		<<elseif $enemyarousal gte 80>>
			<span class="pink">淫欲十足。</span>
		<<elseif $enemyarousal gte 60>>
			<span class="purple">非常好色。</span>
		<<elseif $enemyarousal gte 40>>
			<span class="blue">十分性奋。</span>
		<<else>>
			<span class="lblue">有些轻浮。</span>
		<</if>>
	<</if>>
<</widget>>

<<widget "stall_sell_actions">>
	<<link [[询问正常价格|Stall Sell]]>><</link>><<note "(<<printmoney `$stall_cost * $stall_amount`>>)" "gold">>
	<br>
	<<link [[给予折扣|Stall Sell]]>><<set $stall_cost *= 0.8>><<set $enemytrust += 20>><</link>><<note "(<<printmoney `$stall_cost * $stall_amount * 0.8`>>)" "gold">><<gtrust>>
	<br>
	<<link [[反向打折|Stall Sell]]>><<set $enemytrust -= 20>><<set $stall_cost *= 1.2>><</link>><<note "(<<printmoney `$stall_cost * $stall_amount * 1.2`>>)" "gold">><<ltrust>>
	<br>
	<<if $stall_plant isnot $stall_expensive and $stall_expensive isnot undefined>>
		<<link [[推销你最贵的商品|Stall Sell Push]]>><<set $stall_plant to $stall_expensive>><<set $enemytrust -= 20>><</link>><<ltrust>>
		<br>
	<</if>>
<</widget>>

<<widget "stall_sell_man">>
	<<if $enemyarousal gte random(50, 150)>>
		那个<<person1>><<person>>俯身在桌子上抓住了你的胳膊。 "我已经给的够多了，"<<he>>轻声道。 "是时候让我看看真正的货物了。"
		<br><br>

		<<if $promiscuity gte 55>>
			<<link [[提供口交|Stall Oral]]>><</link>><<promiscuous4>>
			<br>
		<<else>>
			你还没淫乱到能接受
			<br>
		<</if>>
		<<link [[拉开距离|Stall Pull]]>><</link>><<glewdity>>
		<br>
	<<elseif $enemytrust gte random(-50, 50)>>
		<<person1>><<person>>妥协了。
		<<stall_sell>>
		<br><br>
		<<endstall>>
		<<stall_inventory>>
		<br><br>

		<<if _inventory_found isnot 1>>
			你已经没东西卖了，继续守摊子也没意义了。
			<br><br>

			<<link [[离开|Connudatus Street]]>><<endevent>><<endstall>><<clotheson>><</link>>
			<br>

		<<else>>

			<<He>>转身离开了。
			<br><br>

			<<stall_trust>>
			<br><br>

			<<if $stall_seduced is 0>>
				<<link [[用调情的方式让他们回心转意|Stall Seduce]]>><</link>><<promiscuous1>><<glust>>
				<br>
			<<elseif $stall_seduced is 1>>
				<<link [[通过卖弄你身体让他们回心转意|Stall Seduce]]>><</link>><<exhibitionist1>><<glust>>
				<br>
			<<elseif $stall_seduced is 2 and $promiscuity gte 15>>
				<<link [[用一个吻让他们回心转意|Stall Seduce]]>><</link>><<promiscuous2>><<glust>>
				<br>
			<<elseif $stall_seduced gte 3 and $worn.lower.type.includes("naked")>>
				<<if $worn.under_lower.type.includes("naked") and $exhibitionism gte 35>>
					<<link [[用走光来让他们回心转意|Stall Seduce]]>><</link>><<exhibitionist3>><<gglust>>
					<br>
				<<elseif !$worn.under_lower.type.includes("naked") and $exhibitionism gte 15>>
					<<link [[用走光来让他们回心转意|Stall Seduce]]>><</link>><<exhibitionist2>><<glust>>
					<br>
				<</if>>
			<</if>>

			<<link [[让他们离开 (0:20)|Stall]]>><<endevent>><<endstall>><<pass 20>><</link>>
			<br>
			<<link [[离开你的摊位|Connudatus Street]]>><<endevent>><<endstall>><<set $eventskip to 1>><<clotheson>><</link>>
			<br>
		<</if>>
	<<elseif $enemytrust gte -50>>
		<<set $enemytrust -= 10>>
		那个<<person1>><<person>>试图讨价还价。
		<br><br>

		<<stall_trust>>
		<br><br>

		<<link [[拒绝讲价|Stall Sell]]>><</link>><<note "(<<printmoney `$stall_cost * $stall_amount`>>)" "gold">>
		<br>
		<<link [[同意降价|Stall Sell]]>><<set $stall_cost *= 0.8>><<set $enemytrust += 20>><</link>><<note "(<<printmoney `$stall_cost * $stall_amount * 0.8`>>)" "gold">><<gtrust>>
		<br>
		<<link [[抬高价格|Stall Sell]]>><<set $enemytrust -= 20>><<set $stall_cost *= 1.2>><</link>><<note "(<<printmoney `$stall_cost * $stall_amount * 1.2`>>)" "gold">><<ltrust>>
		<br>
	<<else>>
		那个<<person1>><<person>>嗤之以鼻扬长而去。
		<br><br>

		<<stall_actions>>

	<</if>>
<</widget>>

<<widget "stall_init">>
	<<set $stall_plant to $plant_inventory.random()>>
	<<if setup.plants[$stall_plant].special.includes("large")>>
		<<set $stall_amount to 1>>
	<<elseif setup.plants[$stall_plant].special.includes("small")>>
		<<set $stall_amount to random(110, 300)>>
	<<else>>
		<<set $stall_amount to random(11, 30)>>
	<</if>>
	<<if $stall_amount gte $plants[$stall_plant].amount>>
		<<set $stall_amount to clone($plants[$stall_plant].amount)>>
	<</if>>
	<<set $enemytrust to 0>>
	<<set $enemyarousal to 0>>
	<<set $stall_seduced to 0>>
	<<set $stall_cost to Math.round(clone(setup.plants[$stall_plant].plant_cost))>>
<</widget>>

<<widget "stall_amount">>
	<<if $stall_amount is 1>>
		<<set _text_output to "一个">>
	<<elseif $stall_amount is 2 and random(1,5) is 1>>
		<<set _text_output to "一对">>
	<<elseif $stall_amount is 12 and random(1,5) is 1>>
		<<set _text_output to "一打">>
	<<elseif $stall_amount is 13 and random(1,10) is 1>>
		<<set _text_output to "一大堆">>
	<<elseif $stall_amount is 20 and random(1,10) is 1>>
		<<set _text_output to "二十个">>
	<<elseif $stall_amount is 24 and random(1,10) is 1>>
		<<set _text_output to "两打">>
	<<elseif $stall_amount is 36 and random(1,15) is 1>>
		<<set _text_output to "三打">>
	<<elseif $stall_amount is 40 and random(1,20) is 1>>
		<<set _text_output to "四十个">>
	<<elseif $stall_amount is 48 and random(1,15) is 1>>
		<<set _text_output to "四打">>
	<<elseif $stall_amount is 60 and random(1,20) is 1>>
		<<set _text_output to "六十个">>
	<<elseif $stall_amount is 60 and random(1,15) is 1>>
		<<set _text_output to "五打">>
	<<elseif $stall_amount is 72 and random(1,10) is 1>>
		<<set _text_output to "六打">>
	<<elseif $stall_amount is 80 and random(1,20) is 1>>
		<<set _text_output to "一百个">>
	<<elseif $stall_amount is 84 and random(1,20) is 1>>
		<<set _text_output to "七打">>
	<<elseif $stall_amount is 96 and random(1,20) is 1>>
		<<set _text_output to "八打">>
	<<elseif $stall_amount is 108 and random(1,20) is 1>>
		<<set _text_output to "九打">>
	<<elseif $stall_amount is 120 and random(1,20) is 1>>
		<<set _text_output to "十打">>
	<<elseif $stall_amount is 144 and random(1,5) is 1>>
		<<set _text_output to "十二打">>
	<<else>>
		<<number $stall_amount silent>>
	<</if>>
	<<print _text_output>>
<</widget>>

<<widget "stall_check_text">><<silently>>
	<<set $_examines to ["examines","lifts","picks up","sniffs"].pluck()>>
	<<switch $stall_plant>>
		<<case "blood_lemon" "bottle_of_breast_milk" "baby_bottle_of_breast_milk" "bottle_of_semen" "strange_flower" "wolfshroom">>
			<<if $_examines is "sniffs">>
				<<set $_reacts to "，之后脸红了">>
			<<else>>
				<<set $_reacts to "">>
			<</if>>
		<<case "apple" "banana" "cabbage" "orange" "peach" "pear" "plum" "strawberry">>
			<<if $_examines is "examines">>
				<<set $_reacts to "有无碰伤">>
			<<elseif ["lifts","picks up"].includes($_examines)>>
				<<set $_reacts to "，以便检查有无碰伤">>
			<<else>>
				<<set $_reacts to "">>
			<</if>>
		<<case "chicken_egg" "bird_egg">>
			<<if $_examines is "sniffs">>
				<<set $_examines to "examines">>
				<<set $_reacts to "有无裂痕">>
			<<elseif $_examines is "examines">>
				<<set $_reacts to "有无裂痕">>
			<<elseif ["lifts","picks up"].includes($_examines)>>
				<<set $_reacts to "，以便检查有无裂痕">>
			<</if>>
		<<default>>
			<<set $_reacts to "">>
	<</switch>>

	<<set _text_output to $_examines.replace("examines","检查").replace("lifts","拔起").replace("picks up","摘取").replace("sniffs","闻了闻") + "一个<span class='green'>" + setup.plants[$stall_plant].plural + "</span>" + $_reacts>>
<</silently>><<print _text_output>><</widget>>